<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AG-Vote v3.19.2</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,300;12..96,400;12..96,500;12..96,600;12..96,700;12..96,800&family=Fraunces:opsz,wght@9..144,600;9..144,700;9..144,800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>

/* ══ DESIGN TOKENS — AG-Vote v3.19.2 "Acte Officiel" ══════════════════ */
:root,[data-theme="light"]{
  /* Surface elevation system */
  --bg:#EDECE6;
  --surface:#FAFAF7;
  --surface-alt:#E5E3D8;
  --surface-raised:#FFFFFF;
  --glass:rgba(250,250,247,.95);

  /* Borders */
  --border:#CDC9BB;
  --border-soft:#DEDAD0;
  --border-dash:#BCB7A5;

  /* Accent — bleu encre */
  --accent:#1650E0;
  --accent-hover:#1140C0;
  --accent-light:#EBF0FF;
  --accent-dark:#0C30A0;
  --accent-glow:rgba(22,80,224,.12);

  /* Sidebar — quasi-noir */
  --sidebar-bg:#0C1018;
  --sidebar-hover:rgba(255,255,255,.1);
  --sidebar-active:rgba(22,80,224,.3);
  --sidebar-border:rgba(255,255,255,.08);
  --sidebar-text:rgba(255,255,255,.85);
  --sidebar-text-hover:#fff;

  /* Typography */
  --text-dark:#151510;
  --text:#52504A;
  --text-muted:#857F72;
  --text-light:#B5B0A0;

  /* Semantic */
  --danger:#C42828;--danger-bg:#FEF1F0;--danger-border:#F4BFBF;
  --success:#0B7A40;--success-bg:#EDFAF2;--success-border:#A3E8C1;
  --warn:#B56700;--warn-bg:#FFF7E8;--warn-border:#F5D490;
  --purple:#5038C0;--purple-bg:#EEEAFF;--purple-border:#C4B8F8;

  /* Tags */
  --tag-bg:#E5E3D8;--tag-text:#6B6860;

  /* Shadows */
  --shadow-xs:0 1px 1px rgba(21,21,16,.03);
  --shadow-sm:0 1px 3px rgba(21,21,16,.05),0 1px 2px rgba(21,21,16,.03);
  --shadow-md:0 3px 10px rgba(21,21,16,.07),0 1px 3px rgba(21,21,16,.04);
  --shadow-lg:0 8px 24px rgba(21,21,16,.1),0 2px 6px rgba(21,21,16,.05);
  --shadow-focus:0 0 0 2px #fff, 0 0 0 4px rgba(22,80,224,.4);

  /* Geometry */
  --radius:8px;--radius-sm:6px;--radius-lg:10px;
  --radius-full:999px;

  /* Type */
  --font:'Bricolage Grotesque',system-ui,sans-serif;
  --font-display:'Fraunces',Georgia,serif;
  --font-mono:'JetBrains Mono',ui-monospace,monospace;

  /* Timing */
  --tr:.15s ease;

  /* Layout */
  --sidebar-rail:58px;
  --sidebar-expanded:252px;
}

[data-theme="dark"]{
  --bg:#0B0D10;
  --surface:#141820;
  --surface-alt:#1B2030;
  --surface-raised:#1E2438;
  --glass:rgba(20,24,32,.96);

  --border:#252C3C;
  --border-soft:#1E2434;
  --border-dash:#2E3850;

  --accent:#3D7EF8;
  --accent-hover:#5C96FA;
  --accent-light:rgba(61,126,248,.12);
  --accent-dark:#96BDFB;
  --accent-glow:rgba(61,126,248,.16);

  --sidebar-bg:#080B10;
  --sidebar-hover:rgba(255,255,255,.1);
  --sidebar-active:rgba(61,126,248,.28);
  --sidebar-border:rgba(255,255,255,.07);
  --sidebar-text:rgba(255,255,255,.85);
  --sidebar-text-hover:#fff;

  --text-dark:#ECF0FA;
  --text:#7A8499;
  --text-muted:#50596C;
  --text-light:#38404E;

  --danger:#E85454;--danger-bg:rgba(232,84,84,.09);--danger-border:rgba(232,84,84,.28);
  --success:#2DC87A;--success-bg:rgba(45,200,122,.08);--success-border:rgba(45,200,122,.28);
  --warn:#EDA030;--warn-bg:rgba(237,160,48,.08);--warn-border:rgba(237,160,48,.28);
  --purple:#8C72F8;--purple-bg:rgba(140,114,248,.1);--purple-border:rgba(140,114,248,.3);

  --tag-bg:rgba(255,255,255,.07);--tag-text:rgba(255,255,255,.5);

  --shadow-xs:0 1px 1px rgba(0,0,0,.16);
  --shadow-sm:0 1px 3px rgba(0,0,0,.24),0 1px 2px rgba(0,0,0,.16);
  --shadow-md:0 3px 10px rgba(0,0,0,.3),0 1px 3px rgba(0,0,0,.2);
  --shadow-lg:0 8px 24px rgba(0,0,0,.36),0 2px 6px rgba(0,0,0,.22);
  --shadow-focus:0 0 0 2px var(--surface), 0 0 0 4px rgba(61,126,248,.55);
}

/* ══ RESET ══════════════════════════════════════════════════════════ */
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:var(--font);
  background:var(--bg);
  color:var(--text);
  font-size:14px;line-height:1.6;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  transition:background .28s,color .28s;
  overflow-x:hidden;
}
button{font-family:var(--font);cursor:pointer;border:none;background:none;font-size:inherit;color:inherit}
input,select,textarea{font-family:var(--font);font-size:inherit}
a{color:inherit;text-decoration:none}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--text-light)}

/* ══ APP SHELL ══════════════════════════════════════════════════════ */
.app{display:flex;flex-direction:column;height:100vh;overflow:hidden}

/* ══ SKIP LINK ══════════════════════════════════════════════════════ */


/* ══ HEADER ══════════════════════════════════════════════════════════ */
.header{
  height:56px;
  background:var(--glass);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  padding:0 20px;justify-content:space-between;
  flex-shrink:0;z-index:90;
}
.logo{
  font-family:var(--font-display);
  font-size:17px;font-weight:700;letter-spacing:-.2px;
  color:var(--text-dark);
  display:flex;align-items:center;gap:9px;
}
.logo-mark{
  width:28px;height:28px;border-radius:6px;
  background:var(--accent);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 1px 4px rgba(22,80,224,.28),inset 0 1px 0 rgba(255,255,255,.12);
}
.hamburger{display:none;width:32px;height:32px;align-items:center;justify-content:center;border-radius:var(--radius-sm);cursor:pointer;border:none;background:none;color:var(--text-dark);flex-shrink:0;transition:background var(--tr)}
.hamburger:hover{background:var(--surface-alt)}

/* ══ BODY WRAP ══════════════════════════════════════════════════════ */
.body-wrap{display:flex;flex:1;overflow:hidden;position:relative;min-height:0;padding-left:var(--sidebar-rail)}

/* ══ SIDEBAR ════════════════════════════════════════════════════════ */
/* ALWAYS absolute — never in document flow, never causes layout shift */
.sidebar{
  width:var(--sidebar-rail);
  background:var(--sidebar-bg);
  display:flex;flex-direction:column;
  position:absolute;top:0;left:0;height:100%;
  overflow:hidden;
  transition:width .25s cubic-bezier(.4,0,.2,1);
  z-index:55;
  border-right:1px solid var(--sidebar-border);
}
/* Hover = widen overlay, pinned = same overlay but persistent */
.sidebar:hover,.sidebar.pinned{width:var(--sidebar-expanded);box-shadow:8px 0 24px rgba(0,0,0,.18)}
.sidebar.pinned{box-shadow:4px 0 16px rgba(0,0,0,.12)}

/* Labels appear on hover/pin — fade only, no width change */
.sidebar:hover .nav-label,.sidebar.pinned .nav-label{opacity:1;max-width:180px}
.sidebar:hover .nav-group-label,.sidebar.pinned .nav-group-label{opacity:1;max-width:180px}
.sidebar:hover .nav-group svg,.sidebar.pinned .nav-group svg{opacity:1}
.sidebar:hover .sidebar-version,.sidebar.pinned .sidebar-version{opacity:1}
.sidebar:hover .sidebar-pin,.sidebar.pinned .sidebar-pin{opacity:1}
.sidebar:hover .device-tag,.sidebar.pinned .device-tag{opacity:1;max-width:100px}

/* Scroll container — constant padding, no shift */
.sidebar-scroll{flex:1;overflow-y:auto;overflow-x:hidden;padding:6px 4px;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.25) transparent}
.sidebar-scroll::-webkit-scrollbar{width:3px}
.sidebar-scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,.25);border-radius:2px}

/* Fade indicators */
.sidebar-fade{flex:1;overflow:hidden;position:relative;display:flex;flex-direction:column}
.sidebar-fade::before,.sidebar-fade::after{content:'';position:absolute;left:0;right:0;height:20px;pointer-events:none;z-index:2;opacity:0;transition:opacity .2s}
.sidebar-fade::before{top:0;background:linear-gradient(var(--sidebar-bg),transparent)}
.sidebar-fade::after{bottom:0;background:linear-gradient(transparent,var(--sidebar-bg))}
.sidebar-fade.has-scroll-top::before{opacity:1}
.sidebar-fade.has-scroll-bottom::after{opacity:1}
.sidebar-overlay{display:none}

/* Nav items — icon centered in 58px rail: 4(scroll)+16(pad)+9(half 18px icon)=29≈28.5 center */
.nav-item{
  display:flex;align-items:center;
  gap:10px;justify-content:flex-start;
  padding:0 8px 0 16px;height:42px;
  cursor:pointer;
  color:var(--sidebar-text);
  border-radius:var(--radius-sm);
  margin:1px 0;
  transition:background var(--tr),color var(--tr);
  white-space:nowrap;overflow:hidden;
  position:relative;
  font-size:14px;font-weight:500;
}
.nav-item>svg{flex-shrink:0;width:18px;min-width:18px;height:18px}
.nav-item:hover{background:var(--sidebar-hover);color:var(--sidebar-text-hover)}
.nav-item.active{
  background:var(--sidebar-active);
  color:#fff;
  font-weight:600;
}
/* Left accent bar on active */
.nav-item.active::before{
  content:'';position:absolute;left:0;top:5px;bottom:5px;
  width:2.5px;background:var(--accent);
  border-radius:0 2px 2px 0;
}

/* Labels — fade in with max-width, no reflow */
/* Labels — fade in with max-width, no reflow */
.nav-label{opacity:0;max-width:0;overflow:hidden;transition:opacity .2s .05s,max-width .25s cubic-bezier(.4,0,.2,1);font-size:14px;font-weight:500;white-space:nowrap}

/* Nav groups — ALWAYS take up vertical space (no height:0 collapse) */
.nav-group{
  height:20px;padding:6px 10px 2px;margin:0;overflow:hidden;
  display:flex;align-items:center;cursor:pointer;user-select:none;
  white-space:nowrap;position:relative;
}
/* Thin divider line in rail mode — visible separator */
.nav-group::after{
  content:'';position:absolute;left:14px;right:14px;top:50%;
  height:1px;background:rgba(255,255,255,.1);
  transition:opacity .2s;
}
/* Hide divider line when expanded — label replaces it */
.sidebar:hover .nav-group::after,.sidebar.pinned .nav-group::after{opacity:0}
.nav-group:first-child{padding-top:2px}
.nav-group:first-child::after{display:none}
.nav-group-label{
  font-size:12px;font-weight:700;letter-spacing:1.4px;text-transform:uppercase;
  color:rgba(255,255,255,.5);padding-left:4px;opacity:0;max-width:0;
  overflow:hidden;transition:opacity .2s .05s,max-width .25s cubic-bezier(.4,0,.2,1);
}
.nav-group svg{opacity:0;transition:opacity .2s .05s,transform .2s;margin-left:auto;margin-right:5px;flex-shrink:0;color:rgba(255,255,255,.5)}
.nav-group.collapsed svg{transform:rotate(-90deg)}
.nav-group:hover .nav-group-label{color:rgba(255,255,255,.75)}

/* Sidebar badges — always absolute right, no position jump */
.nav-badge{
  position:absolute;right:5px;top:50%;transform:translateY(-50%);
  min-width:16px;height:16px;border-radius:var(--radius-full);
  background:var(--danger);color:#fff;
  font-family:var(--font-mono);font-size:10px;font-weight:700;
  display:flex;align-items:center;justify-content:center;padding:0 4px;
  box-shadow:0 1px 3px rgba(196,40,40,.4);
}

/* Pin button */
.sidebar-pin{
  position:absolute;top:9px;right:7px;
  width:28px;height:28px;border-radius:var(--radius-sm);
  display:flex;align-items:center;justify-content:center;
  color:rgba(255,255,255,.5);border:1px solid transparent;
  opacity:0;transition:opacity var(--tr),background var(--tr),color var(--tr),border-color var(--tr);
  cursor:pointer;z-index:10;
}
.sidebar-pin:hover{background:rgba(255,255,255,.12);color:rgba(255,255,255,.9);border-color:rgba(255,255,255,.18)}
.sidebar.pinned .sidebar-pin{color:var(--accent);opacity:1;background:rgba(22,80,224,.15);border-color:rgba(22,80,224,.3)}

/* Device section + footer */
.sidebar-device-section{border-top:1px solid var(--sidebar-border);padding:4px 0}
.sidebar-footer{border-top:1px solid var(--sidebar-border);padding:6px 0 4px}
.sidebar-version{font-size:10px;color:rgba(255,255,255,.4);padding:4px 14px;opacity:0;transition:opacity var(--tr);white-space:nowrap;overflow:hidden;font-family:var(--font-mono);letter-spacing:.4px}
.device-tag{font-size:10px;font-weight:700;letter-spacing:.4px;text-transform:uppercase;color:rgba(255,255,255,.5);opacity:0;max-width:0;overflow:hidden;white-space:nowrap;transition:opacity .2s .05s,max-width .25s cubic-bezier(.4,0,.2,1);margin-left:auto}

/* ══ MAIN ════════════════════════════════════════════════════════════ */
.main{flex:1;padding:16px 22px;overflow-y:auto;overflow-x:hidden;min-width:0;min-height:0}

/* ══ PAGE HEADER (PH) ═══════════════════════════════════════════════ */
.page-title{
  font-family:var(--font-display);
  font-size:19px;font-weight:700;letter-spacing:-.3px;line-height:1.2;
  color:var(--text-dark);
  display:flex;align-items:center;gap:8px;
}
/* Accent bar */
.page-title .bar{width:3px;height:19px;background:var(--accent);border-radius:var(--radius-full);flex-shrink:0}
.page-sub{font-size:14px;color:var(--text-muted);font-weight:500;margin-top:2px;letter-spacing:.1px}
.muted{font-size:14px;color:var(--text-muted);font-weight:500}
/* Breadcrumb */
.breadcrumb{display:flex;align-items:center;gap:6px;font-size:13px;margin-bottom:4px;flex-wrap:wrap}
.bc-item{color:var(--text-muted);font-weight:500}
.bc-current{color:var(--text-dark);font-weight:600}
.bc-sep{color:var(--border);font-weight:400;font-size:12px}
.h3{font-size:12px;font-weight:700;color:var(--text-dark)}

/* ══ CARDS ══════════════════════════════════════════════════════════ */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:14px;
  box-shadow:var(--shadow-xs);
  transition:box-shadow .18s ease,border-color .18s ease,transform .18s ease,background .18s ease;
  overflow:hidden;
}
.card:hover{box-shadow:var(--shadow-sm)}
/* Clickable cards — professional lift */
.card[style*="cursor:pointer"]:hover,.card[style*='"pointer"']:hover{
  box-shadow:var(--shadow-md);
  transform:translateY(-2px);
  border-color:color-mix(in srgb,var(--accent) 25%,var(--border));
}

/* ══ INTERACTIVE ROWS ═══════════════════════════════════════════════ */
/* For clickable list items: tasks, sessions, notifications, etc. */
.irow{
  transition:background .12s ease,transform .1s ease;
  border-radius:var(--radius-sm);
}
.irow:hover{
  background:var(--surface-alt);
}
.irow:active{
  transform:scale(.995);
}
/* Give nested text a subtle color shift on row hover */
.irow:hover .irow-title{color:var(--accent)}
.irow:hover .irow-arrow{opacity:1;transform:translateX(2px)}
.irow-arrow{opacity:.3;transition:opacity .15s,transform .15s}

/* ══ KPI CARDS (dashboard stats) ═══════════════════════════════════ */
.kpi{
  text-align:center;padding:12px 8px;cursor:default;
  transition:transform .15s ease,box-shadow .15s ease,border-color .15s ease;
}
.kpi:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow-sm);
  border-color:color-mix(in srgb,var(--accent) 18%,var(--border));
}
.card-title{
  font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;
  color:var(--text-muted);margin-bottom:10px;
  display:flex;align-items:center;gap:6px;
}

/* ══ BOUTONS ═════════════════════════════════════════════════════════ */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  padding:8px 16px;min-height:40px;
  border-radius:var(--radius-sm);
  border:1px solid var(--border);
  background:var(--surface);
  color:var(--text);
  font-size:14px;font-weight:600;letter-spacing:.05px;
  white-space:nowrap;cursor:pointer;
  transition:color var(--tr),background var(--tr),border-color var(--tr),box-shadow var(--tr),transform var(--tr),opacity var(--tr);
  font-family:var(--font);
  line-height:1;
  text-align:center;
  vertical-align:middle;
  box-sizing:border-box;
}
.btn:hover{border-color:var(--text-light);color:var(--text-dark);background:var(--surface-raised)}
.btn:active{transform:scale(.98)}
.btn:disabled{opacity:.35;cursor:not-allowed;pointer-events:none}
.btn:focus-visible{outline:none;box-shadow:var(--shadow-focus)}

/* Primary — gradient for depth, bigger visual weight */
.btn-p{
  border-color:var(--accent);
  background:linear-gradient(180deg,var(--accent) 0%,color-mix(in srgb,var(--accent),#000 8%) 100%);
  color:#fff;font-weight:700;
  box-shadow:0 2px 4px rgba(22,80,224,.3),inset 0 1px 0 rgba(255,255,255,.12);
}
.btn-p:hover{
  background:linear-gradient(180deg,var(--accent-hover) 0%,color-mix(in srgb,var(--accent-hover),#000 10%) 100%);
  border-color:var(--accent-hover);
  box-shadow:0 3px 10px rgba(22,80,224,.35);
  transform:translateY(-1px);
}
.btn-p:active{transform:scale(.98) translateY(0);box-shadow:none}

/* Destructive */
.btn-danger{
  border-color:var(--danger);
  background:linear-gradient(180deg,var(--danger),#A82020);
  color:#fff;font-weight:700;
  box-shadow:0 2px 4px rgba(196,40,40,.3),inset 0 1px 0 rgba(255,255,255,.12);
}
.btn-danger:hover{background:linear-gradient(180deg,#B82424,#961A1A);border-color:#961A1A;transform:translateY(-1px);box-shadow:0 3px 10px rgba(196,40,40,.35)}

/* Success */
.btn-success{
  border-color:var(--success);
  background:linear-gradient(180deg,var(--success),#086030);
  color:#fff;font-weight:700;
  box-shadow:0 2px 4px rgba(11,122,64,.3),inset 0 1px 0 rgba(255,255,255,.12);
}
.btn-success:hover{background:linear-gradient(180deg,#096840,#064828);transform:translateY(-1px);box-shadow:0 3px 10px rgba(11,122,64,.35)}

/* Warn */
.btn-warn{border-color:var(--warn);background:var(--warn-bg);color:var(--warn);font-weight:700}
.btn-warn:hover{background:var(--warn-bg);border-color:var(--warn);transform:translateY(-1px)}

/* Ghost — minimal visual weight for secondary actions */
.btn-ghost{border-color:transparent;background:transparent;color:var(--text-muted)}
.btn-ghost:hover{background:var(--surface-alt);border-color:var(--border);color:var(--text-dark)}

/* Sizes */
.btn-sm{padding:5px 11px;font-size:13px;min-height:32px;gap:5px}
.btn-lg{padding:10px 20px;font-size:15px;min-height:44px;font-weight:700}
.btn-block{width:100%}

/* ══ CHAMPS ══════════════════════════════════════════════════════════ */
.field{margin-bottom:10px;position:relative}
.field-label{
  font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;
  color:var(--text);margin-bottom:4px;
  display:flex;align-items:center;gap:4px;
}
.field-label .req{color:var(--danger);font-weight:800}
.field-input{
  border:1px solid var(--border);border-radius:var(--radius-sm);
  padding:8px 12px;font-size:14px;color:var(--text-dark);width:100%;
  background:var(--surface-raised);
  transition:border-color var(--tr),box-shadow var(--tr),background var(--tr);
  min-height:42px;font-family:var(--font);box-sizing:border-box;
}
.field-input:focus{outline:none;border-color:var(--accent);box-shadow:var(--shadow-focus)}
.field-input:hover:not(:focus):not(:disabled){border-color:var(--text-light)}
.field-input:disabled{background:var(--surface-alt);color:var(--text-muted);cursor:not-allowed;opacity:.6}
.field-input::placeholder{color:var(--text-light)}
.field-hint{font-size:12px;color:var(--text-muted);margin-top:3px;font-weight:500}
.field-counter{font-size:11px;color:var(--text-light);text-align:right;margin-top:2px;font-family:var(--font-mono);font-weight:500;transition:color var(--tr)}
.field-counter.warn{color:var(--warn)}
.field-counter.over{color:var(--danger);font-weight:700}
.field-success{display:flex;align-items:center;gap:4px;font-size:12px;color:var(--success);font-weight:600;margin-top:3px}
select.field-input{
  appearance:none;cursor:pointer;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23857F72' stroke-width='2.5'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center;
  padding-right:28px;
}
textarea.field-input{min-height:50px;resize:vertical;line-height:1.5}

/* ══ UTILITAIRES ═════════════════════════════════════════════════════ */
.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.word-break{word-break:break-word;overflow-wrap:anywhere}

/* ══ SCROLL SHADOW ══════════════════════════════════════════════════ */

/* ══ AVATAR ══════════════════════════════════════════════════════════ */
.avatar{width:32px;height:32px;border-radius:var(--radius-full);display:inline-flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff;flex-shrink:0;text-transform:uppercase;letter-spacing:.3px}
.avatar-sm{width:24px;height:24px;font-size:10px}
.avatar-lg{width:40px;height:40px;font-size:15px}

/* ══ TAGS / CHIPS ════════════════════════════════════════════════════ */
.tag{
  font-size:13px;font-weight:700;letter-spacing:.1px;
  background:var(--tag-bg);color:var(--tag-text);
  padding:3px 9px;border-radius:5px;
  display:inline-flex;align-items:center;gap:4px;white-space:nowrap;
}
.tag-accent{background:var(--accent-light);color:var(--accent)}
.tag-danger{background:var(--danger-bg);color:var(--danger);border:1px solid var(--danger-border)}
.tag-success{background:var(--success-bg);color:var(--success);border:1px solid var(--success-border)}
.tag-warn{background:var(--warn-bg);color:var(--warn);border:1px solid var(--warn-border)}
.tag-purple{background:var(--purple-bg);color:var(--purple);border:1px solid var(--purple-border)}

.chip{
  display:inline-flex;align-items:center;gap:4px;
  padding:4px 10px;border-radius:var(--radius-full);
  font-size:13px;font-weight:600;cursor:pointer;
  background:var(--tag-bg);color:var(--text-muted);
  border:1px solid transparent;
  transition:color var(--tr),background var(--tr),border-color var(--tr);min-height:26px;
}
.chip:hover{background:var(--accent-light);color:var(--accent)}
.chip.active{background:var(--accent);color:#fff;border-color:var(--accent)}

/* ══ ALERTS ══════════════════════════════════════════════════════════ */
.alert{
  padding:10px 14px;border-radius:var(--radius-sm);
  font-size:14px;font-weight:500;line-height:1.5;
  display:flex;align-items:flex-start;gap:8px;
  margin-bottom:10px;border:1px solid;
}
.alert>svg{flex-shrink:0;margin-top:1px}
.alert-success{background:var(--success-bg);color:var(--success);border-color:var(--success-border)}
.alert-warn{background:var(--warn-bg);color:var(--warn);border-color:var(--warn-border)}

/* ══ TABLES ══════════════════════════════════════════════════════════ */
.table-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;
  border-radius:var(--radius-lg);border:1px solid var(--border);background:var(--surface);box-shadow:var(--shadow-xs);
  mask-image:linear-gradient(to right,transparent,#000 8px,#000 calc(100% - 8px),transparent);
  -webkit-mask-image:linear-gradient(to right,transparent,#000 8px,#000 calc(100% - 8px),transparent);
}
table{width:100%;border-collapse:collapse}
th{
  padding:7px 12px;text-align:left;
  font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;
  color:var(--text-muted);
  background:var(--surface-alt);
  border-bottom:1px solid var(--border);
  white-space:nowrap;position:sticky;top:0;z-index:1;
}
th:first-child{border-radius:var(--radius-lg) 0 0 0}
th:last-child{border-radius:0 var(--radius-lg) 0 0}
td{
  padding:7px 12px;
  border-bottom:1px solid var(--border-soft);
  color:var(--text);
  font-size:12px;vertical-align:middle;
}
tr:last-child td{border-bottom:none}
/* Striped — the fundamental legibility pattern */
tbody tr:nth-child(even) td{background:rgba(21,21,16,.022)}
[data-theme="dark"] tbody tr:nth-child(even) td{background:rgba(255,255,255,.022)}
tbody tr{transition:background .1s ease}
tbody tr:hover td{background:color-mix(in srgb,var(--accent) 6%,var(--surface));transition:background .1s}
[data-theme="dark"] tbody tr:hover td{background:rgba(61,126,248,.08)}

/* ══ PAGINATION ══════════════════════════════════════════════════════ */
.pagination{display:flex;align-items:center;justify-content:center;gap:3px;padding:8px;border-top:1px solid var(--border-soft)}
.pg-btn{
  width:26px;height:26px;border-radius:5px;
  display:flex;align-items:center;justify-content:center;
  font-family:var(--font-mono);font-size:11px;font-weight:600;
  border:1px solid var(--border);background:var(--surface);color:var(--text-muted);
  cursor:pointer;transition:color var(--tr),background var(--tr),border-color var(--tr);
}
.pg-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-light)}
.pg-btn.pg-active{background:var(--accent);border-color:var(--accent);color:#fff}

/* ══ PROGRESS ════════════════════════════════════════════════════════ */
.progress-bar{height:4px;background:var(--surface-alt);border-radius:2px;overflow:hidden}
.progress-fill{height:100%;border-radius:2px;transition:width .4s cubic-bezier(.4,0,.2,1)}

/* ══ LIVE DOT ════════════════════════════════════════════════════════ */
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--danger);animation:pulse 1.8s ease-in-out infinite;flex-shrink:0}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(196,40,40,.4)}60%{box-shadow:0 0 0 5px rgba(196,40,40,0)}}

/* ══ SKELETON ════════════════════════════════════════════════════════ */
.skeleton{background:linear-gradient(90deg,var(--surface-alt) 25%,var(--border-soft) 50%,var(--surface-alt) 75%);background-size:200% 100%;animation:shimmer 1.6s infinite;border-radius:4px}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* ══ GRILLES ═════════════════════════════════════════════════════════ */
/* ══ GRIDS ═══════════════════════════════════════════════════════════ */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.row{display:flex;gap:12px;flex-wrap:wrap}.row>*{flex:1;min-width:140px}
.flex-between{display:flex;justify-content:space-between;align-items:center;gap:8px}
.flex-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.flex-col{display:flex;flex-direction:column;gap:8px}

/* ══ OVERFLOW GUARDS ═════════════════════════════════════════════════ */
td,th{max-width:260px;overflow:hidden;text-overflow:ellipsis}

/* ══ OP TABS ═════════════════════════════════════════════════════════ */
.op-tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:10px}
.op-tab{
  padding:8px 14px;font-size:13px;font-weight:600;
  text-transform:uppercase;letter-spacing:.5px;
  cursor:pointer;color:var(--text-muted);
  border-bottom:2px solid transparent;margin-bottom:-1px;
  transition:color var(--tr),border-color var(--tr);
  display:flex;align-items:center;gap:5px;
}
.op-tab:hover{color:var(--text-dark)}
.op-tab.active{color:var(--accent);border-bottom-color:var(--accent);font-weight:700}
.op-tab .notif{min-width:16px;height:16px;border-radius:var(--radius-full);background:var(--danger);color:#fff;font-family:var(--font-mono);font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;padding:0 3px}

/* ══ VOTE BUTTONS ════════════════════════════════════════════════════ */
.vote-btn{border:1.5px solid var(--border);border-radius:var(--radius-lg);padding:14px 10px;text-align:center;cursor:pointer;transition:background .18s cubic-bezier(.4,0,.2,1),border-color .18s cubic-bezier(.4,0,.2,1),box-shadow .18s cubic-bezier(.4,0,.2,1),transform .18s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;flex:1;min-width:0;user-select:none;background:var(--surface);min-height:110px;position:relative}
.vote-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}
.vote-btn .vb-label{font-size:17px;font-weight:800;color:var(--text-dark)}
.vote-btn .vb-icon{width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.vote-btn .vb-check{position:absolute;top:8px;right:8px;width:19px;height:19px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.vote-pour{border-color:var(--success);background:var(--success-bg)}
.vote-pour:hover{box-shadow:0 4px 16px rgba(11,122,64,.14)}
.vote-pour.selected{background:var(--success);border-color:var(--success);box-shadow:0 0 0 3px rgba(11,122,64,.18)}
.vote-pour.selected .vb-label{color:#fff}.vote-pour.selected .vb-icon{background:rgba(255,255,255,.18)}
.vote-contre{border-color:var(--danger);background:var(--danger-bg)}
.vote-contre:hover{box-shadow:0 4px 16px rgba(196,40,40,.14)}
.vote-contre.selected{background:var(--danger);border-color:var(--danger);box-shadow:0 0 0 3px rgba(196,40,40,.18)}
.vote-contre.selected .vb-label{color:#fff}.vote-contre.selected .vb-icon{background:rgba(255,255,255,.18)}
.vote-abst{border-color:var(--border-dash);background:var(--surface-alt)}
.vote-abst.selected{background:var(--text-muted);border-color:var(--text-muted)}
.vote-abst.selected .vb-label{color:#fff}

/* ══ STEPPER ═════════════════════════════════════════════════════════ */
.stepper{display:flex;align-items:flex-start;margin-bottom:14px;max-width:460px}
.step-dot{width:20px;height:20px;border-radius:50%;border:2px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:11px;font-weight:700;color:var(--text-muted);flex-shrink:0;transition:background var(--tr),border-color var(--tr),color var(--tr)}
.step-dot.done{background:var(--success);border-color:var(--success);color:#fff}
.step-dot.active{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 0 0 3px var(--accent-glow)}

/* ══ HUB ═════════════════════════════════════════════════════════════ */
.hub-stepper{display:flex;flex-direction:column;gap:0;margin-bottom:10px}
.hub-step-row{display:flex;align-items:flex-start;gap:8px;padding:4px 6px;cursor:pointer;border:none;background:none;width:100%;text-align:left;border-radius:var(--radius-sm);transition:background var(--tr)}
.hub-step-row:hover{background:var(--surface-alt)}
.hub-step-num{
  width:20px;height:20px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-family:var(--font-mono);font-size:11px;font-weight:700;
  flex-shrink:0;border:2px solid var(--border);
  color:var(--text-muted);background:var(--surface);
  transition:color .15s,font-weight .15s;margin-top:1px;
}
.hub-step-num.done{background:var(--success);border-color:var(--success);color:#fff}
.hub-step-num.active{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 0 0 3px var(--accent-glow)}
.hub-step-line{width:2px;background:var(--border);margin:0 9px;flex-shrink:0;height:8px}
.hub-step-line.done{background:var(--success)}
.hub-step-text{flex:1;padding-top:1px}
.hub-step-title{font-size:12px;font-weight:500;color:var(--text-muted)}
.hub-step-title.active{color:var(--text-dark);font-size:13px;font-weight:700}
.hub-step-title.done{color:var(--success);font-weight:600}

/* Hub action card */
.hub-action{
  background:var(--surface);
  border:1.5px solid var(--accent);
  border-radius:var(--radius-lg);
  padding:14px 16px 12px;
  display:flex;flex-direction:column;gap:10px;
  box-shadow:0 0 0 3px var(--accent-glow),var(--shadow-sm);
  margin-bottom:12px;
  transition:transform .15s ease,box-shadow .15s ease;
}
.hub-action:hover{transform:translateY(-1px);box-shadow:0 0 0 3px var(--accent-glow),var(--shadow-md)}
.hub-action-icon{width:38px;height:38px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.hub-action-title{font-family:var(--font-display);font-size:15px;font-weight:700;color:var(--text-dark);line-height:1.25;margin-bottom:2px}
.hub-action-desc{font-size:12px;color:var(--text-muted);line-height:1.45}
.hub-action-btn{min-height:27px;font-size:12px;font-weight:700;padding:0 15px;gap:5px}

.hub-details-toggle{
  width:100%;display:flex;align-items:center;justify-content:space-between;
  padding:6px 12px;border:1px solid var(--border);border-radius:var(--radius);
  background:var(--surface);cursor:pointer;
  font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;
  color:var(--text-muted);transition:color .15s,background .15s;
}
.hub-details-toggle:hover{background:var(--surface-alt);color:var(--text-dark)}
.hub-details-toggle[aria-expanded="true"]{border-radius:var(--radius) var(--radius) 0 0;border-bottom-color:transparent;background:var(--surface-alt);color:var(--text-dark)}
.hub-details-body{border:1px solid var(--border);border-top:none;border-radius:0 0 var(--radius) var(--radius);padding:12px;background:var(--surface)}

.hub-identity{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:10px 14px;margin-bottom:12px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;box-shadow:var(--shadow-xs)}
.hub-identity-date{font-family:var(--font-display);font-size:15px;font-weight:700;color:var(--text-dark)}
.hub-identity-meta{font-size:14px;color:var(--text-muted);margin-top:2px;display:flex;align-items:center;gap:5px;flex-wrap:wrap}

/* ══ MODALES ═════════════════════════════════════════════════════════ */
.overlay-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:100;padding:16px;backdrop-filter:blur(3px)}
.modal{width:min(520px,100%);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);overflow:hidden;animation:modalIn .2s cubic-bezier(.34,1.2,.64,1)}
@keyframes modalIn{from{opacity:0;transform:scale(.96) translateY(6px)}to{opacity:1;transform:none}}
.modal-h{padding:13px 18px;border-bottom:1px solid var(--border-soft);display:flex;align-items:center;justify-content:space-between}
.modal-h .t{font-size:13px;font-weight:700;color:var(--text-dark)}
.modal-b{padding:16px 18px}
.modal-f{padding:10px 18px;border-top:1px solid var(--border-soft);display:flex;justify-content:flex-end;gap:6px}

/* ══ POPOVER ═════════════════════════════════════════════════════════ */
.popover-wrap{position:relative;display:inline-flex}
.popover{position:absolute;right:0;top:calc(100% + 4px);min-width:175px;background:var(--surface-raised);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow-lg);z-index:30;overflow:hidden;animation:popIn .12s cubic-bezier(.4,0,.2,1)}
@keyframes popIn{from{opacity:0;transform:translateY(-4px) scale(.97)}to{opacity:1;transform:none}}
.popover .mi{padding:7px 12px;display:flex;align-items:center;gap:7px;font-weight:600;font-size:12px;color:var(--text);cursor:pointer;transition:background var(--tr)}
.popover .mi:hover{background:var(--accent-light);color:var(--accent)}
.popover .sep{height:1px;background:var(--border-soft)}

/* ══ THEME TOGGLE ════════════════════════════════════════════════════ */
.theme-toggle{width:34px;height:19px;border-radius:10px;background:var(--border);cursor:pointer;position:relative;transition:background .25s;border:none;flex-shrink:0}
.theme-toggle::after{content:'';width:13px;height:13px;border-radius:50%;background:#fff;position:absolute;top:3px;left:3px;transition:transform .22s cubic-bezier(.34,1.4,.64,1);box-shadow:0 1px 2px rgba(0,0,0,.15)}
[data-theme="dark"] .theme-toggle{background:var(--accent)}
[data-theme="dark"] .theme-toggle::after{transform:translateX(15px)}

/* ══ HTIP ════════════════════════════════════════════════════════════ */
.htip{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:50%;background:var(--surface-alt);color:var(--text-muted);font-size:11px;font-weight:800;cursor:help;border:1px solid var(--border);font-family:var(--font-mono)}
.htip-portal{position:fixed;z-index:9999;pointer-events:none}

/* ══ CTX PANEL ═══════════════════════════════════════════════════════ */
.ctx-panel{background:var(--accent-light);border:1px solid rgba(22,80,224,.1);border-left:3px solid var(--accent);border-radius:0 var(--radius) var(--radius) 0;padding:9px 13px}
.ctx-panel h4{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--accent-dark);margin-bottom:4px;display:flex;align-items:center;gap:5px}
.ctx-panel p{font-size:12px;color:var(--accent-dark);line-height:1.5;opacity:.85}

/* ══ DEVICE BAR ══════════════════════════════════════════════════════ */
.device-bar{display:flex;align-items:center;gap:7px;padding:6px 14px;font-size:13px;font-weight:700;letter-spacing:.5px;border-bottom:1px solid}
.device-bar .device-label{font-weight:800;text-transform:uppercase;letter-spacing:1px}
.device-bar .device-desc{font-weight:500;opacity:.75}

/* ══ TABLET FRAME ════════════════════════════════════════════════════ */
.tablet-frame{max-width:780px;margin:0 auto;background:var(--bg);border-radius:18px;border:1.5px solid var(--border);box-shadow:0 8px 32px rgba(0,0,0,.08);overflow:hidden;min-height:75vh;display:flex;flex-direction:column}
.tablet-frame .device-bar{border-radius:16px 16px 0 0}
.tablet-frame .tablet-body{flex:1;padding:14px 18px;overflow:hidden;display:flex;flex-direction:column}
.tablet-frame .votant-shell{height:auto;flex:1;max-width:100%}

/* ══ STANDALONE ══════════════════════════════════════════════════════ */
.standalone-page{min-height:100vh;background:var(--bg);display:flex;flex-direction:column}
.standalone-page .standalone-nav{padding:9px 18px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.standalone-page .standalone-content{flex:1;padding:20px;display:flex;align-items:center;justify-content:center}

/* ══ VOTANT SHELL ════════════════════════════════════════════════════ */
.votant-shell{display:flex;flex-direction:column;height:calc(100vh - 80px);max-width:580px;margin:0 auto;overflow:hidden}
.votant-header{display:flex;align-items:center;justify-content:space-between;padding:7px 0;flex-shrink:0}
.votant-question{padding:14px 16px;background:var(--surface);border:1.5px solid var(--accent);border-radius:var(--radius-lg);flex-shrink:0}
.votant-actions{margin-top:auto;padding:7px 0;flex-shrink:0}
.votant-footer{display:flex;align-items:center;justify-content:space-between;padding:5px 0;border-top:1px solid var(--border-soft);flex-shrink:0}

/* ══ PAGE ANIMATIONS ═════════════════════════════════════════════════ */
.page-anim{animation:pageIn .18s cubic-bezier(.4,0,.2,1)}
@keyframes pageIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
@keyframes fadeIn{from{opacity:0;transform:translateY(3px)}to{opacity:1;transform:none}}
@keyframes slideUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

/* ══ LANDING ══════════════════════════════════════════════════════════ */
.landing{min-height:100vh;background:var(--bg);display:flex;flex-direction:column}
.landing-header{display:flex;align-items:center;justify-content:space-between;padding:14px 24px;background:var(--surface);border-bottom:1px solid var(--border)}
.landing-body{flex:1;display:flex;align-items:center;justify-content:center;padding:40px 24px}
.landing-footer{padding:16px 24px;text-align:center;font-size:14px;color:var(--text-muted);border-top:1px solid var(--border);display:flex;align-items:center;justify-content:center;gap:4px;flex-wrap:wrap}

/* ══ SESSION BANNER ══════════════════════════════════════════════════ */
.session-banner{position:fixed;bottom:0;left:0;right:0;z-index:200;background:var(--warn);color:#fff;padding:8px 18px;display:flex;align-items:center;justify-content:center;gap:10px;font-size:12px;font-weight:700;animation:slideUp .3s ease-out}

/* ══ EMPTY STATE ═════════════════════════════════════════════════════ */
.empty-state{text-align:center;padding:36px 20px}
.empty-state-icon{width:44px;height:44px;border-radius:var(--radius-lg);background:var(--surface-alt);display:flex;align-items:center;justify-content:center;margin:0 auto 12px}
.empty-state h3{font-size:13px;font-weight:700;color:var(--text-dark);margin-bottom:4px}
.empty-state p{font-size:12px;color:var(--text-muted);max-width:280px;margin:0 auto 14px;line-height:1.5}

/* ══ APP FOOTER ══════════════════════════════════════════════════════ */
.app-footer{padding:8px 18px;font-size:13px;color:var(--text-muted);border-top:1px solid var(--border);display:flex;align-items:center;gap:10px;flex-wrap:wrap;background:var(--surface);flex-shrink:0}

/* ══ WIZARD STEP NAV ═════════════════════════════════════════════════ */
.step-nav{display:flex;justify-content:flex-end;gap:6px;margin-top:12px;padding-top:10px;border-top:1px solid var(--border-soft)}

/* ══ WIZARD STEP LABEL ════════════════════════════════════════════════ */

/* ══ TOUR GUIDÉE ══════════════════════════════════════════════════════ */
.tour-step{font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--accent);margin-bottom:5px}

/* ══ REDUCED MOTION ═══════════════════════════════════════════════════ */
@media(prefers-reduced-motion:reduce){
  *,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}
  .sidebar,.card{transition:none!important}
  html{scroll-behavior:auto!important}
  .page-anim{animation:none!important}
  .scroll-top{transition:none!important}
  .ob-banner,.toast,.notif-panel,.modal,.popover{animation:none!important}
}
@media(prefers-color-scheme:dark){
  :root:not([data-theme="light"]){
    --bg:#0B0D10;--surface:#141820;--surface-alt:#1B2030;--surface-raised:#1E2438;
    --border:#252C3C;--text-dark:#F0EDE6;--text:#B0ABAA;--text-muted:#808090;
  }
}

/* ══ MEDIUM SCREENS ═══════════════════════════════════════════════════ */
@media(max-width:1024px){
  .grid-4{grid-template-columns:repeat(2,1fr)}
  .landing-body>div{flex-direction:column!important;gap:30px!important}
  .landing-body>div>div:last-child{width:100%!important;max-width:400px;flex-shrink:1!important}
}

/* ══ MOBILE ═══════════════════════════════════════════════════════════ */
@media(max-width:768px){
  .body-wrap{padding-left:0}
  .sidebar{position:fixed;top:0;left:-260px;width:260px;height:100vh;z-index:95;transition:left .22s ease;box-shadow:none}
  .sidebar.open{left:0;width:260px;box-shadow:12px 0 40px rgba(0,0,0,.4)}
  .sidebar:hover{width:260px;box-shadow:none}
  .sidebar-overlay{display:block!important;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:94}
  .sidebar .nav-label,.sidebar .nav-group-label,.sidebar .nav-group svg,.sidebar .sidebar-version,.sidebar .sidebar-pin,.sidebar .device-tag{opacity:1!important;max-width:200px!important}
  .sidebar .nav-group::after{opacity:0!important}
  .hamburger{display:flex!important}
  .main{padding:12px}
  .grid-2{grid-template-columns:1fr}
  .grid-3,.grid-4{grid-template-columns:1fr 1fr}
  .row{gap:8px}
  .header{padding:0 10px;height:46px}
  .search-trigger span,.header-ctx{display:none}
  .mobile-bnav{display:flex!important;position:fixed;bottom:0;left:0;right:0;background:var(--glass);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-top:1px solid var(--border);z-index:80;padding:4px 0 max(4px,env(safe-area-inset-bottom))}
  .mobile-bnav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:5px 4px;border:none;background:none;color:var(--text-muted);font-size:13px;font-weight:700;cursor:pointer;min-height:48px;transition:color var(--tr);text-transform:uppercase;letter-spacing:.2px}
  .mobile-bnav-btn.act{color:var(--accent)}
  .main{padding:12px;padding-bottom:76px!important}
}

/* ══ TOASTS ═══════════════════════════════════════════════════════════ */
.toast-container{position:fixed;bottom:20px;right:20px;z-index:10100;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{
  display:flex;align-items:flex-start;gap:10px;
  padding:12px 16px;
  border-radius:var(--radius);
  background:var(--surface-raised);
  border:1px solid var(--border);
  box-shadow:var(--shadow-lg);
  max-width:340px;min-width:240px;
  animation:toastIn .22s cubic-bezier(.34,1.1,.64,1);
  pointer-events:all;
  font-size:13px;font-weight:500;
  line-height:1.45;
}
@keyframes toastIn{from{opacity:0;transform:translateX(20px) scale(.96)}to{opacity:1;transform:none}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes toastOut{from{opacity:1;transform:none}to{opacity:0;transform:translateX(20px) scale(.96)}}
.toast.removing{animation:toastOut .18s ease forwards}
.toast-icon{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
.toast-title{font-weight:700;font-size:13px;color:var(--text-dark);margin-bottom:1px}
.toast-msg{color:var(--text-muted);font-size:12px}
.toast-close{margin-left:auto;flex-shrink:0;width:22px;height:22px;display:flex;align-items:center;justify-content:center;border-radius:4px;cursor:pointer;color:var(--text-muted);background:none;border:none;transition:background var(--tr)}
.toast-close:hover{background:var(--surface-alt);color:var(--text-dark)}
.toast-success .toast-icon{background:var(--success-bg);color:var(--success)}
.toast-info .toast-icon{background:var(--accent-light);color:var(--accent)}
.toast-warn .toast-icon{background:var(--warn-bg);color:var(--warn)}
.toast-error .toast-icon{background:var(--danger-bg);color:var(--danger)}
.toast-success{border-left:3px solid var(--success)}
.toast-info{border-left:3px solid var(--accent)}
.toast-warn{border-left:3px solid var(--warn)}
.toast-error{border-left:3px solid var(--danger)}

/* ══ TOUR GUIDÉE v2 ══════════════════════════════════════════════════ */
.tour-bubble{background:var(--surface-raised);border:2px solid var(--accent);border-radius:14px;padding:20px;max-width:400px;width:min(400px,calc(100vw - 32px));box-shadow:0 16px 48px rgba(0,0,0,.25);z-index:10001}
.tour-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.tour-icon{width:38px;height:38px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.tour-step-label{font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--accent)}
.tour-title{font-family:var(--font-display);font-size:17px;font-weight:700;color:var(--text-dark);margin-bottom:6px;line-height:1.3}
.tour-desc{font-size:14px;color:var(--text);line-height:1.6;margin-bottom:14px}
.tour-progress{height:5px;background:var(--surface-alt);border-radius:3px;margin-bottom:14px;overflow:hidden}
.tour-progress-fill{height:100%;border-radius:3px;background:var(--accent);transition:width .3s ease}
.tour-footer{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}
.tour-spotlight-ring{position:fixed;pointer-events:none;z-index:9999;border:3px solid var(--accent);border-radius:14px;box-shadow:0 0 0 4000px rgba(0,0,0,.55),0 0 30px rgba(22,80,224,.4);transition:all .3s cubic-bezier(.4,0,.2,1)}


/* ══ WIZARD PROGRESS HEADER ═══════════════════════════════════════════ */
.wizard-progress{
  display:flex;align-items:center;gap:0;margin-bottom:16px;
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius-lg);overflow:hidden;
}
.wiz-step{
  flex:1;padding:10px 14px;display:flex;align-items:center;gap:8px;
  border-right:1px solid var(--border);font-size:13px;font-weight:600;
  cursor:pointer;transition:background var(--tr);color:var(--text-muted);
  position:relative;
}
.wiz-step:last-child{border-right:none}
.wiz-step.done{background:var(--success-bg);color:var(--success)}
.wiz-step.active{background:var(--accent-light);color:var(--accent);font-weight:700}
.wiz-num{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:11px;font-weight:700;flex-shrink:0;background:var(--surface-alt);color:var(--text-muted)}
.wiz-step.done .wiz-num{background:var(--success);color:#fff}
.wiz-step.active .wiz-num{background:var(--accent);color:#fff}

/* ══ ONBOARDING BANNER ═══════════════════════════════════════════════ */
.ob-banner{
  background:linear-gradient(135deg,var(--accent) 0%,#0E3FC0 100%);
  color:#fff;border-radius:var(--radius-lg);padding:18px 22px 18px 20px;
  display:flex;align-items:center;gap:16px;margin-bottom:16px;
  position:relative;overflow:hidden;animation:slideUp .35s ease;
}
.ob-banner::before{content:'';position:absolute;right:-30px;top:-30px;width:130px;height:130px;border-radius:50%;background:rgba(255,255,255,.06)}
.ob-icon{width:48px;height:48px;border-radius:12px;background:rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ob-text{flex:1;min-width:0}
.ob-title{font-family:var(--font-display);font-size:17px;font-weight:700;margin-bottom:4px;line-height:1.3}
.ob-sub{font-size:13px;opacity:.82;line-height:1.4}
.ob-actions{display:flex;gap:8px;flex-shrink:0;align-items:center}
.ob-btn{padding:7px 14px;border-radius:var(--radius-sm);border:none;cursor:pointer;font-size:13px;font-weight:600;font-family:var(--font);transition:color var(--tr),background var(--tr),border-color var(--tr),transform var(--tr);min-height:36px}
.ob-btn-main{background:#fff;color:var(--accent)}
.ob-btn-main:hover{background:rgba(255,255,255,.9)}
.ob-btn-ghost{background:rgba(255,255,255,.12);color:#fff}
.ob-btn-ghost:hover{background:rgba(255,255,255,.22)}
.ob-close{position:absolute;top:10px;right:10px;width:26px;height:26px;border-radius:6px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.1);cursor:pointer;border:none;color:#fff;transition:background var(--tr);font-size:14px;line-height:1}
.ob-close:hover{background:rgba(255,255,255,.22)}

/* ══ NOTIFICATIONS CENTER ════════════════════════════════════════════ */
.notif-bell{position:relative;display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:var(--radius-sm);cursor:pointer;color:var(--text-muted);transition:color var(--tr),background var(--tr);border:none;background:none}
.notif-bell:hover{background:var(--surface-alt);color:var(--text-dark)}
.notif-count{position:absolute;top:4px;right:4px;min-width:16px;height:16px;border-radius:8px;background:var(--danger);color:#fff;font-family:var(--font-mono);font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;padding:0 3px;border:2px solid var(--glass);pointer-events:none}
.notif-panel{position:absolute;top:calc(100% + 8px);right:0;width:340px;background:var(--surface-raised);border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:0 24px 60px rgba(0,0,0,.18);z-index:200;overflow:hidden;animation:popIn .18s ease}
.notif-hdr{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 10px;border-bottom:1px solid var(--border-soft)}
.notif-hdr-title{font-size:14px;font-weight:800;color:var(--text-dark)}
.notif-item{display:flex;align-items:flex-start;gap:10px;padding:11px 16px;border-bottom:1px solid var(--border-soft);cursor:pointer;transition:background var(--tr)}
.notif-item:hover{background:var(--surface-alt)}
.notif-item:last-child{border-bottom:none}
.notif-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:5px}
.notif-body{flex:1;min-width:0}
.notif-msg{font-size:13px;font-weight:600;color:var(--text-dark);line-height:1.35}
.notif-time{font-size:12px;color:var(--text-muted);margin-top:1px}

/* ══ WIZARD PROGRESS ════════════════════════════════════════════════ */
.wiz-progress-wrap{display:flex;align-items:stretch;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;margin-bottom:16px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.wiz-step-item{flex:1;display:flex;align-items:center;gap:10px;padding:11px 14px;border-right:1px solid var(--border);font-size:12px;font-weight:600;color:var(--text-muted);transition:background .2s;position:relative}
.wiz-step-item:last-child{border-right:none}
.wiz-step-item.done{color:var(--success);background:color-mix(in srgb,var(--success) 5%,transparent)}
.wiz-step-item.active{color:var(--accent);background:var(--accent-light);font-weight:700}
.wiz-step-item.active::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--accent);border-radius:0}
.wiz-snum{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:11px;font-weight:700;flex-shrink:0;background:var(--surface-alt);color:var(--text-muted);transition:background .2s,color .2s,border-color .2s}
.wiz-step-item.done .wiz-snum{background:var(--success);color:#fff}
.wiz-step-item.active .wiz-snum{background:var(--accent);color:#fff}

/* ══ SEARCH GLOBAL CMD+K ═════════════════════════════════════════════ */
.search-trigger{display:flex;align-items:center;gap:8px;padding:5px 10px;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface-alt);color:var(--text-muted);cursor:pointer;transition:border-color var(--tr),background var(--tr),color var(--tr);font-size:13px;height:36px;white-space:nowrap}
.search-trigger:hover{border-color:var(--accent);background:var(--surface-raised)}
.search-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:9500;display:flex;align-items:flex-start;justify-content:center;padding-top:80px;animation:fadeIn .15s ease}
.search-box{width:min(560px,calc(100vw - 32px));background:var(--surface-raised);border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:0 32px 80px rgba(0,0,0,.22);overflow:hidden;animation:modalIn .2s cubic-bezier(.34,1.1,.64,1)}
.search-input-row{display:flex;align-items:center;gap:10px;padding:14px 18px;border-bottom:1px solid var(--border-soft)}
.search-input-row input{flex:1;border:none;background:none;font-size:16px;font-family:var(--font);color:var(--text-dark);outline:none}
.search-input-row input::placeholder{color:var(--text-light)}
.search-results{max-height:360px;overflow-y:auto}
.search-result-item{display:flex;align-items:center;gap:12px;padding:10px 18px;cursor:pointer;transition:background .12s}
.search-result-item:hover,.search-result-item.sel{background:var(--accent-light)}
.search-result-item.sel .sr-name{color:var(--accent)}
.sr-icon{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;background:var(--surface-alt);transition:background .12s}
.search-result-item.sel .sr-icon{background:color-mix(in srgb,var(--accent) 12%,transparent)}
.sr-name{font-size:14px;font-weight:600;color:var(--text-dark)}
.sr-sub{font-size:12px;color:var(--text-muted);margin-top:1px}


/* ══ CONFIRM DIALOG ══════════════════════════════════════════════════ */
.confirm-dialog{padding:4px 0 8px}
.confirm-icon-wrap{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 14px}
.confirm-dialog-title{font-family:var(--font-display);font-size:18px;font-weight:700;color:var(--text-dark);text-align:center;margin-bottom:8px}
.confirm-dialog-msg{font-size:14px;color:var(--text-muted);text-align:center;line-height:1.6}

/* ══ LIVE TIMER ══════════════════════════════════════════════════════ */
.live-timer{display:flex;align-items:center;gap:6px;font-family:var(--font-mono);font-size:15px;font-weight:700;color:var(--text-muted)}
.live-timer-val{color:var(--text-dark);letter-spacing:.5px}

/* ══ SEARCH BAR ═════════════════════════════════════════════════════ */
.search-bar-row{display:flex;gap:8px;margin-bottom:12px;align-items:center;flex-wrap:wrap}
.search-bar-wrap{position:relative;flex:1;max-width:320px}
.search-bar-wrap .field-input{padding-left:34px}

/* ══ HEADER PAGE CONTEXT ═════════════════════════════════════════════ */
.header-ctx{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-muted);padding:4px 9px;border-radius:var(--radius-sm);background:var(--surface-alt);border:1px solid var(--border-soft)}
.header-ctx-name{font-weight:700;color:var(--text-dark);font-size:13px}

/* ══ LANDING STATS ═══════════════════════════════════════════════════ */
/* (landing-stats removed — simplified landing page) */

/* ══ TEXT SELECTION ══════════════════════════════════════════════════ */
::selection{background:var(--accent-light);color:var(--accent-dark)}
html{scroll-behavior:smooth}

/* ══ SKIP LINK ═══════════════════════════════════════════════════════ */
.skip-link{position:absolute;top:-100px;left:12px;z-index:10200;background:var(--accent);color:#fff;padding:8px 16px;border-radius:var(--radius-sm);font-weight:700;font-size:14px;transition:top .15s;text-decoration:none}
.skip-link:focus{top:8px}

/* ══ FOCUS RING ══════════════════════════════════════════════════════ */
:focus-visible{outline:none;box-shadow:var(--shadow-focus);border-radius:var(--radius-sm)}
button:focus-visible,a:focus-visible{border-radius:var(--radius-sm)}
input:focus-visible,select:focus-visible,textarea:focus-visible{border-radius:var(--radius)}

/* ══ WIZARD STEP CARD ════════════════════════════════════════════════ */
.wf-step{background:var(--accent);color:#fff;border-radius:var(--radius-sm) var(--radius-sm) 0 0;padding:8px 14px;display:flex;align-items:center;gap:8px;font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:.6px;margin:-14px -14px 12px;width:calc(100% + 28px)}

/* ══ MOBILE BOTTOM NAV ═══════════════════════════════════════════════ */
@media(min-width:769px){.mobile-bnav{display:none!important}}

/* ══ SMALL MOBILE ════════════════════════════════════════════════════ */
@media(max-width:480px){
  .grid-3,.grid-4{grid-template-columns:1fr}
  .grid-2{grid-template-columns:1fr}
  .row{flex-direction:column}
  .page-title{font-size:16px}
  .stepper{gap:4px}
  .step-text{font-size:11px}
  .card{padding:10px}
  .btn-sm{padding:4px 8px;font-size:12px;min-height:28px}
  .flex-between{flex-wrap:wrap;gap:8px}
  .breadcrumb{font-size:11px}
}

/* ══ SCROLL TO TOP ══════════════════════════════════════════════════ */
.scroll-top{position:fixed;bottom:24px;right:24px;z-index:90;width:40px;height:40px;border-radius:var(--radius-full);background:var(--surface-raised);border:1px solid var(--border);box-shadow:var(--shadow-md);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-muted);transition:opacity .2s,transform .2s,background .15s;opacity:0;transform:translateY(8px);pointer-events:none}
.scroll-top.visible{opacity:1;transform:none;pointer-events:all}
.scroll-top:hover{background:var(--accent);color:#fff;border-color:var(--accent)}

/* ══ OPERATOR KBD HINTS ══════════════════════════════════════════════ */
.op-kbd{display:inline-flex;align-items:center;font-family:var(--font-mono);font-size:10px;padding:1px 4px;border-radius:3px;background:rgba(0,0,0,.07);border:1px solid var(--border);color:var(--text-muted);margin-left:5px;vertical-align:middle;line-height:1.4}
[data-theme="dark"] .op-kbd{background:rgba(255,255,255,.06)}

/* ══ TOOLTIP ════════════════════════════════════════════════════════ */
.tip-wrap{position:relative;display:inline-flex;align-items:center}
.tip-body{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%) translateY(4px);background:var(--text-dark);color:var(--surface-raised);font-size:12px;font-weight:600;white-space:nowrap;padding:4px 8px;border-radius:5px;opacity:0;visibility:hidden;transition:opacity .15s ease,visibility .15s ease,transform .15s ease;pointer-events:none;z-index:500;box-shadow:var(--shadow-md)}
.tip-body::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:4px solid transparent;border-top-color:var(--text-dark)}
.tip-wrap:hover .tip-body,.tip-wrap:focus-within .tip-body{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}

/* ══ PRINT ═══════════════════════════════════════════════════════════ */
@media print{
  .sidebar,.header,.app-footer,.toast-container,.notif-bell,.search-trigger,.theme-toggle,.hamburger,.mobile-bnav,.no-print,.scroll-top,.ob-banner{display:none!important}
  .print-only{display:block!important}
  .main{padding:0!important}
  .card{break-inside:avoid;border:1px solid #ccc!important;box-shadow:none!important}
  body{background:#fff!important;color:#000!important}
}
.print-only{display:none}
</style>
</head>
<body data-theme="light">
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">

const {useState,Fragment,useEffect,useRef}=React;
const LI=({name,size=18,color="currentColor"})=>{const p={
home:<><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>,
calendar:<><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></>,
users:<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>,
check:<><path d="M20 6 9 17l-5-5"/></>,x:<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>,
plus:<><path d="M5 12h14"/><path d="M12 5v14"/></>,plusCircle:<><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></>,
info:<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>,
shield:<><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></>,
fileText:<><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></>,
play:<><polygon points="6 3 20 12 6 21 6 3"/></>,stop:<><rect width="14" height="14" x="5" y="5" rx="1"/></>,
archive:<><rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"/><path d="M10 12h4"/></>,
settings:<><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></>,
upload:<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>,
chevR:<><path d="m9 18 6-6-6-6"/></>,chevL:<><path d="m15 18-6-6 6-6"/></>,
eye:<><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7S2 12 2 12Z"/><circle cx="12" cy="12" r="3"/></>,
alertTriangle:<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></>,
clipboard:<><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></>,
monitor:<><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></>,
smartphone:<><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></>,
vote:<><path d="m9 12 2 2 4-4"/><path d="M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z"/><path d="M22 19H2"/></>,
download:<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>,
user:<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
userPlus:<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></>,
lock:<><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>,
unlock:<><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></>,
send:<><path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"/><path d="m21.854 2.147-10.94 10.939"/></>,
hand:<><path d="M18 11V6a2 2 0 0 0-4 0v3"/><path d="M14 10V4a2 2 0 0 0-4 0v7"/><path d="M10 10.5V2a2 2 0 0 0-4 0v9"/><path d="M7 15a6 6 0 0 0 12 0v-5a2 2 0 0 0-4 0"/></>,
thumbsUp:<><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"/></>,
thumbsDown:<><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"/></>,
minusCircle:<><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></>,
mic:<><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></>,
micOff:<><line x1="2" x2="22" y1="2" y2="22"/><path d="M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"/><path d="M5 10v2a7 7 0 0 0 12 5.29"/><path d="M15 9.34V5a3 3 0 0 0-5.68-1.33"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12"/><line x1="12" x2="12" y1="19" y2="22"/></>,
checkCircle:<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></>,
clock:<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>,
bellRing:<><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></>,
listOrdered:<><line x1="10" x2="21" y1="6" y2="6"/><line x1="10" x2="21" y1="12" y2="12"/><line x1="10" x2="21" y1="18" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/></>,
activity:<><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></>,
lightbulb:<><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></>,
layers:<><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></>,
inbox:<><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></>,
refreshCw:<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></>,
moreHorizontal:<><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></>,
wifi:<><path d="M12 20h.01"/><path d="M2 8.82a15 15 0 0 1 20 0"/><path d="M5 12.859a10 10 0 0 1 14 0"/><path d="M8.5 16.429a5 5 0 0 1 7 0"/></>,
wifiOff:<><path d="M12 20h.01"/><path d="m8.5 16.429 3.5 3.571"/><path d="M2 2l20 20"/><path d="M5 12.859C5.86 12.17 6.81 11.6 7.82 11.16"/><path d="M15.54 12.53c.84.33 1.63.78 2.35 1.33"/></>,
battery:<><rect width="16" height="10" x="2" y="7" rx="2" ry="2"/><line x1="22" x2="22" y1="11" y2="13"/></>,
batteryLow:<><rect width="16" height="10" x="2" y="7" rx="2" ry="2"/><line x1="22" x2="22" y1="11" y2="13"/><line x1="6" x2="6" y1="10" y2="14"/></>,
zap:<><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></>,
signal:<><path d="M2 20h.01"/><path d="M7 20v-4"/><path d="M12 20v-8"/><path d="M17 20V8"/></>,
edit:<><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></>,
key:<><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"/><path d="m21 2-9.6 9.6"/><circle cx="7.5" cy="15.5" r="5.5"/></>,
globe:<><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></>,
scale:<><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></>,
mail:<><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></>,
sun:<><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></>,
moon:<><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></>,
pieChart:<><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></>,
logIn:<><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></>,
mapPin:<><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/><circle cx="12" cy="10" r="3"/></>,
circle:<><circle cx="12" cy="12" r="10"/></>,
chevDown:<><path d="m6 9 6 6 6-6"/></>,
chevUp:<><path d="m18 15-6-6-6 6"/></>,
externalLink:<><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></>,
};return <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{flexShrink:0}}>{p[name]||p.info}</svg>};
const ico=(n,s=16)=><LI name={n} size={s}/>;
/* RGAA 3.1 — icône + couleur pour les tags de statut (pas couleur seule) */
const STATUS_ICO={"Convocations":"send","En cours":"play","Terminé":"checkCircle","PV envoyé":"checkCircle","Archivée":"archive","Brouillon":"edit","Annulée":"x","En attente":"clock","Adoptée":"check","Rejetée":"x","Reportée":"clock","Unanimité":"check"};
const sIco=(label,sz=11)=>{const name=STATUS_ICO[label];return name?<><LI name={name} size={sz} aria-hidden="true"/> {label}</>:label};
/* HelpTip — createPortal : sort du DOM card, jamais clippé, zéro cas particulier CSS */
const HelpTip=({text})=>{
  const[show,setShow]=useState(false);
  const[style,setStyle]=useState({});
  const ref=useRef(null);
  const compute=()=>{
    if(!ref.current)return;
    const r=ref.current.getBoundingClientRect();
    const above=r.top>140;
    setStyle({
      position:'fixed',
      left:Math.max(8,Math.min(r.left+r.width/2-120,window.innerWidth-248)),
      top:above?r.top-8:r.bottom+8,
      transform:above?'translateY(-100%)':'none',
      background:'var(--sidebar-bg)',color:'#fff',
      padding:'10px 14px',borderRadius:8,fontSize:13,fontWeight:500,
      width:240,boxShadow:'var(--shadow-lg)',lineHeight:1.45,
      zIndex:9999,pointerEvents:'none',
    });
  };
  const open=()=>{compute();setShow(true);};
  return(
    <span ref={ref} className="htip" tabIndex={0} aria-label={text}
      onMouseEnter={open} onMouseLeave={()=>setShow(false)}
      onFocus={open} onBlur={()=>setShow(false)}
      onKeyDown={e=>e.key==='Escape'&&setShow(false)}>
      ?
      {show&&ReactDOM.createPortal(
        <span className="htip-portal" style={style} role="status">{text}</span>,
        document.body
      )}
    </span>
  );
};

const Donut=({segments,size=120,label,thick,centerValue,centerLabel})=>{const sw=thick||Math.round(size/8);const r=size/2-sw/2-2,cx=size/2,cy=size/2,C=2*Math.PI*r;let o=0;return(<svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}><circle cx={cx} cy={cy} r={r} fill="none" stroke="var(--tag-bg)" strokeWidth={sw} opacity=".4"/>{segments.map((s,i)=>{const d=(s.pct/100)*C,off=o;o+=d;return<circle key={i} cx={cx} cy={cy} r={r} fill="none" stroke={s.color} strokeWidth={sw} strokeDasharray={`${d} ${C-d}`} strokeDashoffset={-off} strokeLinecap="round" style={{transform:"rotate(-90deg)",transformOrigin:"center"}}/>})}{centerValue&&<text x={cx} y={cy+(centerLabel?-4:5)} textAnchor="middle" fill="var(--text-dark)" fontSize={Math.round(size/4.5)} fontWeight="800" fontFamily="DM Sans">{centerValue}</text>}{centerLabel&&<text x={cx} y={cy+Math.round(size/7)} textAnchor="middle" fill="var(--text-muted)" fontSize={Math.round(size/10)} fontWeight="600" fontFamily="DM Sans">{centerLabel}</text>}{label&&!centerValue&&<><text x={cx} y={cy+5} textAnchor="middle" fill="var(--text-dark)" fontSize={Math.round(size/5)} fontWeight="800" fontFamily="DM Sans">{segments.reduce((a,s)=>a+(s.count||0),0)||""}</text></>}</svg>)};
const TimeInput=()=>{
  const[hh,setHH]=useState("");const[mm,setMM]=useState("");const[err,setErr]=useState("");
  const hhRef=useRef(null);const mmRef=useRef(null);
  const valH=v=>{const n=parseInt(v,10);return v===""||(!isNaN(n)&&n>=0&&n<=23&&v.length<=2)};
  const valM=v=>{const n=parseInt(v,10);return v===""||(!isNaN(n)&&n>=0&&n<=59&&v.length<=2)};
  const onHH=e=>{const v=e.target.value.replace(/\D/g,"").slice(0,2);if(valH(v)){setHH(v);setErr("");if(v.length===2){if(parseInt(v,10)>23){setErr("Heure : 00–23");setHH(v.slice(0,1));return}mmRef.current&&mmRef.current.focus()}}};
  const onMM=e=>{const v=e.target.value.replace(/\D/g,"").slice(0,2);if(valM(v)){setMM(v);setErr("");if(v.length===2&&parseInt(v,10)>59){setErr("Minutes : 00–59");setMM(v.slice(0,1))}}};
  const onHHKey=e=>{if(e.key==="ArrowRight"&&hhRef.current.selectionStart>=hh.length){mmRef.current&&mmRef.current.focus()}};
  const onMMKey=e=>{if(e.key==="Backspace"&&mm===""){hhRef.current&&hhRef.current.focus()}if(e.key==="ArrowLeft"&&mmRef.current.selectionStart===0){hhRef.current&&hhRef.current.focus()}};
  const onPaste=e=>{e.preventDefault();const txt=(e.clipboardData||window.clipboardData).getData("text").trim();const m=txt.match(/^(\d{1,2})\s*[h:]\s*(\d{1,2})$/i)||txt.match(/^(\d{2})(\d{2})$/);if(m){const h=m[1].padStart(2,"0"),mi=m[2].padStart(2,"0");if(parseInt(h)<=23&&parseInt(mi)<=59){setHH(h);setMM(mi);setErr("")}else{setErr("Format invalide")}}else{setErr("Format attendu : HH:MM")}};
  const onBlurH=()=>{if(hh.length===1)setHH(hh.padStart(2,"0"))};
  const onBlurM=()=>{if(mm.length===1)setMM(mm.padStart(2,"0"))};
  return(<div><div style={{display:"flex",alignItems:"center",gap:0,maxWidth:120}}><input ref={hhRef} className="field-input" value={hh} onChange={onHH} onKeyDown={onHHKey} onPaste={onPaste} onBlur={onBlurH} placeholder="HH" inputMode="numeric" maxLength={2} autoComplete="off" aria-label="Heures" style={{width:44,textAlign:"center",marginBottom:0,borderRadius:"var(--radius-sm) 0 0 var(--radius-sm)",borderRight:"none",minHeight:42,fontSize:15,fontFamily:"var(--font-mono)",fontWeight:700,letterSpacing:1}}/><span style={{background:"var(--surface-alt)",border:"1px solid var(--border)",borderLeft:"none",borderRight:"none",padding:"0 3px",fontSize:18,fontWeight:800,color:"var(--text-muted)",lineHeight:"40px",height:42,display:"flex",alignItems:"center",userSelect:"none"}}>:</span><input ref={mmRef} className="field-input" value={mm} onChange={onMM} onKeyDown={onMMKey} onPaste={onPaste} onBlur={onBlurM} placeholder="MM" inputMode="numeric" maxLength={2} autoComplete="off" aria-label="Minutes" style={{width:44,textAlign:"center",marginBottom:0,borderRadius:"0 var(--radius-sm) var(--radius-sm) 0",borderLeft:"none",minHeight:42,fontSize:15,fontFamily:"var(--font-mono)",fontWeight:700,letterSpacing:1}}/></div>{err&&<div style={{fontSize:12,color:"var(--danger)",marginTop:3,fontWeight:600}}>{ico("alertTriangle",12)} {err}</div>}</div>);
};
const CTA=({placeholder,max=2000,rows=3,style={}})=>{
  const[val,setVal]=useState("");const len=val.length;const pct=len/max*100;
  return(<div><textarea className="field-input" placeholder={placeholder} maxLength={max} rows={rows} value={val} onChange={e=>setVal(e.target.value)} onBlur={e=>setVal(e.target.value.trim())} style={{...style,marginBottom:0}}/>{max&&<div className={`field-counter${pct>90?" warn":""}${pct>=100?" over":""}`}>{len} / {max}</div>}</div>);
};
const AVATAR_COLORS=["#4F46E5","#0891B2","#059669","#D97706","#DC2626","#7C3AED","#DB2777","#2563EB"];
const Av=({name,size})=>{const i=name?name.charCodeAt(0)%AVATAR_COLORS.length:0;const init=name?name.split(" ").filter(Boolean).map(w=>w[0]).join("").slice(0,2).toUpperCase():"?";const s=size==="sm"?"avatar-sm":size==="lg"?"avatar-lg":"";return(<div className={`avatar ${s}`} style={{background:AVATAR_COLORS[i]}} title={name}>{init}</div>)};
const TZ_LIST=[
  "Pacific/Midway (UTC−11)","Pacific/Honolulu (UTC−10)","Pacific/Tahiti (UTC−10)","America/Anchorage (UTC−9)","America/Los_Angeles (UTC−8)","America/Denver (UTC−7)","America/Chicago (UTC−6)","America/New_York (UTC−5)","America/Caracas (UTC−4:30)","America/Halifax (UTC−4)","America/Martinique (UTC−4)","America/Guadeloupe (UTC−4)","America/St_Johns (UTC−3:30)","America/Guyane (UTC−3)","America/Miquelon (UTC−3)","America/Sao_Paulo (UTC−3)","America/Noronha (UTC−2)","Atlantic/Azores (UTC−1)","Europe/London (UTC+0)","Europe/Paris (UTC+1)","Europe/Berlin (UTC+1)","Europe/Bruxelles (UTC+1)","Europe/Zurich (UTC+1)","Africa/Tunis (UTC+1)","Africa/Lagos (UTC+1)","Europe/Athènes (UTC+2)","Europe/Bucarest (UTC+2)","Africa/Le Caire (UTC+2)","Africa/Johannesburg (UTC+2)","Europe/Istanbul (UTC+3)","Europe/Moscou (UTC+3)","Asia/Riyad (UTC+3)","Africa/Nairobi (UTC+3)","Indian/Mayotte (UTC+3)","Asia/Téhéran (UTC+3:30)","Asia/Dubaï (UTC+4)","Indian/Réunion (UTC+4)","Indian/Maurice (UTC+4)","Asia/Kaboul (UTC+4:30)","Asia/Karachi (UTC+5)","Indian/Kerguelen (UTC+5)","Asia/Calcutta (UTC+5:30)","Asia/Katmandou (UTC+5:45)","Asia/Dacca (UTC+6)","Asia/Rangoun (UTC+6:30)","Asia/Bangkok (UTC+7)","Asia/Ho_Chi_Minh (UTC+7)","Asia/Shanghai (UTC+8)","Asia/Hong_Kong (UTC+8)","Asia/Singapour (UTC+8)","Asia/Taipei (UTC+8)","Asia/Tokyo (UTC+9)","Asia/Séoul (UTC+9)","Australia/Darwin (UTC+9:30)","Australia/Sydney (UTC+10)","Pacific/Nouméa (UTC+11)","Pacific/Wallis (UTC+12)","Pacific/Auckland (UTC+12)","Pacific/Fidji (UTC+12)","Pacific/Tongatapu (UTC+13)"
];
const TZPicker=({value="Europe/Paris (UTC+1)",onChange})=>{
  const[open,setOpen]=useState(false);const[q,setQ]=useState("");const[sel,setSel]=useState(value);const ref=useRef(null);
  const filtered=q.length>0?TZ_LIST.filter(t=>t.toLowerCase().includes(q.toLowerCase())):TZ_LIST;
  useEffect(()=>{const h=e=>{if(ref.current&&!ref.current.contains(e.target))setOpen(false)};document.addEventListener("mousedown",h);return()=>document.removeEventListener("mousedown",h)},[]);
  return(<div ref={ref} style={{position:"relative"}}>
    <button type="button" className="field-input" onClick={()=>{setOpen(!open);setQ("")}} style={{textAlign:"left",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",background:"var(--surface)"}} aria-haspopup="listbox" aria-expanded={open}><span style={{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{sel}</span><LI name="chevD" size={14} color="var(--text-muted)"/></button>
    {open&&<div style={{position:"absolute",top:"calc(100% + 4px)",left:0,right:0,background:"var(--surface-raised)",border:"1px solid var(--border)",borderRadius:"var(--radius)",boxShadow:"var(--shadow-md)",zIndex:300,maxHeight:260,display:"flex",flexDirection:"column"}} role="listbox" aria-label="Fuseaux horaires">
      <div style={{padding:"6px 8px",borderBottom:"1px solid var(--border-soft)",flexShrink:0}}><input className="field-input" placeholder="Rechercher un fuseau…" value={q} onChange={e=>setQ(e.target.value)} autoFocus style={{minHeight:32,fontSize:13}} aria-label="Filtrer les fuseaux horaires"/></div>
      <div style={{overflowY:"auto",flex:1}}>{filtered.length===0?<div style={{padding:"12px 10px",fontSize:13,color:"var(--text-muted)",textAlign:"center"}}>Aucun résultat</div>:filtered.map(tz=>(<div key={tz} role="option" aria-selected={tz===sel} onClick={()=>{setSel(tz);setOpen(false);onChange&&onChange(tz)}} style={{padding:"7px 10px",fontSize:13,cursor:"pointer",background:tz===sel?"var(--accent-light)":"transparent",color:tz===sel?"var(--accent)":"var(--text)",fontWeight:tz===sel?600:400,transition:"background .1s"}} onMouseEnter={e=>e.currentTarget.style.background=tz===sel?"var(--accent-light)":"var(--surface-alt)"} onMouseLeave={e=>e.currentTarget.style.background=tz===sel?"var(--accent-light)":"transparent"}>{tz}</div>))}</div>
    </div>}
  </div>);
};
const Popover=({trigger,items=[]})=>{const[o,setO]=useState(false);const ref=useRef(null);useEffect(()=>{const h=e=>{if(ref.current&&!ref.current.contains(e.target))setO(false)};document.addEventListener("mousedown",h);return()=>document.removeEventListener("mousedown",h)},[]);return(<div className="popover-wrap" ref={ref}><div onClick={()=>setO(!o)} style={{display:"inline-flex"}}>{trigger}</div>{o&&<div className="popover">{items.map((it,i)=>it==="sep"?<div key={i} className="sep"/>:<div key={i} className="mi" onClick={()=>setO(false)}><LI name={it.icon||"info"} size={14}/><span>{it.label}</span></div>)}</div>}</div>)};
const Modal=({title,children,footer,onClose})=>{const ref=useRef(null);useEffect(()=>{const prev=document.activeElement;const el=ref.current;if(el){const focusable=el.querySelectorAll('button,input,select,textarea,[tabindex]:not([tabindex="-1"])');if(focusable.length)focusable[0].focus();const trap=e=>{if(e.key==="Tab"){const first=focusable[0],last=focusable[focusable.length-1];if(e.shiftKey&&document.activeElement===first){e.preventDefault();last.focus()}else if(!e.shiftKey&&document.activeElement===last){e.preventDefault();first.focus()}}if(e.key==="Escape")onClose()};el.addEventListener("keydown",trap);return()=>{el.removeEventListener("keydown",trap);prev&&prev.focus()}}},[]); return(<div className="overlay-backdrop" onMouseDown={e=>{if(e.target===e.currentTarget)onClose()}} role="presentation"><div className="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" ref={ref}><div className="modal-h"><div className="t" id="modal-title">{title}</div><button className="btn btn-ghost btn-sm" onClick={onClose} aria-label="Fermer"><LI name="x" size={14}/></button></div><div className="modal-b">{children}</div>{footer&&<div className="modal-f">{footer}</div>}</div></div>)};
const Stepper=({steps,current,onStep})=>(<div className="stepper">{steps.map((s,i)=>(<Fragment key={i}><div className="step-col" onClick={()=>{if(i<=current&&onStep)onStep(i)}} style={{cursor:i<=current?"pointer":"default"}}><div className={`step-dot${i<current?" done":i===current?" active":""}`}>{i<current?<LI name="check" size={14} color="#fff"/>:i+1}</div><div className={`step-text${i===current?" active":i<current?" done":""}`}>{s}</div></div>{i<steps.length-1&&<div className={`step-line${i<current?" done":""}`}/>}</Fragment>))}</div>);
const Pg=({n=3,c=1})=>(<div className="pagination">{Array.from({length:n},(_,i)=>(<button key={i} className={`pg-btn${i+1===c?" pg-active":""}`}>{i+1}</button>))}</div>);
const CRUMBS={
  dashboard:{path:["Tableau de bord"]},
  seances:{path:["Préparation","Séances"]},
  membres:{path:["Préparation","Membres"]},
  wizard:{path:["Préparation","Créer une séance"]},
  hub:{path:["Séance en direct","Fiche séance"]},
  operator:{path:["Séance en direct","Opérateur"]},
  ecran:{path:["Séance en direct","Affichage salle"]},
  postsession:{path:["Après la séance","Clôture et PV"]},
  archives:{path:["Après la séance","Archives"]},
  audit:{path:["Contrôle","Audit"]},
  stats:{path:["Contrôle","Statistiques"]},
  utilisateurs:{path:["Système","Utilisateurs"]},
  parametres:{path:["Système","Paramètres"]},
  aide:{path:["Guide et FAQ"]},
};
const Breadcrumb=({page})=>{const cr=CRUMBS[page];if(!cr||cr.path.length<2)return null;return(<nav className="breadcrumb" aria-label="Fil d'Ariane">{cr.path.map((p,i)=>(<React.Fragment key={i}>{i>0&&<span className="bc-sep">/</span>}{i<cr.path.length-1?<span className="bc-item">{p}</span>:<span className="bc-item bc-current" aria-current="page">{p}</span>}</React.Fragment>))}</nav>)};
const PH=({icon,title,sub,right,page})=>(<div style={{marginBottom:16}}><Breadcrumb page={page}/><div className="flex-between"><div><div className="page-title"><span className="bar"/>{ico(icon)} {title}</div>{sub&&<div className="page-sub">{sub}</div>}</div>{right&&<div className="flex-row">{right}</div>}</div></div>);
const NAV=[
  {group:"Préparation",items:[{label:"Tableau de bord",icon:"home",page:"dashboard"},{label:"Séances",icon:"calendar",page:"seances"},{label:"Membres",icon:"users",page:"membres"},{label:"Créer une séance",icon:"plusCircle",page:"wizard"}]},
  {group:"Séance en direct",items:[{label:"Fiche séance",icon:"clipboard",page:"hub",badge:12},{label:"Opérateur",icon:"play",page:"operator"},{label:"Affichage salle",icon:"monitor",page:"ecran"}]},
  {group:"Après la séance",items:[{label:"Clôture et PV",icon:"fileText",page:"postsession",badge:3},{label:"Archives",icon:"archive",page:"archives"}]},
  {group:"Contrôle",items:[{label:"Audit",icon:"shield",page:"audit"},{label:"Statistiques",icon:"pieChart",page:"stats"}]},
  {group:"Système",items:[{label:"Utilisateurs",icon:"key",page:"utilisateurs"},{label:"Paramètres",icon:"settings",page:"parametres"}]},
];
/* Page votant affichee sur tablette — accessible en aperçu depuis le sidebar */
const DEVICE_PREVIEWS=[
  {label:"Aperçu votant",icon:"smartphone",page:"votant",device:"Tablette"},
];

/* ═══ GUIDED TOUR — ciblage DOM réel ═══ */
const tourSteps={
  dashboard:[
    {target:"action-urgente",icon:"alertTriangle",title:"Action urgente",desc:"La carte rouge en haut signale la prochaine tâche à traiter. Cliquez dessus pour y accéder directement — c'est votre priorité du moment."},
    {target:"kpi-row",icon:"activity",title:"Vos indicateurs en un coup d'œil",desc:"Ces 4 chiffres résument l'état de votre activité : séances à venir, en cours, convocations à envoyer, PV à finaliser. Chaque carte est cliquable."},
    {target:"card-taches",icon:"clipboard",title:"Liste des tâches",desc:"Vos tâches sont classées par urgence. La plus urgente est en haut avec un indicateur coloré. Traitez-les dans l'ordre pour ne rien oublier."},
    {target:"card-raccourcis",icon:"plusCircle",title:"Accès rapides",desc:"Trois raccourcis vers les fonctions les plus utilisées. Créer une séance, piloter un vote, ou consulter les statistiques — en un seul clic."},
  ],
  wizard:[
    {target:"wizard-step1",icon:"listOrdered",title:"Informations de la séance",desc:"Remplissez le titre, la date et le lieu. Les champs avec une étoile rouge (*) sont obligatoires. Le système calcule automatiquement la date limite de convocation."},
  ],
  operator:[
    {target:"op-header",icon:"play",title:"Barre de séance",desc:"Le point vert confirme que la séance est en direct. Le chronomètre affiche la durée. « Salle » ouvre le vidéoprojecteur, « Clôturer » termine la séance."},
    {target:"op-kpi",icon:"activity",title:"Indicateurs en direct",desc:"Quatre chiffres essentiels mis à jour en temps réel : présents, quorum, votes exprimés, et résolution en cours. Ils changent automatiquement."},
    {target:"op-track",icon:"layers",title:"Barre de progression",desc:"Chaque segment = une résolution. Vert = votée, bleu = en cours, gris = à venir. Cliquez sur un segment pour revenir consulter une résolution passée."},
    {target:"op-résolution",icon:"vote",title:"Résolution en cours",desc:"Le cœur de l'opérateur. Titre, barres de résultat en direct, boutons d'action. Tout se passe ici — pas besoin de scroller."},
    {target:"op-tabs",icon:"settings",title:"Onglets contextuels",desc:"« Résultat » : votes en cours. « Avancé » : comptage papier, votes manquants, notes. « Présences » : entrées et sorties. Changez d'onglet selon le besoin."},
    {target:"op-actions",icon:"check",title:"Boutons d'action",desc:"« Proclamer » valide et passe automatiquement à la résolution suivante. « Fermer le vote » bloque les votes. Ce sont vos 2 boutons principaux."},
    {target:"op-odj",icon:"clipboard",title:"Ordre du jour",desc:"Liste complète des résolutions, toujours visible. Cliquez sur une résolution passée pour revoir ses résultats. Les demandes de parole s'affichent en bas."},
    {target:"op-guidance",icon:"lightbulb",title:"Aide contextuelle",desc:"Cette barre bleue vous dit toujours quoi faire. Elle s'adapte en temps réel. Suivez ses conseils pour ne jamais être perdu !"},
  ],
  membres:[
    {target:"membres-table",icon:"users",title:"Liste des membres",desc:"Tous les votants avec leur nom, lot et poids de vote. Le «—» signifie que le membre ne vote pas sur cette clé. Cliquez sur un nom pour voir son détail."},
  ],
  hub:[
    {target:"hub-etat",icon:"activity",title:"Progression de la séance",desc:"La barre colorée montre l'avancement. Chaque segment = une étape. Cliquez « Étape suivante » pour avancer dans le processus."},
    {target:"hub-action",icon:"play",title:"Action principale",desc:"La carte encadrée en couleur = l'action la plus importante maintenant. Cliquez dessus pour y accéder directement."},
    {target:"hub-kpi",icon:"activity",title:"Statistiques",desc:"Quatre indicateurs : participants, résolutions, quorum requis, convocations. Vérifiez que tout est au vert avant de démarrer."},
    {target:"hub-prepa",icon:"checkCircle",title:"Préparation",desc:"La checklist montre les tâches préparatoires. Les documents associés sont à droite. Téléchargez et vérifiez que tout est prêt."},
  ],
  stats:[
    {target:"stats-kpi",icon:"activity",title:"Vue d'ensemble",desc:"Les 4 indicateurs : séances, résolutions, taux d'adoption, participation. Les flèches montrent la tendance vs l'année précédente."},
    {target:"stats-chart",icon:"vote",title:"Analyse graphique",desc:"Le donut montre la répartition Pour/Contre/Abstention. Le graphique de participation identifie les tendances sur l'année."},
  ],
  postsession:[
    {target:"ps-stepper",icon:"checkCircle",title:"Étapes de clôture",desc:"Quatre étapes à valider pour clore la séance : résultats, signatures, diffusion et archivage. Avancez dans l'ordre — chaque étape se déverrouille après la précédente."},
    {target:"ps-actions",icon:"fileText",title:"Actions disponibles",desc:"Téléchargez le PV, demandez les signatures électroniques, puis envoyez le document final à tous les participants. Le bouton principal indique l'action du moment."},
  ],
  postsession:[
    {target:"ps-stepper",icon:"listOrdered",title:"Les 4 étapes de clôture",desc:"Vérification, validation, PV, envoi. Suivez l'ordre — le bouton « Suivant » vous guide d'étape en étape."},
  ],
};


/* ═══ CONFIRM DIALOG ═══ */
const ConfirmDialog=({open,type="danger",title,msg,onConfirm,onCancel})=>{
  if(!open)return null;
  const colorMap={danger:["var(--danger)","var(--danger-bg)","btn-danger","alertTriangle"],warn:["var(--warn)","var(--warn-bg)","btn-warn","alertCircle"],info:["var(--accent)","var(--accent-light)","btn-p","helpCircle"]};
  const[color,bg,btnCls,iconName]=colorMap[type]||colorMap.danger;
  return(<Modal title="" onClose={onCancel} footer={<><button className="btn" onClick={onCancel}>Annuler</button><button className={`btn ${btnCls}`} autoFocus onClick={onConfirm}>{ico(iconName,14)} Confirmer</button></>}>
    <div className="confirm-dialog">
      <div className="confirm-icon-wrap" style={{background:bg}}><LI name={iconName} size={28} color={color}/></div>
      <div className="confirm-dialog-title">{title}</div>
      <div className="confirm-dialog-msg">{msg}</div>
    </div>
  </Modal>);
};
const useConfirm=()=>{
  const[st,setSt]=useState({open:false,type:"danger",title:"",msg:"",res:null});
  const confirm=(title,msg,type="danger")=>new Promise(r=>setSt({open:true,type,title,msg,res:r}));
  const ok=()=>{st.res&&st.res(true);setSt(s=>({...s,open:false}))};
  const no=()=>{st.res&&st.res(false);setSt(s=>({...s,open:false}))};
  const Dialog=()=><ConfirmDialog open={st.open} type={st.type} title={st.title} msg={st.msg} onConfirm={ok} onCancel={no}/>;
  return{confirm,Dialog};
};

/* ═══ GLOBAL SEARCH ═══ */
const SEARCH_IDX=[
  {n:"Tableau de bord",s:"Vue d'ensemble",icon:"home",page:"dashboard"},
  {n:"Séances",s:"Gestion des assemblées",icon:"calendar",page:"seances"},
  {n:"Membres",s:"Registre des votants",icon:"users",page:"membres"},
  {n:"Créer une séance",s:"Assistant en 4 étapes",icon:"plusCircle",page:"wizard"},
  {n:"Fiche séance",s:"AG Ordinaire",icon:"clipboard",page:"hub"},
  {n:"Opérateur",s:"Pilotage en direct",icon:"play",page:"operator"},
  {n:"Clôture et PV",s:"Finalisation",icon:"fileText",page:"postsession"},
  {n:"Statistiques",s:"Tableaux de bord",icon:"pieChart",page:"stats"},
  {n:"Archives",s:"Dossiers passés",icon:"archive",page:"archives"},
  {n:"Audit",s:"Journal des opérations",icon:"shield",page:"audit"},
  {n:"Paramètres",s:"Configuration",icon:"settings",page:"parametres"},
  {n:"Aide & FAQ",s:"Documentation",icon:"helpCircle",page:"aide"},
];
const GlobalSearch=({open,onClose,go})=>{
  const[q,setQ]=useState("");const[sel,setSel]=useState(0);
  const results=q.length>1?SEARCH_IDX.filter(i=>i.n.toLowerCase().includes(q.toLowerCase())||i.s.toLowerCase().includes(q.toLowerCase())):SEARCH_IDX;
  useEffect(()=>{setSel(0)},[q]);
  useEffect(()=>{
    if(!open)return;
    const h=e=>{
      if(e.key==="ArrowDown"){e.preventDefault();setSel(s=>Math.min(s+1,results.length-1))}
      else if(e.key==="ArrowUp"){e.preventDefault();setSel(s=>Math.max(s-1,0))}
      else if(e.key==="Enter"&&results[sel]){go(results[sel].page);onClose();setQ("");}
      else if(e.key==="Escape")onClose();
    };
    window.addEventListener("keydown",h);return()=>window.removeEventListener("keydown",h);
  },[open,sel,results,go,onClose,q]);
  if(!open)return null;
  return(<div className="search-overlay" onClick={e=>{if(e.target===e.currentTarget){onClose();setQ("")}}}>
    <div className="search-box" role="dialog" aria-label="Recherche globale" aria-modal="true">
      <div className="search-input-row">
        {ico("search",18)}
        <input autoFocus maxLength={100} value={q} onChange={e=>{setQ(e.target.value);setSel(0)}} placeholder="Rechercher une page, une séance, une action…" aria-label="Recherche"/>
      </div>
      <div className="search-results" role="listbox">
        {results.length===0&&<div style={{padding:"24px",textAlign:"center",color:"var(--text-muted)",fontSize:13}}>Aucun résultat pour « {q} »</div>}
        {results.map((r,i)=>(
          <div key={r.page} className={`search-result-item${i===sel?" sel":""}`} role="option" aria-selected={i===sel} onClick={()=>{go(r.page);onClose();setQ("")}}>
            <div className="sr-icon"><LI name={r.icon} size={18} color={i===sel?"var(--accent)":"var(--text-muted)"}/></div>
            <div><div className="sr-name">{r.n}</div><div className="sr-sub">{r.s}</div></div>
          </div>
        ))}
      </div>
    </div>
  </div>);
};


/* ═══ TOOLTIP ═══ */
const Tip=({children,label})=>(<div className="tip-wrap" tabIndex={-1}>{children}<span className="tip-body" role="tooltip">{label}</span></div>);
const MiniBar=({data,height=20,colors=["var(--accent)","var(--success)","var(--warn)","var(--danger)","var(--purple)"]})=>{const max=Math.max(...data.map(d=>d.v),1);return(<div style={{display:"flex",alignItems:"flex-end",gap:3,height}}>{data.map((d,i)=>(<Tip key={i} label={`${d.l}: ${d.v}`}><div style={{width:Math.max(18,Math.round(200/data.length)),height:Math.max(3,Math.round(d.v/max*height)),background:colors[i%colors.length],borderRadius:"3px 3px 0 0",transition:"height .3s ease",cursor:"pointer"}}/></Tip>))}</div>)};
const ScrollTop=()=>{const[vis,setVis]=useState(false);useEffect(()=>{const main=document.querySelector(".main");if(!main)return;const h=()=>setVis(main.scrollTop>300);main.addEventListener("scroll",h);return()=>main.removeEventListener("scroll",h)},[]);return(<button className={`scroll-top${vis?" visible":""}`} onClick={()=>{const m=document.querySelector(".main");if(m)m.scrollTo({top:0,behavior:"smooth"})}} aria-label="Retour en haut"><LI name="chevU" size={18}/></button>)};

/* ═══ TOAST SYSTEM ═══ */
const Toast=({toasts,remove})=>(<div className="toast-container" aria-live="polite">{toasts.map(t=>(<div key={t.id} className={`toast toast-${t.type}`} role="alert" aria-atomic="true">
  <div className="toast-icon">{ico(t.type==="success"?"checkCircle":t.type==="warn"?"alertTriangle":t.type==="error"?"xCircle":"info",14)}</div>
  <div style={{flex:1}}>{t.title&&<div className="toast-title">{t.title}</div>}<div className="toast-msg">{t.msg}</div></div>
  <button className="toast-close" onClick={()=>remove(t.id)} aria-label="Fermer">{ico("x",12)}</button>
</div>))}</div>);

const GuidedTour=({page,onEnd})=>{
  const[step,setStep]=useState(0);
  const[rect,setRect]=useState(null);
  const[ready,setReady]=useState(false);
  const steps=tourSteps[page]||[];

  const recalc=()=>{
    if(!steps[step])return;
    const el=document.querySelector(`[data-tour="${steps[step].target}"]`);
    if(el){
      /* scroll element into view if needed */
      const r=el.getBoundingClientRect();
      const inView=r.top>=0&&r.bottom<=(window.innerHeight||document.documentElement.clientHeight);
      if(!inView)el.scrollIntoView({behavior:'smooth',block:'center'});
      /* recompute after scroll */
      setTimeout(()=>{
        const r2=el.getBoundingClientRect();
        setRect({top:r2.top,left:r2.left,width:r2.width,height:r2.height});
        setReady(true);
      },inView?0:320);
    }else{setRect(null);setReady(true);}
  };

  useEffect(()=>{setReady(false);const t=setTimeout(recalc,180);return()=>clearTimeout(t);},[step,page]);
  useEffect(()=>{window.addEventListener('resize',recalc);return()=>window.removeEventListener('resize',recalc);},[step,page]);

  /* Keyboard nav */
  useEffect(()=>{
    const onKey=e=>{
      if(e.key==='Escape')onEnd();
      else if(e.key==='ArrowRight'&&step<steps.length-1)setStep(s=>s+1);
      else if(e.key==='ArrowLeft'&&step>0)setStep(s=>s-1);
    };
    window.addEventListener('keydown',onKey);
    return()=>window.removeEventListener('keydown',onKey);
  },[step,steps.length,onEnd]);

  if(!steps.length)return null;
  if(!ready)return(<div style={{position:'fixed',inset:0,background:'rgba(0,0,0,.6)',zIndex:9998,display:'flex',alignItems:'center',justifyContent:'center'}} aria-busy="true"><div style={{background:'var(--surface)',borderRadius:14,padding:24,textAlign:'center'}}><div style={{fontSize:15,fontWeight:700,color:'var(--text-dark)'}}>Chargement de la visite…</div></div></div>);

  const s=steps[step];const total=steps.length;
  const hasSpot=rect!==null;

  /* Spotlight ring position (CSS div, not SVG) */
  const PAD=8;
  const spotStyle=hasSpot?{
    top:rect.top-PAD,left:rect.left-PAD,
    width:rect.width+PAD*2,height:rect.height+PAD*2,
  }:null;

  /* Bubble position */
  let bubbleStyle={position:'fixed',zIndex:10001};
  if(hasSpot){
    const belowSpace=window.innerHeight-(rect.top+rect.height+16+PAD);
    const aboveSpace=rect.top-PAD-16;
    const bw=Math.min(400,window.innerWidth-32);
    const bx=Math.max(16,Math.min(rect.left+rect.width/2-bw/2,window.innerWidth-bw-16));
    if(belowSpace>240){Object.assign(bubbleStyle,{top:rect.top+rect.height+PAD+12,left:bx});}
    else if(aboveSpace>240){Object.assign(bubbleStyle,{bottom:window.innerHeight-rect.top+PAD+12,left:bx});}
    else{Object.assign(bubbleStyle,{top:'50%',left:'50%',transform:'translate(-50%,-50%)'});}
  }else{Object.assign(bubbleStyle,{top:'50%',left:'50%',transform:'translate(-50%,-50%)'});}

  return(<>
    {/* Overlay with spotlight cutout */}
    <div style={{position:'fixed',inset:0,zIndex:9998,pointerEvents:'none'}}>
      <svg width="100%" height="100%" style={{position:'absolute',inset:0}}>
        {hasSpot?(<>
          <defs><mask id="tourMask">
            <rect width="100%" height="100%" fill="white"/>
            <rect x={rect.left-PAD} y={rect.top-PAD} width={rect.width+PAD*2} height={rect.height+PAD*2} rx="12" fill="black"/>
          </mask></defs>
          <rect width="100%" height="100%" fill="rgba(0,0,0,.6)" mask="url(#tourMask)"/>
        </>):(<rect width="100%" height="100%" fill="rgba(0,0,0,.6)"/>)}
      </svg>
    </div>
    {/* Spotlight ring */}
    {hasSpot&&<div className="tour-spotlight-ring" style={spotStyle}/>}
    {/* Click catcher (click outside → quitter) */}
    <div style={{position:'fixed',inset:0,zIndex:10000}} onClick={e=>{if(e.target===e.currentTarget)onEnd();}}>
      <div className="tour-bubble" style={bubbleStyle} role="dialog" aria-modal="true" aria-label={`Visite guidée, étape ${step+1} sur ${total}`}>
        <div className="tour-header">
          <div className="tour-icon"><LI name={s.icon} size={18} color="#fff"/></div>
          <div><div className="tour-step-label">Étape {step+1} / {total}</div><div style={{fontSize:12,color:'var(--text-muted)',marginTop:1}}>← → ou flèches clavier</div></div>
        </div>
        <div className="tour-title">{s.title}</div>
        <div className="tour-desc">{s.desc}</div>
        <div className="tour-progress"><div className="tour-progress-fill" style={{width:`${(step+1)/total*100}%`}}/></div>
        <div className="tour-footer">
          {step>0&&<button className="btn btn-sm" onClick={e=>{e.stopPropagation();setStep(step-1);}}>{ico('chevL',13)} Précédent</button>}
          <button className="btn btn-sm btn-ghost" onClick={e=>{e.stopPropagation();onEnd();}}>✕ Quitter</button>
          {step<total-1
            ?<button className="btn btn-sm btn-p" autoFocus onClick={e=>{e.stopPropagation();setStep(step+1);}}>Suivant {ico('chevR',13)}</button>
            :<button className="btn btn-sm btn-p" autoFocus onClick={e=>{e.stopPropagation();onEnd();}}>{ico('check',13)} Terminé !</button>}
        </div>
      </div>
    </div>
  </>);};

/* ═══ LANDING ═══ */
const PageLanding=({onLogin,onDoc,onSupport})=>{
  const[isLogging,setIsLogging]=useState(false);
  const handleEnter=()=>{
    setIsLogging(true);
    setTimeout(()=>{setIsLogging(false);onLogin();},600);
  };return(<div className="landing">
  <div className="landing-header"><div className="flex-row"><div className="logo-mark"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m9 12 2 2 4-4"/><path d="M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z"/><path d="M22 19H2"/></svg></div><span style={{fontFamily:"var(--font-display)",fontSize:20,fontWeight:800,color:"var(--text-dark)"}}>AG-Vote</span></div><div className="flex-row" style={{gap:16}}><button className="btn btn-ghost btn-sm" onClick={onDoc}>{ico("fileText",16)} Documentation</button><button className="btn btn-ghost btn-sm" onClick={onSupport}>{ico("mail",16)} Support</button></div></div>
  <div className="landing-body"><div style={{display:"flex",alignItems:"center",gap:60,maxWidth:920,width:"100%"}}>
    <div style={{flex:1}}>
      <div style={{fontFamily:"var(--font-display)",fontSize:38,fontWeight:800,lineHeight:1.15,color:"var(--text-dark)",marginBottom:16}}>Vos assemblées générales, simplifiées</div>
      <div style={{fontSize:17,lineHeight:1.7,color:"var(--text-muted)",marginBottom:28}}>Organisez, votez et archivez vos AG de copropriété en toute sérénité. Procès-verbaux générés automatiquement, résultats en temps réel.</div>
      <div style={{display:"flex",flexDirection:"column",gap:12,marginBottom:0}}>
        {[
          {i:"checkCircle",t:"Convocations et votes électroniques",c:"var(--success)"},
          {i:"fileText",t:"Procès-verbal généré et envoyé en un clic",c:"var(--accent)"},
          {i:"shield",t:"Données protégées et traçabilité complète",c:"var(--purple)"}
        ].map(f=>(<div key={f.t} style={{display:"flex",alignItems:"center",gap:14,fontSize:15,fontWeight:500,color:"var(--text)"}}>
          <div style={{width:40,height:40,borderRadius:10,background:"var(--surface)",border:"1px solid var(--border)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}><LI name={f.i} size={22} color={f.c}/></div>{f.t}
        </div>))}
      </div>
    </div>
    <div style={{width:"100%",maxWidth:380,flexShrink:0}}><div className="card" style={{padding:32,textAlign:"center"}}>
      <div style={{width:64,height:64,borderRadius:18,background:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",boxShadow:"0 4px 16px rgba(22,80,224,.3)"}}><svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#fff" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m9 12 2 2 4-4"/><path d="M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z"/><path d="M22 19H2"/></svg></div>
      <div style={{fontSize:22,fontWeight:800,color:"var(--text-dark)",marginBottom:6}}>Démo interactive</div>
      <div style={{marginBottom:22,fontSize:15,lineHeight:1.6,color:"var(--text-muted)"}}>Explorez les 16 écrans du prototype. Aucun compte requis.</div>
      <button className="btn btn-p btn-block btn-lg" onClick={handleEnter} disabled={isLogging} style={{marginBottom:14,fontSize:16,minHeight:48}} autoFocus>{isLogging?<span style={{display:"flex",alignItems:"center",gap:8,justifyContent:"center"}}><span style={{width:18,height:18,border:"2.5px solid rgba(255,255,255,.3)",borderTop:"2.5px solid #fff",borderRadius:"50%",display:"inline-block",animation:"spin 0.7s linear infinite"}}/> Chargement…</span>:<>{ico("logIn",20)} Entrer dans la démo</>}</button>
      <div style={{padding:"10px 14px",background:"var(--surface-alt)",borderRadius:"var(--radius-sm)",fontSize:13,color:"var(--text-muted)",lineHeight:1.5}}>{ico("info",15)} Wireframe — données simulées</div>
    </div></div>
  </div></div>
  <div className="landing-footer"><span>© AG-Vote</span> <span style={{margin:"0 8px",color:"var(--border)"}}>·</span> <button className="btn btn-ghost btn-sm" onClick={onDoc} style={{padding:"2px 8px",minHeight:28}}>Documentation</button> <span style={{margin:"0 4px",color:"var(--border)"}}>·</span> <button className="btn btn-ghost btn-sm" onClick={onSupport} style={{padding:"2px 8px",minHeight:28}}>Contact</button></div>
</div>)};

/* ═══ DASHBOARD ═══ */
const PageDashboard=({go,onTour,addToast,showOB,onHideOB})=>(<><div className="page-anim">
  {showOB&&<div className="ob-banner">
    <div className="ob-icon"><LI name="compass" size={26} color="#fff"/></div>
    <div className="ob-text">
      <div className="ob-title">Bienvenue dans le wireframe AG-Vote</div>
      <div className="ob-sub">Explorez les 16 écrans du prototype. Toutes les données sont simulées. Lancez la visite guidée ou naviguez librement.</div>
    </div>
    <div className="ob-actions">
      <button className="ob-btn ob-btn-main" onClick={()=>{onHideOB&&onHideOB();onTour&&onTour();}}>Visite guidée</button>
      <button className="ob-btn ob-btn-ghost" onClick={()=>{onHideOB&&onHideOB();go("wizard");}}>Créer une séance</button>
    </div>
    <button className="ob-close" onClick={onHideOB} aria-label="Fermer la bannière">✕</button>
  </div>}
  <PH page="dashboard" icon="home" title="Tableau de bord" sub="Vue d'ensemble"  right={<div className="flex-row" style={{gap:6}}><button className="btn btn-sm" onClick={onTour}>{ico("info")} Visite guidée</button><button className="btn btn-p btn-sm" onClick={()=>go("wizard")}>{ico("plusCircle")} Nouvelle séance</button></div>}/>

  {/* PROCHAINE ACTION — la chose #1 à faire maintenant */}
  <div className="card" data-tour="action-urgente" style={{marginBottom:14,borderColor:"var(--danger)",borderWidth:2,padding:14,cursor:"pointer"}} onClick={()=>go("hub")}>
    <div className="flex-row" style={{gap:14,flexWrap:"nowrap"}}>
      <div style={{width:48,height:48,borderRadius:12,background:"var(--danger)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}><LI name="send" size={22} color="#fff"/></div>
      <div style={{flex:1,minWidth:0}}>
        <div style={{fontSize:14,fontWeight:700,color:"var(--danger)",textTransform:"uppercase",letterSpacing:1}}>Action urgente</div>
        <div style={{fontSize:18,fontWeight:800,color:"var(--text-dark)",margin:"2px 0"}}>Envoyer 12 convocations — AG Ordinaire</div>
        <div style={{fontSize:15,color:"var(--text-muted)"}}>Date limite : 22/02/2026 (art. 9 décret 1967 — 21 jours avant l'AG)</div>
      </div>
      <div style={{flexShrink:0}}><LI name="chevR" size={20} color="var(--danger)"/></div>
    </div>
  </div>

  <div className="grid-4" data-tour="kpi-row" style={{marginBottom:14}}>{[{v:"3",l:"AG à venir",c:"var(--accent)",i:"calendar",dest:"seances"},{v:"1",l:"En cours",c:"var(--danger)",i:"play",dest:"operator"},{v:"12",l:"Convoc. en attente",c:"var(--warn)",i:"send",dest:"hub"},{v:"3",l:"PV à envoyer",c:"var(--accent)",i:"fileText",dest:"postsession"}].map(s=>(<div key={s.l} className="card kpi" style={{cursor:"pointer"}} onClick={()=>go(s.dest)}><LI name={s.i} size={18} color={s.c}/><div style={{fontFamily:"var(--font-mono)",fontSize:22,fontWeight:700,color:s.c,margin:"3px 0",letterSpacing:"-0.5px",lineHeight:1}}>{s.v}</div><div style={{fontSize:13,fontWeight:700,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.4px"}}>{s.l}</div></div>))}</div>
  <div className="grid-2" style={{marginBottom:14}}>
    <div className="card" style={{padding:16}}><div className="flex-between" style={{marginBottom:8}}><div className="card-title" style={{margin:0}}>{ico("calendar")} Prochaines séances</div><button className="btn btn-sm btn-ghost" onClick={()=>go("seances")}>Tout voir {ico("chevR",14)}</button></div>{[{t:"AG Ordinaire",d:"18/02/2026",s:"Convocations",c:"var(--warn)",si:"send",n:"45 participants — 8 résolutions",act:"hub"},{t:"AG Copropriété B",d:"15/02/2026",s:"En cours",c:"var(--danger)",si:"play",n:"67 participants — En direct",act:"operator"},{t:"Conseil syndical",d:"10/02/2026",s:"Terminé",c:"var(--success)",si:"checkCircle",n:"12 membres — PV envoyé"}].map((s,i)=>(<div key={i} className="irow flex-row" style={{padding:"8px 4px",borderBottom:i<2?"1px solid var(--border-soft)":"none",cursor:"pointer",flexWrap:"nowrap",gap:8}} onClick={()=>{if(s.act)go(s.act)}}><div style={{width:22,height:22,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,color:s.c}}>{ico(s.si,16)}</div><div style={{flex:1,minWidth:0}}><div className="irow-title" style={{fontWeight:600,color:"var(--text-dark)",fontSize:14,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",transition:"color .12s"}}>{s.t} — {s.d}</div><div style={{fontSize:14,color:"var(--text-muted)"}}>{s.n}</div></div><span className="tag" style={{color:s.c}}>{sIco(s.s)}</span><LI name="chevR" size={12} color="var(--border)" className="irow-arrow"/></div>))}</div>
    <div className="card" style={{padding:16}} data-tour="card-taches"><div className="card-title">{ico("clipboard")} Tâches en attente</div>{[{t:"Envoyer 12 convocations",d:"Séance A — J-3",c:"var(--danger)",i:"send",dest:"hub"},{t:"Vérifier procurations reçues",d:"Séance A — 3 reçues",c:"var(--warn)",i:"userPlus",dest:"hub"},{t:"Compléter ordre du jour",d:"Séance B — 2 résol. sans majorité",c:"var(--warn)",i:"edit",dest:"wizard"},{t:"Envoyer PV dernière séance",d:"Vote terminé le 10/02",c:"var(--accent)",i:"fileText",dest:"postsession"}].map((t,i)=>(<div key={i} className="irow flex-row" style={{padding:"6px 4px",gap:10,borderBottom:i<3?"1px solid var(--border-soft)":"none",flexWrap:"nowrap",cursor:"pointer",borderRadius:6}} onClick={()=>go(t.dest)}><LI name={t.i} size={14} color={t.c}/><div style={{flex:1,minWidth:0}}><div className="irow-title" style={{fontWeight:600,color:"var(--text-dark)",fontSize:13,transition:"color .12s"}}>{t.t}</div><div style={{fontSize:12,color:"var(--text-muted)"}}>{t.d}</div></div><LI name="chevR" size={12} color="var(--border)" className="irow-arrow"/></div>))}</div>
  </div>
  <div className="grid-3" data-tour="card-raccourcis">{[{t:"Créer une séance",d:"Assistant en 4 étapes",i:"plusCircle",c:"var(--accent)",act:"wizard"},{t:"Piloter un vote",d:"Séance en direct",i:"play",c:"var(--danger)",act:"operator"},{t:"Consulter le suivi",d:"Journal de traçabilité",i:"shield",c:"var(--text-muted)",act:"audit"}].map(q=>(<div key={q.t} className="card flex-row" style={{padding:14,cursor:"pointer",gap:12,flexWrap:"nowrap"}} onClick={()=>go(q.act)}><div style={{width:40,height:40,borderRadius:10,background:q.c,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}><LI name={q.i} size={20} color="#fff"/></div><div style={{minWidth:0}}><div style={{fontWeight:700,color:"var(--text-dark)",fontSize:14}}>{q.t}</div><div className="muted" style={{fontSize:14}}>{q.d}</div></div></div>))}</div>
</div>
</>);

/* ═══ SÉANCES ═══ */
const SEANCES_DATA=[{t:"AG Ordinaire",d:"18/02/2026 — 18h30",sl:"Convocations",c:"var(--warn)",p:"67 participants",r:"8 résolutions",q:"Quorum : 34 requis",act:"hub"},{t:"AG Copropriété B",d:"15/02/2026 — 14h00",sl:"En cours",c:"var(--danger)",p:"45/67 présents",r:"3/5 votées",q:"Quorum : atteint (67%)",act:"hub"},{t:"Conseil syndical",d:"10/02/2026 — 09h00",sl:"PV envoyé",c:"var(--success)",p:"12/12 présents",r:"5 résolutions",q:"Unanimité sur 4/5",act:"hub"},{t:"AG Extra. Travaux",d:"28/01/2026 — 18h30",sl:"Archivée",c:"var(--success)",p:"52/67 présents",r:"3 résolutions",q:"Toutes adoptées",act:"hub"},{t:"AG Ordinaire 2025",d:"15/12/2025 — 18h30",sl:"Archivée",c:"var(--text-muted)",p:"54/67 présents",r:"12 résolutions",q:"11 adoptées, 1 rejetée",act:"hub"},{t:"Conseil syndical précédent",d:"01/11/2025 — 09h00",sl:"Archivée",c:"var(--text-muted)",p:"11/12 présents",r:"4 résolutions",q:"Toutes adoptées",act:"hub"},{t:"AG Extra. Ascenseur",d:"15/09/2025 — 18h30",sl:"Archivée",c:"var(--text-muted)",p:"48/67 présents",r:"2 résolutions",q:"Toutes adoptées",act:"hub"}];
const PageSeances=({go,addToast})=>{const[view,setView]=useState("list");const[filter,setFilter]=useState("all");const[pg,setPg]=useState(1);const[sq,setSq]=useState("");const[srt,setSrt]=useState("date");const PER_PAGE=5;
  const _base=filter==="all"?SEANCES_DATA:filter==="upcoming"?SEANCES_DATA.filter(s=>s.sl==="Convocations"):filter==="live"?SEANCES_DATA.filter(s=>s.sl==="En cours"):filter==="done"?SEANCES_DATA.filter(s=>["PV envoyé","Archivée"].includes(s.sl)):SEANCES_DATA;
  const filtered=(sq.length>1?_base.filter(s=>s.t.toLowerCase().includes(sq.toLowerCase())||s.sl.toLowerCase().includes(sq.toLowerCase())):_base).slice().sort((a,b)=>srt==="name"?a.t.localeCompare(b.t):srt==="status"?a.sl.localeCompare(b.sl):0);
  const totalPg=Math.ceil(filtered.length/PER_PAGE);const paginated=filtered.slice((pg-1)*PER_PAGE,pg*PER_PAGE);
  return(<div className="page-anim">
  <PH page="seances" icon="calendar" title="Séances" sub={`${SEANCES_DATA.length} séances`} right={<div className="flex-row" style={{gap:6}}><div className="flex-row" style={{gap:2,border:"1px solid var(--border)",borderRadius:"var(--radius-sm)",overflow:"hidden"}}><button className={`btn btn-sm ${view==="list"?"btn-p":""}`} onClick={()=>setView("list")} style={{borderRadius:0,border:0}}>{ico("listOrdered",14)} Liste</button><button className={`btn btn-sm ${view==="cal"?"btn-p":""}`} onClick={()=>setView("cal")} style={{borderRadius:0,border:0}}>{ico("calendar",14)} Calendrier</button></div><button className="btn btn-p btn-sm" onClick={()=>go("wizard")}>{ico("plus")} Nouvelle</button></div>}/>
  <div className="search-bar-row">
    <div className="search-bar-wrap"><span style={{position:"absolute",left:11,top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"var(--text-light)"}}>{ico("search",14)}</span><input className="field-input" type="search" placeholder="Rechercher une séance…" maxLength={100} value={sq} onChange={e=>{setSq(e.target.value);setPg(1)}} aria-label="Rechercher"/></div>
    <select className="field-input" style={{minHeight:36,width:150}} value={srt} onChange={e=>setSrt(e.target.value)}><option value="date">Date ↓</option><option value="name">Nom A→Z</option><option value="status">Statut</option></select>
  </div>
  <div className="flex-row" style={{gap:6,marginBottom:12}}>{[{k:"all",l:`Toutes (${SEANCES_DATA.length})`},{k:"upcoming",l:`À venir (${SEANCES_DATA.filter(s=>s.sl==="Convocations").length})`},{k:"live",l:`En cours (${SEANCES_DATA.filter(s=>s.sl==="En cours").length})`},{k:"done",l:`Terminées (${SEANCES_DATA.filter(s=>["PV envoyé","Archivée"].includes(s.sl)).length})`}].map(f=>(<button key={f.k} className={`btn btn-sm ${filter===f.k?"btn-p":""}`} onClick={()=>{setFilter(f.k);setPg(1)}}>{f.l}</button>))}</div>
  {view==="cal"&&<div className="card" style={{marginBottom:14}}>
    <div className="flex-between" style={{marginBottom:12}}><button className="btn btn-sm btn-ghost" aria-label="Mois précédent">{ico("chevL",14)}</button><div style={{fontWeight:800,color:"var(--text-dark)",fontSize:16}}>Février 2026</div><button className="btn btn-sm btn-ghost" aria-label="Mois suivant">{ico("chevR",14)}</button></div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,textAlign:"center"}}>
      {["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"].map(d=>(<div key={d} style={{fontSize:14,fontWeight:700,color:"var(--text-muted)",padding:6}}>{d}</div>))}
      {Array.from({length:28},(_,i)=>{const d=i+1;const ev=d===15?{l:"AG Copro. B",c:"var(--danger)"}:d===18?{l:"AG Copro. A",c:"var(--warn)"}:d===10?{l:"Conseil syndical",c:"var(--success)"}:null;return(<div key={d} style={{padding:4,minHeight:56,border:"1px solid var(--border-soft)",borderRadius:4,position:"relative"}}><div style={{fontSize:14,fontWeight:600,color:"var(--text-dark)"}}>{d}</div>{ev&&<div style={{fontSize:14,fontWeight:700,color:"#fff",background:ev.c,borderRadius:3,padding:"1px 4px",marginTop:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer"}} onClick={()=>go("hub")}>{ev.l}</div>}</div>)})}
    </div>
  </div>}
  {/* LIST — hauteur stable pour que la pagination ne se déplace pas */}
  <div style={{minHeight:PER_PAGE*72}}>
    {paginated.map((s,i)=>(
      <div key={i} className="card flex-row" style={{padding:"12px 16px",marginBottom:8,cursor:"pointer",gap:12,flexWrap:"nowrap"}} onClick={()=>go(s.act)}><div style={{width:10,height:10,borderRadius:"50%",background:s.c,flexShrink:0,marginTop:5}}/><div style={{flex:1,minWidth:0}}><div style={{fontWeight:700,color:"var(--text-dark)",fontSize:14,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{s.t}</div><div style={{fontSize:14,color:"var(--text-muted)"}}>{s.d} — {s.p} — {s.r}</div><div style={{fontSize:14,color:"var(--text-muted)"}}>{s.q}</div></div><span className="tag" style={{color:s.c}}>{sIco(s.sl)}</span><Popover trigger={<button className="btn btn-sm btn-ghost" onClick={e=>e.stopPropagation()}><LI name="moreHorizontal" size={14}/></button>} items={[{label:"Ouvrir",icon:"eye"},{label:"Modifier",icon:"edit"},{label:"Dupliquer",icon:"plusCircle"},"sep",{label:"Supprimer",icon:"x"}]}/></div>
    ))}
    {filtered.length===0&&<div className="card"><div className="empty-state">
          <div className="empty-state-icon"><LI name="calendar" size={36} color="var(--text-light)"/></div>
          <div className="empty-state-title">{sq.length>1?"Aucun résultat":"Aucune séance"}</div>
          <div className="empty-state-sub">{sq.length>1?`Aucune séance ne correspond à « ${sq} ».`:"Commencez par créer votre première assemblée générale."}</div>
          {sq.length===0&&<button className="btn btn-p" onClick={()=>go("wizard")}>{ico("plusCircle")} Créer une séance</button>}
        </div></div>}
  </div>
  {/* PAGINATION — position stable grâce au minHeight ci-dessus */}
  {totalPg>1&&<div className="pagination">{Array.from({length:totalPg},(_,i)=>(<button key={i} className={`pg-btn${pg===i+1?" pg-active":""}`} onClick={()=>setPg(i+1)}>{i+1}</button>))}</div>}
</div>)};

/* ═══════════════════════════════════════════
   WIZARD — ALL 4 STEPS VISIBLE (WIREFRAME)
   ═══════════════════════════════════════════ */
const PageWizard=({go,onTour,addToast})=>{
  const WS=["Infos générales","Membres","Ordre du jour","Récapitulatif","Créée"];
  const[ws,setWs]=useState(0);
  return(<div className="page-anim">
  <PH page="wizard" icon="plusCircle" title="Créer une séance" sub="Assistant en 4 étapes" right={<div className="flex-row" style={{gap:6}}><button className="btn btn-sm btn-ghost" onClick={()=>onTour&&onTour()}>{ico("compass",14)} Visite guidée</button><button className="btn btn-sm" onClick={()=>go("dashboard")}>{ico("chevL")} Retour</button></div>}/>
  <div className="wiz-progress-wrap" aria-label="Progression">
    {WS.map((s,i)=>(<div key={s} className={`wiz-step-item${i<ws?" done":i===ws?" active":""}`}>
      <div className="wiz-snum">{i<ws?ico("check",11):i+1}</div><span>{s}</span>
    </div>))}
  </div>

  {ws===0&&<div className="card" data-tour="wizard-step1" style={{marginBottom:14,animation:"pageIn .18s ease"}}>
    <div className="wf-step"><div style={{width:24,height:24,borderRadius:"50%",background:"#fff",color:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:14}}>1</div>Informations générales</div>
    <div className="muted" style={{marginBottom:12,fontSize:14}}><span className="req">*</span> Champ obligatoire</div>
    {/* Groupe : Identité */}
    <div style={{marginBottom:14}}>
      <div style={{fontSize:14,fontWeight:800,color:"var(--text-dark)",marginBottom:8,textTransform:"uppercase",letterSpacing:1}}>{ico("fileText",14)} Identité de la séance</div>
      <div className="field"><label className="field-label">Titre de la séance <span className="req">*</span> <HelpTip text="Nom affiché sur les convocations et le PV"/></label><input className="field-input" aria-required="true" placeholder="Ex : AG Ordinaire du 15 mars 2026" maxLength={200} autoComplete="off" aria-required="true"/></div>
      <div className="row"><div className="field"><label className="field-label">Type de séance <span className="req">*</span></label><select className="field-input" aria-required="true"><option>AG Ordinaire</option><option>AG Extraordinaire</option><option>Conseil syndical</option></select></div><div className="field"><label className="field-label">Date <span className="req">*</span></label><input className="field-input" aria-required="true" type="date"/></div><div className="field"><label className="field-label">Heure <span className="req">*</span> <HelpTip text="Format 24h — tapez les chiffres, les deux-points sont déjà en place. Le copier-coller fonctionne (ex : 18:30, 14h00, 1830)."/></label><TimeInput/></div></div>
    </div>
    {/* Groupe : Lieu */}
    <div style={{marginBottom:14}}>
      <div style={{fontSize:14,fontWeight:800,color:"var(--text-dark)",marginBottom:8,textTransform:"uppercase",letterSpacing:1}}>{ico("mapPin",14)} Lieu</div>
      <div className="row"><div className="field"><label className="field-label">Nom du lieu</label><input className="field-input" placeholder="Ex : Salle polyvalente" maxLength={100} autoComplete="off"/></div><div className="field"><label className="field-label">Adresse</label><input className="field-input" placeholder="Ex : 10 avenue de la République" maxLength={200} autoComplete="off"/></div></div>
    </div>
    {/* Groupe : Règles */}
    <div style={{marginBottom:8}}>
      <div style={{fontSize:14,fontWeight:800,color:"var(--text-dark)",marginBottom:8,textTransform:"uppercase",letterSpacing:1}}>{ico("scale",14)} Règles de vote</div>
      <div className="field"><label className="field-label">Politique de quorum <HelpTip text="Seuil minimum de participation pour que les votes soient valides."/></label><select className="field-input"><option>50% des présents + 1 (défaut copropriété)</option><option>50% des voix</option><option>33% des présents (2e convocation)</option><option>Aucun quorum (conseil/bureau)</option><option>Personnalisé (configurable dans Paramètres)</option></select></div>
    </div>
    <div className="alert alert-warn" style={{marginTop:4}}>{ico("alertTriangle")} <strong>Date limite d'envoi des convocations : 22/02/2026</strong> (21 jours avant — art. 9 décret du 17 mars 1967)</div>
    <div className="step-nav"><button className="btn" onClick={()=>go("dashboard")}>{ico("chevL")} Retour</button><button className="btn btn-p" onClick={()=>setWs(1)}>Suivant {ico("chevR")}</button></div>
  </div>}
  {ws===1&&<div className="card" style={{marginBottom:14,animation:"pageIn .18s ease"}}>
    <div className="wf-step"><div style={{width:24,height:24,borderRadius:"50%",background:"#fff",color:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:14}}>2</div>Participants</div>
    <div className="flex-row" style={{gap:8,marginBottom:14}}><button className="btn btn-p btn-sm" style={{flex:1,justifyContent:"center",maxWidth:200}} onClick={()=>addToast&&addToast("Sélecteur de fichier (wireframe).","info")}>{ico("upload")} Importer (.csv, .xlsx)</button><button className="btn btn-sm" style={{flex:1,justifyContent:"center",maxWidth:200}} onClick={()=>addToast&&addToast("Formulaire d'ajout (wireframe).","info")}>{ico("plus")} Ajout manuel</button></div>
    <div style={{background:"var(--surface-alt)",borderRadius:"var(--radius-sm)",padding:16,textAlign:"center",border:"1.5px dashed var(--border-dash)",marginBottom:12}}><LI name="upload" size={22} color="var(--text-light)"/><div style={{fontWeight:700,color:"var(--text-dark)",fontSize:14,marginTop:4}}>Glissez votre fichier</div><div className="muted">Colonnes attendues : Nom, Lot, Courriel, Clé Générale, Clé Ascenseur, Clé Chauffage…</div></div>
    {[{n:"Membre A",t:"120",l:"Lot 3",keys:"Gén: 120 | Asc: 85 | Chauff: 110"},{n:"Membre E",t:"95",l:"Lot 7",keys:"Gén: 95 | Asc: — | Chauff: 90"},{n:"SCI Exemple",t:"210",l:"Lots 12-13",keys:"Gén: 210 | Asc: 160 | Chauff: 195"}].map((p,i)=>(<div key={i} className="flex-row" style={{gap:8,padding:"8px 10px",border:"1px solid var(--border)",borderRadius:6,marginBottom:5,flexWrap:"nowrap"}}><div style={{width:28,height:28,borderRadius:"50%",background:"var(--accent-light)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}><LI name="user" size={14} color="var(--accent)"/></div><div style={{flex:1,minWidth:0}}><span style={{fontWeight:600,color:"var(--text-dark)",fontSize:14}}>{p.n}</span><div className="flex-row" style={{gap:8,marginTop:2}}><span style={{fontSize:14,color:"var(--text-muted)"}}>{p.l}</span><span style={{fontSize:14,color:"var(--text-muted)"}}>{p.keys}</span></div></div><span style={{fontSize:14,fontWeight:700,color:"var(--text-dark)"}}>{p.t} voix</span><span className="tag tag-success">{ico("check",14)}</span></div>))}
    <div style={{padding:"10px 0",borderTop:"1px solid var(--border-soft)",marginTop:8}}><div className="flex-between"><span style={{fontWeight:700,color:"var(--text-dark)"}}>Total : 67 participants</span><span style={{fontWeight:800,color:"var(--accent)"}}>8 500 voix</span></div><div className="flex-between" style={{marginTop:4}}><span className="muted">Quorum requis (50% + 1)</span><span style={{fontWeight:700,color:"var(--text-dark)"}}>34 présents / 4 251 voix</span></div></div>
    <div className="ctx-panel" style={{marginTop:10}}><h4>{ico("lightbulb")} Guide</h4><p>Chaque participant doit figurer avec son poids de vote. Le quorum est calculé automatiquement.</p></div>
    <div className="step-nav"><button className="btn" onClick={()=>setWs(0)}>{ico("chevL")} Précédent</button><button className="btn btn-p" onClick={()=>setWs(2)}>Suivant {ico("chevR")}</button></div>
  </div>}
  {ws===2&&<div className="card" style={{marginBottom:14,animation:"pageIn .18s ease"}}>
    <div className="wf-step"><div style={{width:24,height:24,borderRadius:"50%",background:"#fff",color:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:14}}>3</div>Résolutions (ordre du jour)</div>
    {/* FORMULAIRE AJOUT */}
    <div style={{padding:14,border:"1.5px dashed var(--accent)",borderRadius:"var(--radius-sm)",background:"var(--accent-light)",marginBottom:14}}>
      <div style={{fontWeight:700,color:"var(--accent)",fontSize:14,marginBottom:10}}>{ico("plusCircle")} Ajouter une résolution</div>
      <div className="field"><label className="field-label">Titre <span className="req">*</span></label><input className="field-input" aria-required="true" placeholder="Ex : Approbation des comptes 2025" style={{background:"var(--surface)"}} maxLength={200} autoComplete="off"/></div>
      <div className="field"><label className="field-label">Description</label><CTA placeholder="Texte de la résolution soumise au vote" max={2000} rows={2} style={{background:"var(--surface)"}}/></div>
      <div className="row">
        <div className="field"><label className="field-label">Majorité <span className="req">*</span> <HelpTip text="Art. 24 par défaut. Modifiable par résolution."/></label><select className="field-input" aria-required="true" style={{background:"var(--surface)"}}><option>Majorité simple (art. 24) — DÉFAUT</option><option>Majorité absolue (art. 25)</option><option>Double majorité (art. 26)</option><option>Unanimité (art. 26-1)</option></select></div>
        <div className="field"><label className="field-label">Clé de répartition <span className="req">*</span> <HelpTip text="Détermine le poids de vote de chaque participant pour cette résolution. Les participants absents de la clé choisie ne votent pas."/></label><select className="field-input" aria-required="true" style={{background:"var(--surface)"}}><option>Charges générales (défaut) — 67 lots, 10 000 millièmes</option><option>Ascenseur Bâtiment A — 42 lots, 7 200 millièmes</option><option>Chauffage collectif — 61 lots, 9 850 millièmes</option><option>Parking souterrain — 35 lots, quote-part égale</option></select></div>
        <div className="field"><label className="field-label">Vote secret <HelpTip text="Anonymise les bulletins. Recommandé pour les nominations."/></label><div className="flex-row" style={{gap:4}}><span className="chip">Non (défaut)</span><span className="chip active">Oui</span></div></div>
      </div>
      <div className="flex-row" style={{gap:6,justifyContent:"flex-end"}}><button className="btn btn-p btn-sm" onClick={()=>addToast&&addToast("Résolution ajoutée à l'ordre du jour.","success")}>{ico("check")} Ajouter</button></div>
    </div>
    {[{n:1,t:"Approbation des comptes 2025",m:"Majorité simple (art. 24)",mc:"var(--success)",secret:false},{n:2,t:"Élection du président du conseil syndical",m:"Majorité absolue (art. 25)",mc:"var(--accent)",secret:true},{n:3,t:"Travaux ravalement façade",m:"Double majorité (art. 26)",mc:"var(--accent)",secret:false}].map(r=>(<div key={r.n} className="flex-row" style={{gap:10,padding:"10px 12px",border:"1px solid var(--border)",borderRadius:6,marginBottom:6,flexWrap:"nowrap"}}><div style={{width:28,height:28,borderRadius:"50%",background:"var(--accent-light)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,color:"var(--accent)",fontSize:14,flexShrink:0}}>{r.n}</div><div style={{flex:1,minWidth:0}}><div style={{fontWeight:700,color:"var(--text-dark)",fontSize:14}}>{r.t}</div><div className="flex-row" style={{gap:6,marginTop:2}}><span className="tag" style={{color:r.mc,fontSize:14}}>{r.m}</span>{r.secret&&<span className="tag tag-purple" style={{fontSize:14}}>{ico("lock",14)} Secret</span>}</div></div><button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast("Formulaire d'édition (wireframe).","info")}>{ico("edit",14)}</button></div>))}
    <div className="ctx-panel" style={{marginTop:10}}><h4>{ico("lightbulb")} Guide</h4><p>Art. 24 : majorité des présents. Art. 25 : majorité de tous les copropriétaires. Art. 26 : double majorité (2/3 des voix de tous). Réordonnez par glisser-déposer.</p></div>
    <div className="step-nav"><button className="btn" onClick={()=>setWs(1)}>{ico("chevL")} Précédent</button><button className="btn btn-p" onClick={()=>setWs(3)}>Suivant {ico("chevR")}</button></div>
  </div>}
  {ws===3&&<div className="card" style={{marginBottom:14,animation:"pageIn .18s ease"}}>
    <div className="wf-step"><div style={{width:24,height:24,borderRadius:"50%",background:"#fff",color:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:14}}>4</div>Vérification et création</div>
    <div className="alert alert-success">{ico("checkCircle")} <strong>Prêt à créer.</strong> Vérifiez les informations ci-dessous.</div>
    {[["Titre","AG Copropriété Exemple"],["Type","AG Ordinaire"],["Date","15/03/2026 à 18h30"],["Lieu","Salle polyvalente Bat. A"],["Participants","67 (8 500 voix)"],["Quorum","50% des présents + 1 (défaut)"],["Quorum requis","34 présents (4 251 voix)"],["Résolutions","3"],["Date limite convocations","22/02/2026"]].map(([k,v],i)=>(<div key={i} className="flex-between" style={{padding:"7px 0",borderBottom:i<8?"1px solid var(--border-soft)":"none"}}><span className="muted">{k}</span><span style={{fontWeight:700,color:"var(--text-dark)"}}>{v}</span></div>))}
    <div className="ctx-panel" style={{marginTop:10}}><h4>{ico("lightbulb")} Guide</h4><p>Cliquez sur une étape précédente pour corriger. La séance sera créée en brouillon, modifiable jusqu'au lancement.</p></div>
    <div className="alert alert-warn" style={{marginTop:8,marginBottom:0}}>{ico("alertTriangle")} La création ne lance pas le vote. Vous pourrez lancer la séance depuis l'espace opérateur.</div>
    <div className="step-nav"><button className="btn" onClick={()=>setWs(2)}>{ico("chevL")} Précédent</button><button className="btn btn-success" onClick={()=>{addToast&&addToast("Séance créée avec succès !","success","AG créée");setWs(4);}}>{ico("check")} Créer la séance</button></div>
  </div>}

  {ws===4&&<div className="card" style={{marginBottom:14,animation:"pageIn .25s ease"}}>
    <div className="wf-step" style={{background:"var(--success)"}}><LI name="check" size={16} color="#fff"/>Séance créée</div>
    <div style={{textAlign:"center",padding:"16px 0"}}><div style={{width:48,height:48,borderRadius:"50%",background:"var(--success-bg)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 10px",border:"2px solid var(--success)"}}><LI name="check" size={22} color="var(--success)"/></div><div style={{fontSize:18,fontWeight:800,color:"var(--text-dark)",marginBottom:4}}>AG Ordinaire créée</div><div className="muted" style={{marginBottom:6}}>Brouillon enregistré. Modifiable à tout moment.</div><div className="alert alert-warn" style={{textAlign:"left",marginBottom:14}}>{ico("send")} <strong>Prochaine étape :</strong> envoyer les convocations avant le 22/02/2026.</div><div className="flex-row" style={{justifyContent:"center"}}><button className="btn btn-p btn-sm" onClick={()=>go("hub")}>{ico("send")} Envoyer les convocations</button><button className="btn btn-sm" onClick={()=>go("seances")}>{ico("calendar")} Mes séances</button></div></div>
  </div>}
</div>);
};


/* ═══ OPERATOR — PILOTAGE SÉANCE (simplifié pour 65+) ═══ */
/* ═══ OPERATOR v24 — PILOTAGE SÉANCE (restauration complète) ═══ */
const PageOperator=({go,onTour,addToast})=>{
  const[secs,setSecs]=useState(5025);
  const ft=s=>{const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sc=s%60;return`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(sc).padStart(2,"0")}`};
  useEffect(()=>{const t=setInterval(()=>setSecs(s=>s+1),1000);return()=>clearInterval(t)},[]);
  useEffect(()=>{
    const h=e=>{
      if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.metaKey||e.ctrlKey)return;
      if(e.key.toLowerCase()==="p")document.querySelector("[data-op-proclamer]")?.click();
      if(e.key.toLowerCase()==="f")document.querySelector("[data-op-vote-toggle]")?.click();
    };
    window.addEventListener("keydown",h);return()=>window.removeEventListener("keydown",h);
  },[]);
  const{confirm:cfm,Dialog:CfmDlg}=useConfirm();
  const[allRes,setAllRes]=useState([{id:1,t:"Approbation des comptes 2025",maj:"simple",cle:"Charges générales",secret:false,s:"voted",p:38,c:5,a:2,total:45},{id:2,t:"Élection président du CS",maj:"absolue",cle:"Charges générales",secret:true,s:"voted",p:42,c:1,a:2,total:45},{id:3,t:"Budget prévisionnel 2026",maj:"simple",cle:"Charges générales",secret:false,s:"voting",p:28,c:8,a:3,total:45},{id:4,t:"Ravalement façade Bâtiment A",maj:"qualifiée",cle:"Charges générales",secret:false,s:"pending",p:0,c:0,a:0,total:45},{id:5,t:"Installation bornes VE",maj:"absolue",cle:"Ascenseur Bâtiment A",secret:false,s:"pending",p:0,c:0,a:0,total:45}]);
  const ALL_RES=allRes;
  const[curIdx,setCurIdx]=useState(2);/* index of active resolution (0-based, starts at #3) */
  const[vo,setVo]=useState(true);
  const[subTab,setSubTab]=useState("resultat");
  const[showProxy,setShowProxy]=useState(false);
  const[showUnanim,setShowUnanim]=useState(false);
  const[transitioning,setTransitioning]=useState(false);
  const[quorumOk,setQuorumOk]=useState(true);/* Wireframe: togglable quorum state */
  const[hands]=useState([{id:1,name:"Participant 1",lot:"Lot 12",time:"2 min",s:"waiting"},{id:2,name:"Participant 2",lot:"Lot 8",time:"1 min",s:"waiting"},{id:3,name:"Participant 3",lot:"Lot 3",time:"30s",s:"waiting"}]);
  const hc=hands.filter(h=>h.s==="waiting").length;
  const missing=[{n:"M. Roux",t:150},{n:"Membre C",t:95},{n:"SCI Rouge",t:320},{n:"M. Faure",t:180},{n:"Membre B",t:110},{n:"M. Patel",t:75}];
  const r=ALL_RES[curIdx];
  const voted=r.p+r.c+r.a;const pctP=r.total?Math.round(r.p/r.total*100):0;const pctC=r.total?Math.round(r.c/r.total*100):0;const pctA=r.total?Math.round(r.a/r.total*100):0;
  const done=ALL_RES.filter(x=>x.s==="voted").length;

  /* Auto-advance: proclamer → transition → next (immutable state update) */
  const proclamer=()=>{
    setAllRes(prev=>prev.map((x,i)=>i===curIdx?{...x,s:"voted"}:x));
    if(curIdx<ALL_RES.length-1){
      setTransitioning(true);
      setTimeout(()=>{setAllRes(prev=>prev.map((x,i)=>i===curIdx+1?{...x,s:"voting"}:x));setCurIdx(curIdx+1);setSubTab("resultat");setVo(true);setTransitioning(false)},600);
    }else{{addToast&&addToast("Toutes les résolutions votées.","success");setTimeout(()=>go("postsession"),1200);};go("postsession")}
  };

  /* Guidance message */
  const guidance=r.s==="voting"?(voted>=r.total?"Tous les votants ont voté. Vous pouvez proclamer le résultat.":voted>r.total*.7?`${voted} sur ${r.total} ont voté (${Math.round(voted/r.total*100)}%). Vous pouvez proclamer ou attendre les derniers votes.`:`En attente de votes… ${voted} sur ${r.total} exprimés. Patientez ou sollicitez les retardataires.`):r.s==="voted"?"Résultat proclamé. Passez à la résolution suivante.":"En attente d'ouverture du vote.";

  return(<div className="page-anim" style={{display:"flex",flexDirection:"column",flex:1,overflow:"hidden"}}>
    {/* ═══ QUORUM NON ATTEINT — état bloquant ═══ */}
    {!quorumOk&&<div className="overlay-backdrop" role="dialog" aria-modal="true" aria-labelledby="quorum-title"><div className="modal" style={{maxWidth:400}}><div className="modal-h" style={{background:"var(--danger-bg)",borderBottom:"1px solid var(--danger)"}}><div className="t" id="quorum-title" style={{color:"var(--danger)",display:"flex",alignItems:"center",gap:8}}>{ico("alertTriangle",16)} Quorum non atteint</div></div><div className="modal-b" style={{padding:"16px 20px"}}><div style={{display:"flex",gap:20,marginBottom:16,padding:"12px 14px",background:"var(--danger-bg)",borderRadius:"var(--radius-sm)",border:"1px solid var(--danger)"}}>  <div style={{textAlign:"center"}}><div style={{fontSize:28,fontWeight:800,color:"var(--danger)",lineHeight:1}}>28</div><div style={{fontSize:13,fontWeight:700,color:"var(--danger)",textTransform:"uppercase",letterSpacing:.5,marginTop:2}}>Présents</div></div><div style={{textAlign:"center"}}><div style={{fontSize:28,fontWeight:800,color:"var(--text-muted)",lineHeight:1}}>67</div><div style={{fontSize:13,fontWeight:700,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:.5,marginTop:2}}>Inscrits</div></div><div style={{textAlign:"center"}}><div style={{fontSize:28,fontWeight:800,color:"var(--text-dark)",lineHeight:1}}>34</div><div style={{fontSize:13,fontWeight:700,color:"var(--text-dark)",textTransform:"uppercase",letterSpacing:.5,marginTop:2}}>Requis (50%+1)</div></div></div><p style={{fontSize:14,color:"var(--text-muted)",marginBottom:14,lineHeight:1.5}}>La séance ne peut pas démarrer légalement. Choisissez une option :</p><div className="flex-col" style={{gap:6}}><button className="btn btn-danger btn-block" style={{justifyContent:"flex-start",gap:10,padding:"10px 14px"}} onClick={()=>addToast&&addToast("Séance reportée. 2e convocation générée.","warn","Séance reportée")}>{ico("calendar",14)}<div style={{textAlign:"left"}}><div style={{fontWeight:700}}>Reporter</div><div style={{fontSize:13,opacity:.85}}>2e convocation automatique — quorum réduit à 33%</div></div></button><button className="btn btn-warn btn-block" style={{justifyContent:"flex-start",gap:10,padding:"10px 14px"}} onClick={()=>addToast&&addToast("Séance suspendue 30 minutes.","warn")}>{ico("clock",14)}<div style={{textAlign:"left"}}><div style={{fontWeight:700}}>Suspendre 30 min</div><div style={{fontSize:13,opacity:.85}}>En attente d'autres participants</div></div></button><button className="btn btn-block" style={{justifyContent:"flex-start",gap:10,padding:"10px 14px",borderColor:"var(--border-dash)"}} onClick={()=>setQuorumOk(true)}>{ico("alertTriangle",14)}<div style={{textAlign:"left"}}><div style={{fontWeight:700}}>Continuer sous réserve</div><div style={{fontSize:13,color:"var(--danger)"}}>Risque juridique — non recommandé</div></div></button></div></div></div></div>}

    {/* ═══ 1. HEADER COMPACT ═══ */}
    <div data-tour="op-header" style={{flexShrink:0,display:"flex",alignItems:"center",gap:10,padding:"10px 16px",borderRadius:"var(--radius)",background:"var(--surface)",border:"2px solid var(--success)",marginBottom:8,flexWrap:"wrap"}}>
      <div className="live-dot" style={{width:12,height:12,background:"var(--success)"}}/>
      <span style={{fontSize:16,fontWeight:800,color:"var(--text-dark)",flex:1}}>AG Ordinaire</span>
      <span className="live-timer">{ico("clock",14)}<span className="live-timer-val">{ft(secs)}</span></span>
      <button className="btn btn-sm" style={{minHeight:40}} onClick={()=>go("ecran")}>{ico("monitor",14)} Salle</button>
      <button className="btn btn-sm btn-danger" style={{minHeight:40}} onClick={async()=>{const ok=await cfm("Clôturer la séance ?","Cette action terminera la séance en direct et verrouillera tous les votes.","danger");if(ok)go("postsession");}}>{ico("lock",14)} Clôturer</button>
      <button className="btn btn-sm btn-ghost" style={{minHeight:40}} onClick={()=>onTour&&onTour()}>{ico("compass",14)} Guide</button>
    </div>

    {/* ═══ 2. KPI STRIP + QUORUM ═══ */}
    <div data-tour="op-kpi" style={{flexShrink:0,display:"flex",gap:6,marginBottom:6}}>
      {[{v:"45/67",l:"Présents",c:"var(--accent)"},{v:"67%",l:"Quorum ✓",c:"var(--success)"},{v:`${voted}/${r.total}`,l:"Ont voté",c:"var(--text-dark)"},{v:`${done+1}/${ALL_RES.length}`,l:"Résolution",c:"var(--text-dark)"}].map(s=>(<div key={s.l} className="card" style={{flex:1,textAlign:"center",padding:"6px 4px",margin:0}}><div style={{fontSize:13,fontWeight:700,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.5px"}}>{s.l}</div><div style={{fontFamily:"var(--font-mono)",fontSize:18,fontWeight:700,color:s.c,letterSpacing:"-0.5px",lineHeight:1.1}}>{s.v}</div></div>))}
    </div>
    <div style={{flexShrink:0,display:"flex",gap:6,marginBottom:8,flexWrap:"wrap"}}>
      <span className="tag tag-success" style={{fontSize:14,padding:"3px 8px"}}>{ico("checkCircle",14)} Quorum atteint</span>
      <span className="tag" style={{fontSize:12,padding:"2px 7px"}}>{ico("mail",12)} 7 correspondance</span>
      <span className="tag" style={{fontSize:12,padding:"2px 7px"}}>{ico("userPlus",12)} 5 procurations</span>
      <button className="btn btn-sm btn-ghost" style={{fontSize:12}} onClick={()=>setQuorumOk(false)} title="Simuler quorum non atteint (test wireframe)">{ico("alertTriangle",12)} Simuler quorum KO</button>
    </div>

    {/* ═══ 3. PROGRESS TRACK ═══ */}
    <div data-tour="op-track" style={{flexShrink:0,display:"flex",alignItems:"center",gap:4,marginBottom:8}}>
      {ALL_RES.map((x,i)=>(<div key={x.id} onClick={()=>{if(x.s!=="pending")setCurIdx(i)}} style={{flex:1,height:6,borderRadius:3,background:x.s==="voted"?"var(--success)":x.s==="voting"?"var(--accent)":"var(--tag-bg)",cursor:x.s!=="pending"?"pointer":"default",transition:"all .3s"}}/>))}
      <span style={{fontSize:14,fontWeight:700,color:"var(--text-muted)",marginLeft:4,whiteSpace:"nowrap"}}>Rés. {curIdx+1} / {ALL_RES.length}</span>
    </div>

    {/* ═══ 4. MAIN SPLIT: RESOLUTION + SIDEBAR ═══ */}
    <div style={{flex:1,display:"flex",gap:10,minHeight:0,overflow:"hidden"}}>

      {/* LEFT — RESOLUTION PANEL */}
      <div style={{flex:1,display:"flex",flexDirection:"column",minWidth:0}}>

        {transitioning?
          <div className="card" style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",borderColor:"var(--accent)",borderWidth:2}}>
            <div style={{textAlign:"center"}}><div style={{fontSize:20,fontWeight:800,color:"var(--accent)",marginBottom:4}}>Passage à la résolution suivante…</div><div style={{fontSize:14,color:"var(--text-muted)"}}>Résolution #{curIdx+2} — {ALL_RES[curIdx+1]?.t}</div></div>
          </div>
        :
          <div data-tour="op-résolution" className="card" data-tour="ps-actions" style={{flex:1,display:"flex",flexDirection:"column",borderColor:"var(--accent)",borderWidth:2,padding:16,overflow:"hidden"}}>

            {/* Resolution title + meta */}
            <div style={{flexShrink:0,marginBottom:10}}>
              <div className="flex-row" style={{gap:8,marginBottom:4,flexWrap:"nowrap"}}>
                <div className="live-dot" style={{width:10,height:10}}/>
                <span style={{fontWeight:800,color:"var(--accent)",fontSize:15}}>Résolution #{r.id}</span>
                <span className="tag tag-accent" style={{fontSize:14,padding:"2px 8px"}}>{ico("clock",14)} 04:32</span>
              </div>
              <div style={{fontWeight:800,color:"var(--text-dark)",fontSize:18,marginBottom:4}}>{r.t}</div>
              <div className="flex-row" style={{gap:4,flexWrap:"wrap"}}>
                <span className="tag" style={{fontSize:14}}>Maj. {r.maj}</span>
                <span className="tag" style={{fontSize:14}}>{ico("layers",14)} {r.cle}</span>
                {r.secret&&<span className="tag tag-purple" style={{fontSize:14}}>{ico("lock",14)} Secret</span>}
              </div>
            </div>

            {/* Sub-tabs: Résultat / Avancé / Présences */}
            <div data-tour="op-tabs" style={{flexShrink:0,display:"flex",gap:2,marginBottom:10,borderBottom:"2px solid var(--border)"}}>
              {[{k:"resultat",l:"Résultat",i:"vote"},{k:"avance",l:"Avancé",i:"settings"},{k:"presences",l:"Présences",i:"users"}].map(t=>(<button key={t.k} onClick={()=>setSubTab(t.k)} style={{padding:"8px 16px",fontSize:14,fontWeight:subTab===t.k?800:600,color:subTab===t.k?"var(--accent)":"var(--text-muted)",background:"transparent",border:"none",borderBottom:subTab===t.k?"3px solid var(--accent)":"3px solid transparent",cursor:"pointer",display:"flex",alignItems:"center",gap:4,transition:"all .2s"}}>{ico(t.i,14)} {t.l}</button>))}
            </div>

            {/* Sub-tab content — scrollable */}
            <div style={{flex:1,overflowY:"auto",minHeight:0,paddingBottom:8}}>

              {/* ── RÉSULTAT ── */}
              {subTab==="resultat"&&<>
                {/* Vote control + live progress */}
                <div style={{display:"flex",gap:8,marginBottom:10}}>
                  <button data-op-vote-toggle className={`btn ${r.s==="voting"?"btn-danger":"btn-success"}`} style={{flex:1,minHeight:44,fontSize:15,fontWeight:800}} onClick={()=>{if(r.s==="voting"){setAllRes(prev=>prev.map((x,i)=>i===curIdx?{...x,s:"paused"}:x));addToast&&addToast("Vote fermé — dépouillement en cours.","warn","Vote fermé")}else{setAllRes(prev=>prev.map((x,i)=>i===curIdx?{...x,s:"voting"}:x));addToast&&addToast("Vote ouvert pour la résolution #"+(curIdx+1)+".","success","Vote ouvert")}}}>{r.s==="voting"?<>{ico("lock",16)} Fermer le vote</>:<>{ico("play",16)} Ouvrir le vote</>}</button>
                  <button data-op-proclamer className="btn btn-p" style={{flex:1,minHeight:44,fontSize:15,fontWeight:800}} disabled={r.s==="pending"} onClick={()=>proclamer()}>{ico("check",16)} Proclamer</button>
                </div>
                {/* Live counter bar */}
                <div style={{background:"var(--surface-alt)",borderRadius:"var(--radius-sm)",padding:"8px 12px",marginBottom:10}}>
                  <div className="flex-between" style={{marginBottom:4}}><span style={{fontSize:13,fontWeight:700,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:.5}}>Progression du vote</span><span style={{fontFamily:"var(--font-mono)",fontSize:15,fontWeight:800,color:voted>=r.total?"var(--success)":"var(--accent)"}}>{voted} / {r.total} ({r.total?Math.round(voted/r.total*100):0}%)</span></div>
                  <div style={{height:8,background:"var(--border-soft)",borderRadius:4,overflow:"hidden"}}><div style={{height:"100%",width:`${r.total?Math.round(voted/r.total*100):0}%`,background:voted>=r.total?"var(--success)":"var(--accent)",borderRadius:4,transition:"width .4s ease"}}/></div>
                  {voted>=r.total&&<div style={{fontSize:13,fontWeight:700,color:"var(--success)",marginTop:4,display:"flex",alignItems:"center",gap:4}}>{ico("checkCircle",13)} Tous les votants ont voté — prêt à proclamer</div>}
                </div>
                <div aria-live="polite" aria-atomic="true">
                {[{l:"Pour",v:r.p,c:"var(--success)",pct:pctP},{l:"Contre",v:r.c,c:"var(--danger)",pct:pctC},{l:"Abstention",v:r.a,c:"var(--text-light)",pct:pctA}].map(b=>(<div key={b.l} style={{marginBottom:8}}><div className="flex-between" style={{marginBottom:3}}><span style={{fontSize:14,fontWeight:800,color:b.c}}>{b.l} : {b.v}</span><span style={{fontSize:14,fontWeight:700,color:"var(--text-muted)"}}>{b.pct}%</span></div><div className="progress-bar" style={{height:14}} role="progressbar" aria-valuenow={b.pct} aria-valuemin={0} aria-valuemax={100} aria-label={`${b.l} : ${b.pct}%`}><div className="progress-fill" style={{width:`${b.pct}%`,background:b.c,borderRadius:6}}/></div></div>))}
                {pctP===pctC&&r.p>0&&<div className="badge-tie">{ico("alertTriangle",14)} Égalité Pour/Contre — voix prépondérante du président à appliquer (art. 22)</div>}
                <div className="flex-between" style={{padding:"8px 0",borderTop:"1px solid var(--border-soft)"}}><span style={{fontSize:14,fontWeight:600,color:"var(--text-muted)"}}>Exprimés</span><span style={{fontWeight:800,color:"var(--text-dark)",fontSize:15}}>{voted} / {r.total}</span></div>
                {r.s==="voted"&&<div className="timestamp-label" style={{marginTop:4}}>{ico("clock",13)} Proclamé le {new Date().toLocaleDateString("fr-FR")} à {new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}</div>}
                </div>
                {missing.length>0&&<div style={{fontSize:14,color:"var(--danger)",marginTop:2}}>{ico("alertTriangle",14)} {missing.length} n'ont pas voté — <button style={{background:"none",border:"none",color:"var(--accent)",fontWeight:700,cursor:"pointer",textDecoration:"underline",fontSize:14}} onClick={()=>setSubTab("avance")}>voir détails</button></div>}
              </>}

              {/* ── AVANCÉ ── */}
              {subTab==="avance"&&<>
                {/* Comptage manuel */}
                <div style={{marginBottom:14}}>
                  <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:6}}>{ico("edit")} Comptage manuel (vote papier) <HelpTip text="Pour les votants ne pouvant pas utiliser la tablette."/></div>
                  <div className="flex-row" style={{gap:6,marginBottom:6}}>
                    <div className="field" style={{margin:0,flex:1}}><label className="field-label" style={{fontSize:14}} htmlFor="mc-pour">Pour</label><input id="mc-pour" className="field-input" type="number" placeholder="0" min="0" style={{minHeight:40}} onInput={e=>{if(e.target.value<0)e.target.value=0}}/></div>
                    <div className="field" style={{margin:0,flex:1}}><label className="field-label" style={{fontSize:14}} htmlFor="mc-contre">Contre</label><input id="mc-contre" className="field-input" type="number" placeholder="0" min="0" style={{minHeight:40}} onInput={e=>{if(e.target.value<0)e.target.value=0}}/></div>
                    <div className="field" style={{margin:0,flex:1}}><label className="field-label" style={{fontSize:14}} htmlFor="mc-abst">Abst.</label><input id="mc-abst" className="field-input" type="number" placeholder="0" min="0" style={{minHeight:40}} onInput={e=>{if(e.target.value<0)e.target.value=0}}/></div>
                  </div>
                  <button className="btn btn-sm" onClick={()=>addToast&&addToast("Résultats intégrés. Journal d'audit mis à jour.","success","Opération enregistrée")}>{ico("plusCircle",14)} Intégrer au résultat</button>
                  <div className="muted" style={{fontSize:13,marginTop:4}}>{ico("shield",13)} Toute modification est tracée dans le journal d'audit.</div>
                </div>
                {/* N'ont pas voté */}
                <div style={{marginBottom:14,paddingTop:10,borderTop:"1px solid var(--border-soft)"}}>
                  <div style={{fontSize:14,fontWeight:700,color:"var(--danger)",marginBottom:6}}>{ico("alertTriangle")} N'ont pas voté ({missing.length})</div>
                  <div style={{display:"flex",flexWrap:"wrap",gap:4}}>{missing.map(m=>(<span key={m.n} className="tag tag-danger" style={{cursor:"pointer",fontSize:14}} onClick={()=>setShowProxy(true)}>{m.n} ({m.t} voix)</span>))}</div>
                </div>
                {/* Passerelle */}
                <div className="alert alert-warn" style={{cursor:"pointer",border:"2px solid var(--warn)"}} onClick={()=>addToast&&addToast("2nd vote lancé à la majorité simple (art. 24).","info","Art. 24")}>
                  <strong>{ico("alertTriangle")} Passerelle art. 25-1</strong>
                  <div style={{fontSize:14,color:"var(--text-muted)",marginTop:2}}>Si le seuil d'1/3 des voix est franchi, un 2nd vote en majorité simple est possible. <strong>Cliquez pour activer.</strong></div>
                </div>
                {/* Actions secondaires */}
                <div className="flex-row" style={{gap:6,marginTop:10}}>
                  <button className="btn btn-sm" onClick={()=>setShowUnanim(true)}>{ico("users",14)} Unanimité</button>
                  <button className="btn btn-sm" onClick={()=>setShowProxy(true)}>{ico("userPlus",14)} Procuration</button>
                  <button className="btn btn-sm" onClick={()=>addToast&&addToast("Séance suspendue.","warn","Pause")}>{ico("clock",14)} Suspendre</button>
                </div>
                {/* Notes */}
                <div style={{marginTop:12}}><div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:4}}>{ico("fileText")} Notes du secrétaire</div><CTA placeholder="Ex : Un participant demande un décompte des voix…" max={2000} rows={2}/></div>
              </>}

              {/* ── PRÉSENCES ── */}
              {subTab==="presences"&&<>
                <div className="flex-row" style={{gap:6,marginBottom:10}}>{[{v:"45/67",l:"Présents",c:"var(--success)"},{v:"5",l:"Procurations",c:"var(--accent)"},{v:"7",l:"Correspondance",c:"var(--text-dark)"},{v:"67%",l:"Quorum",c:"var(--success)"}].map(s=>(<div key={s.l} className="card" style={{flex:1,textAlign:"center",padding:8,margin:0}}><div style={{fontFamily:"var(--font-mono)",fontSize:17,fontWeight:700,color:s.c,letterSpacing:"-0.3px"}}>{s.v}</div><div style={{fontSize:14,color:"var(--text-muted)",fontWeight:600}}>{s.l}</div></div>))}</div>
                <div className="table-wrap" style={{fontSize:14}}><table><thead><tr><th>Participant</th><th>Poids</th><th>Statut</th><th>Action</th></tr></thead>
                <tbody>{[{n:"Participant 1",l:"Lot 12",t:320,s:"present"},{n:"Membre A",l:"Lot 5",t:450,s:"present"},{n:"Membre E",l:"Lot 7",t:180,s:"procuration",m:"Membre D"},{n:"Participant 2",l:"Lot 8",t:280,s:"present"},{n:"SCI Exemple",l:"Lots 12-13",t:210,s:"present"},{n:"M. Roux André",l:"Lot 15",t:150,s:"absent"}].map((m,i)=>(<tr key={i}>
                  <td><div style={{fontWeight:600,color:"var(--text-dark)"}}>{m.n}</div><span className="muted" style={{fontSize:14}}>{m.l}</span></td>
                  <td style={{fontWeight:700}}>{m.t}</td>
                  <td><span className={`tag ${m.s==="present"?"tag-success":m.s==="procuration"?"tag-accent":"tag-danger"}`} style={{fontSize:14}}>{m.s==="present"?"Présent":m.s==="procuration"?`Proc. → ${m.m}`:"Absent"}</span></td>
                  <td><div className="flex-row" style={{gap:4}}><button className="btn btn-sm btn-ghost" style={{minHeight:40}} onClick={()=>addToast&&addToast(`${m.n} marqué ${m.s==="present"?"absent":"présent"}.`,"info")}>{ico(m.s==="absent"?"userPlus":"x",14)}</button></div></td>
                </tr>))}</tbody></table></div>
                <div className="ctx-panel" style={{marginTop:8}}><h4>{ico("lightbulb")} Clé active</h4><p>Clé : <strong>{r.cle}</strong> — Les poids affichés correspondent à la clé de la résolution en cours. Les «—» signifient que le membre ne vote pas sur cette résolution.</p></div>
              </>}
            </div>

            {/* ── ACTION BAR (pinned at bottom) ── */}
            <div data-tour="op-actions" style={{flexShrink:0,borderTop:"2px solid var(--border)",paddingTop:10,display:"flex",justifyContent:"center",gap:10}}>
              <button className="btn btn-success" data-op-proclamer style={{minHeight:38,fontSize:14,fontWeight:800,padding:"0 22px",borderRadius:8,boxShadow:"0 2px 8px rgba(22,163,74,.2)",maxWidth:240}} onClick={proclamer}>{ico("check",14)} Proclamer<span className="op-kbd" aria-hidden="true">P</span></button>
              <button className={`btn ${vo?"btn-danger":"btn-p"}`} data-op-vote-toggle style={{minHeight:38,fontSize:14,fontWeight:800,padding:"0 22px",borderRadius:8,maxWidth:240}} onClick={()=>setVo(!vo)}>{vo?<>{ico("lock",14)} Fermer<span className="op-kbd" aria-hidden="true">F</span></>:<>{ico("unlock",14)} Rouvrir</>}</button>
            </div>
          </div>
        }
      </div>

      {/* RIGHT SIDEBAR — ORDRE DU JOUR */}
      <div data-tour="op-odj" style={{width:200,flexShrink:0,display:"flex",flexDirection:"column",gap:0,overflow:"hidden"}}>
        <div className="card" style={{flex:1,padding:0,display:"flex",flexDirection:"column",overflow:"hidden"}}>
          <div style={{padding:"10px 12px",borderBottom:"2px solid var(--border)",fontWeight:800,fontSize:14,color:"var(--text-dark)"}}>{ico("clipboard")} Ordre du jour</div>
          <div style={{flex:1,overflowY:"auto"}}>
            {ALL_RES.map((x,i)=>(<div key={x.id} onClick={()=>{if(x.s!=="pending"){setCurIdx(i);setSubTab("resultat")}}} style={{padding:"8px 12px",borderBottom:"1px solid var(--border-soft)",background:i===curIdx?"var(--accent-light)":"transparent",cursor:x.s!=="pending"?"pointer":"default",transition:"all .2s"}}>
              <div className="flex-row" style={{gap:6,flexWrap:"nowrap"}}>
                <div style={{width:22,height:22,borderRadius:"50%",background:x.s==="voted"?"var(--success)":x.s==="voting"?"var(--accent)":"var(--tag-bg)",display:"flex",alignItems:"center",justifyContent:"center",color:x.s==="pending"?"var(--text-muted)":"#fff",fontSize:14,fontWeight:800,flexShrink:0}}>{x.s==="voted"?<LI name="check" size={12} color="#fff"/>:x.id}</div>
                <div style={{minWidth:0}}>
                  <div style={{fontSize:14,fontWeight:i===curIdx?800:600,color:i===curIdx?"var(--accent)":"var(--text-dark)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{x.t}</div>
                  {x.s==="voted"&&<div style={{fontSize:14,color:"var(--text-muted)"}}>{x.p}P / {x.c}C / {x.a}A</div>}
                </div>
              </div>
            </div>))}
          </div>
          {/* Parole floating */}
          <div data-tour="op-parole" style={{padding:"8px 12px",borderTop:"2px solid var(--border)",background:hc>0?"var(--warn-bg)":"transparent",cursor:"pointer"}} onClick={()=>{if(hc>0)addToast&&addToast(`${hands[0].name} a la parole.`,"info")}}>
            <div className="flex-row" style={{gap:6,justifyContent:"center"}}><LI name="hand" size={16} color={hc>0?"var(--warn)":"var(--text-muted)"}/><span style={{fontSize:14,fontWeight:700,color:hc>0?"var(--warn)":"var(--text-muted)"}}>{hc>0?`${hc} demande${hc>1?"s":""} de parole`:"Aucune demande"}</span></div>
          </div>
        </div>
      </div>
    </div>

    {/* ═══ 5. GUIDANCE BAR ═══ */}
    <div data-tour="op-guidance" style={{flexShrink:0,marginTop:8,padding:"10px 16px",borderRadius:"var(--radius)",background:"var(--accent-light)",border:"1px solid var(--accent)",display:"flex",alignItems:"center",gap:8}}>
      <LI name="lightbulb" size={18} color="var(--accent)"/>
      <span style={{flex:1,fontSize:14,fontWeight:600,color:"var(--accent)"}}>{guidance}</span>
      {hc>0&&<span className="tag tag-warn" style={{fontSize:14,cursor:"pointer"}} onClick={()=>addToast&&addToast(`${hands[0].name} a maintenant la parole.`,"success")}>{ico("hand",14)} {hc} parole{hc>1?"s":""}</span>}
    </div>

    {/* MODALS */}
    {showProxy&&<Modal title="Attribuer une procuration" onClose={()=>setShowProxy(false)} footer={<><button className="btn" onClick={()=>setShowProxy(false)}>Annuler</button><button className="btn btn-p" onClick={()=>{setShowProxy(false);addToast&&addToast("Procuration enregistrée.","success")}}>{ico("check")} Confirmer</button></>}>
      <div className="field"><label className="field-label">Mandant (absent)</label><select className="field-input"><option>M. Roux André (150 voix)</option><option>Copropriétaire D (95 voix)</option><option>SCI Rouge (320 voix)</option></select></div>
      <div className="field"><label className="field-label">Mandataire (présent)</label><select className="field-input"><option>Copropriétaire A</option><option>Copropriétaire B</option><option>Copropriétaire C</option></select></div>
      <div className="ctx-panel"><h4>{ico("lightbulb")} Contrôles automatiques</h4><p>Plafond : 3 procurations max. par mandataire. Chaînes de procuration interdites. Impact immédiat sur quorum et pondération.</p></div>
    </Modal>}
    {showUnanim&&<Modal title="Déclarer l'unanimité" onClose={()=>setShowUnanim(false)} footer={<><button className="btn" onClick={()=>setShowUnanim(false)}>Annuler</button><button className="btn btn-success" onClick={()=>{setShowUnanim(false);addToast&&addToast("Unanimité proclamée.","success","Unanimité")}}>{ico("check")} Confirmer l'unanimité</button></>}>
      <div className="alert alert-success">{ico("checkCircle")} Tous les votants présents et représentés votent <strong>Pour</strong>. La résolution est adoptée à l'unanimité.</div>
      <p style={{color:"var(--text-muted)",fontSize:14}}>Cette action enregistre automatiquement {r.total} voix Pour, 0 Contre, 0 Abstention et proclame le résultat.</p>
    </Modal>}
  </div>)};
const PagePostSession=({go,onTour,addToast})=>{const[step,setStep]=useState(1);const[validated,setValidated]=useState(false);return(<div className="page-anim" style={{display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0}}><PH page="postsession" icon="fileText" title="Clôture et PV" sub="Vérification, validation et archivage" right={<div className="flex-row" style={{gap:6}}><button className="btn btn-sm btn-ghost" onClick={()=>onTour&&onTour()}>{ico("compass",14)} Visite guidée</button><button className="btn btn-sm" onClick={()=>go("hub")}>{ico("chevL")} Retour</button></div>}/>

  {/* PROGRESS — étapes visuelles */}
  <div data-tour="ps-stepper" style={{display:"flex",gap:4,marginBottom:18}}>{[{n:1,l:"Vérification"},{n:2,l:"Validation"},{n:3,l:"Procès-verbal"},{n:4,l:"Envoi et archivage"}].map(s=>(<div key={s.n} style={{flex:1,cursor:s.n<=step?"pointer":"default",padding:"12px 14px",borderRadius:"var(--radius-sm)",background:s.n===step?"var(--accent)":s.n<step?"var(--success)":"var(--tag-bg)",color:s.n<=step?"#fff":"var(--text-muted)",fontWeight:s.n===step?800:600,fontSize:15,textAlign:"center",transition:"all .2s"}} onClick={()=>{if(s.n<=step)setStep(s.n)}}>
    {s.n<step?<LI name="check" size={14} color="#fff"/>:`${s.n}.`} {s.l}
  </div>))}</div>

  {/* CONTENT — grande card, scrollable, footer épinglé */}
  <div className="card" style={{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minHeight:0}}>
    <div style={{flex:1,overflowY:"auto",minHeight:0,padding:"4px 0 12px"}}>

    {step===1&&<><div className="h3" style={{marginBottom:12}}>{ico("checkCircle")} Vérification des résultats</div>
      <div className="alert alert-success" style={{marginBottom:14}}>{ico("checkCircle")} Tous les votes sont clos. Aucune anomalie détectée.</div>
      <div className="table-wrap"><table><thead><tr><th>#</th><th>Résolution</th><th>Résultat</th><th>Pour / Contre / Abst.</th><th>Majorité</th></tr></thead><tbody>{[{n:1,t:"Comptes 2025",m:"Art. 24",p:38,c:5,a:2,r:true},{n:2,t:"Président CS",m:"Art. 25",p:42,c:1,a:2,r:true},{n:3,t:"Budget 2026",m:"Art. 24",p:28,c:8,a:3,r:true},{n:4,t:"Ravalement",m:"Art. 26",p:18,c:22,a:5,r:false},{n:5,t:"Bornes VE",m:"Art. 24",p:35,c:6,a:4,r:true}].map(r=>(<tr key={r.n}><td style={{fontWeight:700}}>{r.n}</td><td style={{fontWeight:600,color:"var(--text-dark)"}}>{r.t}</td><td><span className={`tag ${r.r?"tag-success":"tag-danger"}`}>{r.r?<>{ico("check",11)} Adoptée</>:<>{ico("x",11)} Rejetée</>}</span></td><td><span style={{color:"var(--success)",fontWeight:700}}>{r.p}</span> / <span style={{color:"var(--danger)",fontWeight:700}}>{r.c}</span> / <span style={{color:"var(--text-muted)"}}>{r.a}</span></td><td><span className="tag tag-accent" style={{fontSize:14}}>{r.m}</span></td></tr>))}</tbody></table></div>
    </>}

    {step===2&&<><div className="h3" style={{marginBottom:12}}>{ico("lock")} Validation officielle</div>
      <div className="alert alert-warn" style={{marginBottom:14}}>{ico("alertTriangle")} <strong>Attention :</strong> La validation est irréversible.</div>
      <div style={{padding:18,background:"var(--surface-alt)",borderRadius:"var(--radius-sm)",marginBottom:16}}>
        <div className="grid-3" style={{gap:10}}>{[{l:"Présents",v:"45 / 67",c:"var(--accent)"},{l:"Résolutions",v:"5 votées",c:"var(--success)"},{l:"Quorum",v:"67.3% ✓",c:"var(--success)"}].map(s=>(<div key={s.l} style={{textAlign:"center",padding:10}}><div style={{fontSize:22,fontWeight:800,color:s.c}}>{s.v}</div><div style={{fontSize:14,fontWeight:600,color:"var(--text-muted)"}}>{s.l}</div></div>))}</div>
      </div>
      {/* ACTION PRINCIPALE TRÈS VISIBLE */}
      <div style={{display:"flex",gap:12,justifyContent:"center",maxWidth:520,margin:"0 auto"}}>
        <button className={`btn ${validated?"btn-success":""}`} style={{minHeight:44,fontSize:15,fontWeight:800,justifyContent:"center",borderRadius:"var(--radius)",border:validated?"none":"2px solid var(--success)",boxShadow:validated?"0 4px 12px rgba(22,163,74,.2)":"none",flex:1}} onClick={()=>setValidated(true)}>{validated?ico("checkCircle",16):ico("check",16)} {validated?"Validé par le président":"Oui, je valide"}</button>
        <button className="btn" style={{minHeight:44,fontSize:15,fontWeight:700,justifyContent:"center",borderRadius:"var(--radius)",border:"2px solid var(--border)",flex:1}} onClick={()=>setValidated(false)}>{ico("x",16)} Non, revenir</button>
      </div>
    </>}

    {step===3&&<><div className="h3" style={{marginBottom:12}}>{ico("fileText")} Procès-verbal</div>
      <div className="alert alert-success" style={{marginBottom:14}}>{ico("lock")} Séance validée — PV verrouillé.</div>
      <div className="row"><div className="field"><label className="field-label">Président</label><input className="field-input" defaultValue="Participant 1" readOnly style={{background:"var(--surface-alt)"}} maxLength={200} autoComplete="off"/></div><div className="field"><label className="field-label">Secrétaire</label><input className="field-input" defaultValue="Membre A" readOnly style={{background:"var(--surface-alt)"}} maxLength={200} autoComplete="off"/></div></div>
      <div className="row"><div className="field"><label className="field-label">Scrutateur 1</label><input className="field-input" defaultValue="Membre E" readOnly style={{background:"var(--surface-alt)"}} maxLength={200} autoComplete="off"/></div><div className="field"><label className="field-label">Scrutateur 2</label><input className="field-input" defaultValue="Participant 2" readOnly style={{background:"var(--surface-alt)"}} maxLength={200} autoComplete="off"/></div></div>
      <div className="field"><label className="field-label">Observations du président</label><CTA placeholder="Ex : Séance déroulée sans incident." max={2000} rows={3}/></div>
      <div className="field"><label className="field-label">Réserves et contestations <HelpTip text="Ces réserves seront inscrites au PV et feront foi en cas de contestation judiciaire."/></label><CTA placeholder="Ex : Un copropriétaire conteste le quorum à 14h32." max={2000} rows={2} style={{borderColor:"var(--warn)"}}/></div>
      <div className="alert alert-warn" style={{margin:"0 0 12px"}}>{ico("clock")} <strong>Délai de contestation :</strong> le PV doit être notifié dans le délai prévu par vos statuts.</div>
      {/* SIGNATURE eIDAS */}
      <div style={{padding:14,background:"var(--surface-alt)",borderRadius:"var(--radius-sm)",border:"1px solid var(--border)"}}>
        <div className="flex-between" style={{marginBottom:8}}><span style={{fontSize:14,fontWeight:700,color:"var(--text-dark)"}}>{ico("lock")} Signature électronique du PV</span><HelpTip text="Conformité eIDAS : la signature électronique qualifiée garantit la valeur juridique maximale du PV. La signature avancée est suffisante pour les AG de copropriété."/></div>
        <div className="flex-row" style={{gap:6,marginBottom:8}}>
          <span className="chip active">Signature avancée (eIDAS)</span>
          <span className="chip">Signature qualifiée (eIDAS+)</span>
          <span className="chip">Manuscrite (impression)</span>
        </div>
        <div className="flex-row" style={{gap:8}}>
          <button className="btn btn-sm btn-p" onClick={()=>addToast&&addToast("Courriel de signature envoyé au président.","success","Signature demandée")}>{ico("edit",14)} Signer — Président</button>
          <button className="btn btn-sm" onClick={()=>addToast&&addToast("Courriel de signature envoyé au secrétaire.","success","Signature demandée")}>{ico("edit",14)} Signer — Secrétaire</button>
          <span className="tag tag-success" style={{fontSize:14}}>{ico("check",14)} 0/2 signatures</span>
        </div>
      </div>
    </>}

    {step===4&&<><div className="h3" style={{marginBottom:12}}>{ico("send")} Envoi et archivage</div>
      <div className="alert alert-success" style={{marginBottom:14}}>{ico("checkCircle")} PV signé et verrouillé. Prêt à être envoyé.</div>

      {/* ACTION PRINCIPALE — ENVOYER LE PV */}
      <div className="card" style={{marginBottom:14,border:"2px solid var(--success)",padding:16,background:"var(--success-bg)"}}>
        <div className="flex-between" style={{marginBottom:8}}><div className="card-title" style={{margin:0,color:"var(--success)",fontSize:15}}>{ico("fileText")} PV — AG Ordinaire</div><button className="btn btn-sm" onClick={()=>addToast&&addToast("PV téléchargé en PDF.","success")}>{ico("download")} PDF</button></div>
        <div style={{fontSize:14,color:"var(--text-muted)",marginBottom:10}}>5 résolutions • 45 présents sur 67 • Signé par M. Exemple Pierre</div>
        <div style={{display:"flex",justifyContent:"center"}}><button className="btn btn-success" style={{minHeight:44,fontSize:15,fontWeight:800,justifyContent:"center",borderRadius:"var(--radius)",boxShadow:"0 4px 12px rgba(22,163,74,.25)",maxWidth:380,flex:1}} onClick={()=>addToast&&addToast("PV envoyé à 67 participants.","success","PV distribué")}>{ico("send",16)} Envoyer le PV à tous (67)</button></div>
      </div>

      {/* EXPORTS + ARCHIVAGE */}
      <div className="grid-2"><div className="card" style={{padding:14}}><div className="card-title" style={{marginBottom:8}}>{ico("download")} Exports</div>{["PV (PDF)","Feuille d'émargement (PDF)","Votes par correspondance (PDF)","Présences (CSV)","Votes détail (CSV)","Résultats par clé (CSV)","Audit (CSV)"].map((e,i)=>(<div key={i} className="flex-between" style={{padding:"5px 0",borderBottom:i<6?"1px solid var(--border-soft)":"none"}}><span style={{fontSize:14,fontWeight:600,color:"var(--text-dark)"}}>{e}</span><button className="btn btn-sm btn-ghost" style={{padding:"4px 10px"}} onClick={()=>addToast&&addToast(`Fichier ${e} téléchargé.`,"success")}>{ico("download",14)}</button></div>))}</div>
        <div className="card" style={{padding:14,display:"flex",flexDirection:"column"}}><div className="card-title" style={{marginBottom:8}}>{ico("archive")} Archivage</div><div style={{fontSize:14,color:"var(--text-muted)",marginBottom:10,flex:1}}>La séance sera déplacée dans les archives. Cette action est définitive.</div><button className="btn" style={{maxWidth:260,minHeight:44,justifyContent:"center",fontSize:14,fontWeight:700,border:"2px solid var(--border)"}} onClick={()=>{addToast&&addToast("Séance archivée avec succès.","success","Archivage");if(go)setTimeout(()=>go("archives"),1400);}}>{ico("archive")} Archiver la séance</button></div></div>
    </>}
    </div>

    {/* PINNED NAV FOOTER */}
    <div className="step-nav" style={{marginTop:0,flexShrink:0}}>
      <button className="btn" onClick={()=>{if(step>1)setStep(step-1)}} disabled={step===1}>{ico("chevL")} {step===1?"":"Précédent"}</button>
      <span style={{fontSize:15,fontWeight:800,color:"var(--text-muted)"}}>Étape {step} / 4</span>
      {step<4?<button className="btn btn-p" style={{minWidth:180}} onClick={()=>setStep(step+1)}>{step===2&&!validated?"Valider d'abord":"Suivant"} {ico("chevR")}</button>:<button className="btn btn-success" style={{minWidth:180}} onClick={()=>{go("archives");addToast&&addToast("Séance archivée.","success")}}>{ico("check")} Terminé</button>}
    </div>
  </div>
</div>)};
/* ═══ VOTANT — ONE SCREEN, ZERO SCROLL ═══ */
const PageVotant=()=>{const[sel,setSel]=useState(null);const[voted,setVoted]=useState(false);const[hand,setHand]=useState("idle");const[conf,setConf]=useState(false);const[big,setBig]=useState(true);const[timer,setTimer]=useState(272);
  useEffect(()=>{if(voted||timer<=0)return;const t=setInterval(()=>setTimer(s=>Math.max(0,s-1)),1000);return()=>clearInterval(t)},[voted,timer]);
  const fmt=s=>`${Math.floor(s/60)}:${String(s%60).padStart(2,"0")}`;
  const fs=big?1.2:1;
  const resProgress=[{s:"done"},{s:"done"},{s:"active"},{s:"next"},{s:"next"}];
  const CHOICES=[{l:"Pour",c:"#16A34A",bg:"#DCFCE7",ico:"thumbsUp"},{l:"Contre",c:"#DC2626",bg:"#FEE2E2",ico:"thumbsDown"},{l:"Abstention",c:"#6B7280",bg:"#E5E7EB",ico:"minusCircle"},{l:"NSP",c:"#9CA3AF",bg:"#F3F4F6",ico:"helpCircle"}];
  const selData=CHOICES.find(b=>b.l===sel);
  return(<div style={{display:"flex",flexDirection:"column",height:"100%",justifyContent:"space-between",padding:10,gap:6,overflow:"hidden",background:"#F8FAFC"}}>
    {/* HEADER — tablet status bar */}
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,padding:"4px 6px",borderRadius:10,background:"#fff",border:"1px solid var(--border-soft)"}}>
      <div className="flex-row" style={{gap:8,flexWrap:"nowrap"}}><div style={{width:10*fs,height:10*fs,borderRadius:"50%",background:"var(--success)",boxShadow:"0 0 6px rgba(22,163,74,.4)"}}/><span style={{fontSize:15*fs,fontWeight:800,color:"var(--text-dark)"}}>Résolution 3 / 5</span></div>
      <div className="flex-row" style={{gap:6}}>
        <span style={{fontSize:14*fs,fontWeight:700,color:timer<60?"var(--danger)":"var(--text-muted)",fontFamily:"monospace",background:timer<60?"var(--danger-bg)":"transparent",padding:"2px 8px",borderRadius:6}}>{fmt(timer)}</span>
        <button className="btn btn-sm" style={{fontSize:14,padding:"6px 12px",minHeight:40}} onClick={()=>setBig(!big)}>{big?<>{ico("eye",14)} Réduire</>:<>{ico("eye",14)} Grossir</>}</button>
      </div>
    </div>
    {/* RESOLUTION PROGRESS */}
    <div style={{display:"flex",gap:4,justifyContent:"center",flexShrink:0}}>
      {resProgress.map((r,i)=>(<div key={i} style={{width:r.s==="active"?24*fs:12*fs,height:6*fs,borderRadius:3*fs,background:r.s==="done"?"#16A34A":r.s==="active"?"#2563EB":"#D1D5DB",transition:"width .2s"}}/>))}
    </div>
    {/* TITLE */}
    <div style={{textAlign:"center",flexShrink:0,padding:"4px 0"}}>
      <div style={{fontSize:22*fs,fontWeight:800,color:"var(--text-dark)"}}>{voted?"Vote enregistré !":"Budget prévisionnel 2026"}</div>
      <div style={{fontSize:15*fs,color:"var(--text-muted)",marginTop:2}}>{voted?"La résolution suivante s'affichera automatiquement.":"Majorité simple (art. 24)"}</div>
    </div>
    {/* VOTE AREA */}
    {!voted?<div style={{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:10}}>
      {/* Vote buttons — 2×2 grid with semantic colors */}
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
        {CHOICES.map(b=>(<button key={b.l} onClick={()=>{setSel(b.l);setConf(false)}} style={{height:72*fs,borderRadius:14,border:`3px solid ${sel===b.l?b.c:"transparent"}`,background:sel===b.l?b.bg:b.bg+"80",fontSize:17*fs,fontWeight:800,color:sel===b.l?b.c:b.c+"B0",display:"flex",alignItems:"center",justifyContent:"center",gap:10,cursor:"pointer",transition:"all .15s",boxShadow:sel===b.l?`0 4px 16px ${b.c}25`:"none"}}><LI name={b.ico} size={24*fs} color={sel===b.l?b.c:b.c+"B0"}/>{b.l}</button>))}
      </div>
      {/* Confirm — in selection color */}
      {sel&&!conf&&<button onClick={()=>setConf(true)} style={{height:56*fs,borderRadius:14,border:"none",background:selData.c,color:"#fff",fontSize:17*fs,fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:10,boxShadow:`0 6px 20px ${selData.c}40`}}><LI name="check" size={22*fs} color="#fff"/>Confirmer : {sel}</button>}
      {conf&&<button onClick={()=>setVoted(true)} style={{height:56*fs,borderRadius:14,border:"none",background:selData.c,color:"#fff",fontSize:17*fs,fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:10,animation:"pulse 1.5s infinite",boxShadow:`0 6px 20px ${selData.c}40`}}><LI name="hand" size={22*fs} color="#fff"/>Appuyez pour valider</button>}
    </div>
    :<div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10}}>
      <div style={{width:56*fs,height:56*fs,borderRadius:"50%",background:selData?selData.c:"var(--success)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 8px 24px ${selData?selData.c:"var(--success)"}40`}}><LI name="check" size={30*fs} color="#fff"/></div>
      <div style={{fontSize:18*fs,fontWeight:800,color:selData?selData.c:"var(--success)"}}>Merci — {sel||"Vote"} enregistré</div>
      <div className="flex-row" style={{justifyContent:"center",marginTop:8,gap:6}}>{[0,1,2].map(i=>(<div key={i} style={{width:8,height:8,borderRadius:"50%",background:selData?selData.c:"var(--accent)",opacity:.4,animation:`pulse 1.2s ${i*.3}s infinite`}}/>))}</div>
    </div>}
    {/* POIDS + ID */}
    <div style={{flexShrink:0,borderTop:"2px solid var(--border-soft)",paddingTop:8,background:"#fff",margin:"0 -10px",padding:"8px 10px",borderRadius:"0 0 10px 10px"}}>
      <div className="flex-row" style={{gap:8,flexWrap:"nowrap"}}><div style={{width:12,height:12,borderRadius:"50%",background:"var(--success)",flexShrink:0}}/><span style={{fontSize:15*fs,fontWeight:700,color:"var(--text-dark)"}}>M. Exemple Pierre</span><span style={{fontSize:14*fs,fontWeight:800,color:"var(--accent)",background:"var(--accent-light)",padding:"2px 10px",borderRadius:6}}>770 voix</span></div>
      <span style={{fontSize:14*fs,color:"var(--text-muted)"}}>{ico("user",14)} Lot 12 (320 voix) + procuration Mme. Laurent (450 voix)</span>
    </div>
    {/* PAROLE */}
    <div style={{flexShrink:0}}>
      {hand==="idle"&&<button onClick={()=>setHand("waiting")} style={{width:"100%",height:48*fs,borderRadius:14,border:"2px solid var(--warn)",background:"var(--warn-bg)",color:"var(--warn)",fontSize:15*fs,fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}><LI name="hand" size={22*fs} color="var(--warn)"/>Demander la parole</button>}
      {hand==="waiting"&&<div className="flex-row" style={{gap:6,background:"var(--warn-bg)",border:"2px solid var(--warn)",borderRadius:14,padding:"8px 14px"}}><LI name="hand" size={22*fs} color="var(--warn)"/><span style={{flex:1,fontWeight:800,color:"var(--warn)",fontSize:14*fs}}>File d'attente #3</span><button onClick={()=>setHand("idle")} className="btn btn-sm" style={{minHeight:40}}>Annuler</button></div>}
      {hand==="speaking"&&<button style={{width:"100%",height:48*fs,borderRadius:14,border:"none",background:"var(--success)",color:"#fff",fontSize:15*fs,fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,animation:"pulse 1.5s infinite"}}><LI name="mic" size={22*fs} color="#fff"/>À vous !</button>}
    </div>
  </div>)};

/* ═══ PROJECTION — AFFICHAGE SALLE (clair / sombre) ═══ */
const PageEcran=({go})=>{const[mode,setMode]=useState("vote");const[dark,setDark]=useState(true);
  const T=dark?{bg:"linear-gradient(170deg,#0B0F1A,#111827)",txt:"#F1F5F9",muted:"rgba(255,255,255,.45)",card:"rgba(255,255,255,.06)",border:"rgba(255,255,255,.1)",green:"#22C55E",red:"#EF4444",blue:"#3B82F6",amber:"#F59E0B",bar:"rgba(255,255,255,.08)",abs:"rgba(255,255,255,.3)",glow:c=>`0 0 12px ${c}30`,badge:"#22C55E",badgeTxt:"#fff"}
    :{bg:"linear-gradient(170deg,#F8FAFC,#EEF2FF)",txt:"#0F172A",muted:"#64748B",card:"rgba(255,255,255,.7)",border:"rgba(0,0,0,.1)",green:"#16A34A",red:"#DC2626",blue:"#2563EB",amber:"#D97706",bar:"rgba(0,0,0,.07)",abs:"#94A3B8",glow:c=>`0 2px 6px ${c}20`,badge:"#16A34A",badgeTxt:"#fff"};
  const res=[{id:1,t:"Approbation comptes",s:"done",pct:84},{id:2,t:"Élection président CS",s:"done",pct:93},{id:3,t:"Budget prévisionnel 2026",s:"active"},{id:4,t:"Ravalement façade",s:"next"},{id:5,t:"Bornes VE",s:"next"}];
  /* clamp helper: min / preferred / max */
  const cl=(min,pref,max)=>`clamp(${min}, ${pref}, ${max})`;
  return(<div style={{width:"100vw",height:"100vh",background:T.bg,color:T.txt,fontFamily:"var(--font)",display:"flex",overflow:"hidden",transition:"background .3s,color .3s"}}>

    {/* ═══ MAIN ═══ */}
    <div style={{flex:1,display:"flex",flexDirection:"column",padding:"1.5vh 2vw",minWidth:0,gap:"1vh"}}>

      {/* TOOLBAR */}
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0}}>
        <button onClick={()=>go("operator")} style={{padding:"6px 14px",borderRadius:8,border:"1px solid "+T.border,background:T.card,color:T.txt,fontSize:cl("18px","1.2vw","22px"),fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:6}}><LI name="chevronLeft" size={14} color={T.txt}/>Retour opérateur</button>
        <div style={{display:"flex",alignItems:"center",gap:"1vw"}}>
          <div style={{display:"flex",alignItems:"center",gap:6}}><div style={{width:8,height:8,borderRadius:"50%",background:T.green,boxShadow:`0 0 8px ${T.green}`}}/><span style={{fontSize:cl("18px","1.2vw","22px"),fontWeight:700,letterSpacing:1,textTransform:"uppercase",color:T.green}}>En direct</span></div>
          <span style={{fontSize:cl("18px","1.3vw","24px"),fontFamily:"monospace",fontWeight:700,color:T.muted}}>14:32:18</span>
          <button onClick={()=>setDark(!dark)} style={{padding:"6px 14px",borderRadius:8,border:"1px solid "+T.border,background:T.card,color:T.txt,fontSize:cl("18px","1.2vw","22px"),fontWeight:600,cursor:"pointer"}}>{dark?<>{ico("sun")} Clair</>:<>{ico("moon")} Sombre</>}</button>
          <button onClick={()=>setMode(mode==="vote"?"result":"vote")} style={{padding:"6px 14px",borderRadius:8,border:"1px solid "+T.border,background:T.card,color:T.txt,fontSize:cl("18px","1.2vw","22px"),fontWeight:600,cursor:"pointer"}}>{mode==="vote"?"Voir résultat":"Voir vote"}</button>
        </div>
      </div>

      {/* TITRE + KPI (compact row) */}
      <div style={{display:"flex",alignItems:"center",gap:"2vw",flexShrink:0}}>
        <div style={{flex:1,minWidth:0}}><div style={{fontSize:cl("32px","3.6vw","56px"),fontWeight:800,fontFamily:"var(--font-display)",letterSpacing:"-0.02em",lineHeight:1.1}}>AG Ordinaire</div></div>
        <div style={{display:"flex",gap:"1vw",flexShrink:0}}>
          {[{v:"45/67",l:"Présents",c:T.blue},{v:"67%",l:"Quorum ✓",c:T.green},{v:mode==="vote"?"3/5":"2/5",l:"Résolution",c:T.amber}].map(s=>(<div key={s.l} style={{textAlign:"center",padding:cl("6px","0.8vw","12px")+" "+cl("10px","1.2vw","20px"),background:T.card,borderRadius:cl("6px","0.6vw","10px"),border:"1px solid "+T.border}}>
            <div style={{fontSize:cl("28px","3vw","48px"),fontWeight:800,color:s.c,lineHeight:1}}>{s.v}</div>
            <div style={{fontSize:cl("16px","1vw","20px"),fontWeight:700,color:T.muted,textTransform:"uppercase",letterSpacing:1}}>{s.l}</div>
          </div>))}
        </div>
      </div>

      {/* QUORUM BAR */}
      <div style={{flexShrink:0,display:"flex",alignItems:"center",gap:"1vw",padding:"0.4vh 0"}}>
        <span style={{fontSize:cl("14px","0.9vw","18px"),fontWeight:700,color:T.muted,textTransform:"uppercase",letterSpacing:1,flexShrink:0}}>Quorum</span>
        <div style={{flex:1,height:cl("6px","0.6vw","10px"),background:T.bar,borderRadius:cl("3px","0.3vw","5px"),overflow:"hidden",position:"relative"}}>
          <div style={{height:"100%",width:"67%",background:T.green,borderRadius:cl("3px","0.3vw","5px"),transition:"width .6s"}}/>
          <div style={{position:"absolute",left:"50%",top:"-2px",bottom:"-2px",width:2,background:T.muted,opacity:.5}} title="Seuil 50%+1"/>
        </div>
        <span style={{fontSize:cl("16px","1.1vw","22px"),fontWeight:800,color:T.green,flexShrink:0}}>67%</span>
        <div style={{display:"flex",alignItems:"center",gap:4,padding:cl("2px","0.3vw","6px")+" "+cl("8px","0.6vw","12px"),borderRadius:cl("4px","0.4vw","8px"),background:dark?"rgba(34,197,94,.1)":"rgba(22,163,74,.08)",border:`1px solid ${dark?"rgba(34,197,94,.2)":"rgba(22,163,74,.15)"}`}}><LI name="checkCircle" size={16} color={T.green}/><span style={{fontSize:cl("14px","0.9vw","18px"),fontWeight:700,color:T.green}}>Atteint</span></div>
      </div>

      {/* CONTENT AREA — centered */}
      <div style={{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:0,overflow:"hidden"}}>

        {mode==="vote"?<>
          {/* Vote title */}
          <div style={{textAlign:"center",marginBottom:"1.2vh"}}>
            <div style={{fontSize:cl("16px","1vw","20px"),fontWeight:700,color:T.muted,textTransform:"uppercase",letterSpacing:2,marginBottom:"0.4vh"}}>Vote en cours — Résolution 3 / 5</div>
            <div style={{fontSize:cl("28px","3vw","48px"),fontWeight:800,fontFamily:"var(--font-display)",lineHeight:1.15}}>Budget prévisionnel 2026</div>
            <div style={{fontSize:cl("16px","1.1vw","22px"),color:T.muted,marginTop:"0.3vh"}}>Majorité simple — 50% + 1 voix</div>
          </div>

          {/* Bars — contained width */}
          <div style={{maxWidth:"65vw",margin:"0 auto",width:"100%"}}>
            {[{l:"Pour",v:28,pct:72,c:T.green},{l:"Contre",v:8,pct:21,c:T.red},{l:"Abstention",v:3,pct:7,c:T.abs}].map(b=>(<div key={b.l} style={{marginBottom:cl("6px","1vh","14px")}}>
              <div style={{display:"flex",alignItems:"baseline",gap:"0.6vw",marginBottom:"0.3vh"}}>
                <span style={{fontSize:cl("18px","1.3vw","24px"),fontWeight:800,color:b.c,minWidth:"6vw"}}>{b.l}</span>
                <div style={{flex:1}}/>
                <span style={{fontSize:cl("24px","2.6vw","42px"),fontWeight:800,color:b.c}}>{b.v}</span>
                <span style={{fontSize:cl("16px","1.1vw","22px"),fontWeight:600,color:T.muted,minWidth:"3vw",textAlign:"right"}}>{b.pct}%</span>
              </div>
              <div style={{height:cl("10px","1.5vw","24px"),background:T.bar,borderRadius:cl("5px","0.6vw","10px"),overflow:"hidden"}}>
                <div style={{height:"100%",width:`${b.pct}%`,background:b.c,borderRadius:cl("5px","0.6vw","10px"),transition:"width .6s ease",boxShadow:T.glow(b.c)}}/>
              </div>
            </div>))}
            <div style={{textAlign:"center",marginTop:"0.8vh",fontSize:cl("16px","1vw","20px"),fontWeight:600,color:T.muted}}>39 / 45 votes exprimés — 4 200 / 8 500 voix</div>
          </div>
        </>

        :<>
          {/* Result */}
          <div style={{textAlign:"center"}}>
            <div style={{fontSize:cl("16px","1vw","20px"),fontWeight:700,color:T.muted,textTransform:"uppercase",letterSpacing:2,marginBottom:"0.8vh"}}>Résultat proclamé</div>
            <div style={{fontSize:cl("24px","2.6vw","42px"),fontWeight:800,fontFamily:"var(--font-display)",lineHeight:1.15,marginBottom:"1.5vh"}}>Élection du président du conseil syndical</div>
            <div style={{display:"inline-flex",alignItems:"center",gap:"0.6vw",padding:cl("6px","0.6vw","10px")+" "+cl("16px","2vw","36px"),borderRadius:cl("8px","0.8vw","14px"),background:T.badge,boxShadow:`0 0 30px ${T.badge}40`}}>
              <LI name="check" size={28} color={T.badgeTxt}/>
              <span style={{fontSize:cl("28px","3vw","48px"),fontWeight:800,color:T.badgeTxt,letterSpacing:2}}>ADOPTÉE</span>
            </div>
            <div style={{fontSize:cl("16px","1.1vw","22px"),color:T.muted,marginTop:"1vh"}}>Majorité absolue (art. 25) — 42 pour, 1 contre, 2 abstentions</div>
            <div style={{maxWidth:"50vw",margin:"1.5vh auto 0"}}>
              {[{l:"Pour",v:42,pct:93,c:T.green},{l:"Contre",v:1,pct:2,c:T.red},{l:"Abst.",v:2,pct:5,c:T.abs}].map(b=>(<div key={b.l} style={{display:"flex",alignItems:"center",gap:"0.5vw",marginBottom:"0.5vh"}}>
                <span style={{fontSize:cl("16px","1vw","20px"),fontWeight:700,color:b.c,minWidth:"4vw",textAlign:"right"}}>{b.l}</span>
                <div style={{flex:1,height:cl("8px","1vw","16px"),background:T.bar,borderRadius:cl("4px","0.5vw","8px"),overflow:"hidden"}}>
                  <div style={{height:"100%",width:`${b.pct}%`,background:b.c,borderRadius:cl("4px","0.5vw","8px")}}/>
                </div>
                <span style={{fontSize:cl("18px","1.3vw","24px"),fontWeight:800,color:b.c,minWidth:"2vw"}}>{b.v}</span>
              </div>))}
            </div>
          </div>
        </>}
      </div>

      {/* LIEN DE VOTE — bottom anchored */}
      <div style={{textAlign:"center",flexShrink:0}}>
        <span style={{fontSize:cl("18px","1.3vw","24px"),fontWeight:800,color:T.blue,fontFamily:"monospace",letterSpacing:3,background:dark?"rgba(59,130,246,.08)":"rgba(37,99,235,.08)",padding:cl("4px","0.4vw","8px")+" "+cl("12px","1.4vw","24px"),borderRadius:cl("4px","0.5vw","8px"),border:`1px solid ${dark?"rgba(59,130,246,.15)":"rgba(37,99,235,.15)"}`}}>vote.exemple.fr/s3</span>
      </div>
    </div>

    {/* ═══ SIDEBAR — ORDRE DU JOUR (fixed 240px) ═══ */}
    <div style={{width:240,flexShrink:0,borderLeft:"1px solid "+T.border,padding:"1.5vh 16px",display:"flex",flexDirection:"column",overflow:"hidden"}}>
      <div style={{fontSize:18,fontWeight:700,color:T.muted,textTransform:"uppercase",letterSpacing:1,marginBottom:"1.5vh",flexShrink:0}}>Ordre du jour</div>
      <div style={{flex:1,overflowY:"auto"}}>
        {res.map(r=>(<div key={r.id} style={{padding:"8px 10px",marginBottom:4,borderRadius:8,background:r.s==="active"?(dark?"rgba(59,130,246,.12)":"rgba(37,99,235,.08)"):"transparent",border:r.s==="active"?`1px solid ${dark?"rgba(59,130,246,.25)":"rgba(37,99,235,.2)"}`:"1px solid transparent"}}>
          <div style={{display:"flex",alignItems:"center",gap:8}}>
            <div style={{width:24,height:24,borderRadius:"50%",background:r.s==="done"?T.green:r.s==="active"?T.blue:(dark?"rgba(255,255,255,.1)":"rgba(0,0,0,.08)"),display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
              {r.s==="done"?<LI name="check" size={14} color="#fff"/>:<span style={{fontSize:16,fontWeight:800,color:r.s==="active"?"#fff":T.muted}}>{r.id}</span>}
            </div>
            <div style={{flex:1,minWidth:0}}>
              <div style={{fontSize:18,fontWeight:r.s==="active"?700:500,color:r.s==="next"?T.muted:T.txt,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{r.t}</div>
              {r.s==="done"&&r.pct&&<div style={{fontSize:16,color:T.green,fontWeight:700}}>{r.pct}% pour</div>}
              {r.s==="active"&&<div style={{fontSize:16,color:T.blue,fontWeight:700}}>En cours</div>}
            </div>
          </div>
        </div>))}
      </div>
      <div style={{borderTop:"1px solid "+T.border,paddingTop:"1vh",flexShrink:0}}>
        <div style={{fontSize:16,color:T.muted}}>Clé : Charges générales</div>
        <div style={{fontSize:16,color:T.muted}}>15 février 2026</div>
      </div>
    </div>
  </div>)};

const PageAudit=({go,addToast})=>{const[auditFilter,setAuditFilter]=useState("Tous");const[auditView,setAuditView]=useState("table");const[detailEvt,setDetailEvt]=useState(null);const[exportSel,setExportSel]=useState([]);
  const EVENTS=[{id:538,t:"15/02 14:32:18",e:"Vote enregistré — Résolution #3",u:"Votant #23",h:"7a3f...c2d1",cat:"Votes",sev:"info"},{id:537,t:"15/02 14:31:45",e:"Vote enregistré — Résolution #3",u:"Votant #18",h:"b12e...a8f3",cat:"Votes",sev:"info"},{id:536,t:"15/02 14:30:00",e:"Vote ouvert — Résolution #3",u:"Opérateur",h:"d4c1...7e92",cat:"Votes",sev:"info"},{id:535,t:"15/02 14:28:12",e:"Résultat proclamé — Résolution #2 (Adoptée)",u:"Président",h:"e8a2...1b4d",cat:"Votes",sev:"success"},{id:534,t:"15/02 14:15:33",e:"Tentative de double vote bloquée (lien expiré)",u:"Système",h:"f1d3...6c7a",cat:"Sécurité",sev:"danger"},{id:533,t:"15/02 14:00:00",e:"Séance démarrée — AG Ordinaire",u:"Opérateur",h:"a9b4...3e5f",cat:"Système",sev:"info"},{id:532,t:"15/02 13:58:22",e:"Quorum atteint — 45/67 présents (67%)",u:"Système",h:"c3d2...8a1b",cat:"Présences",sev:"success"},{id:531,t:"15/02 13:55:10",e:"Procuration enregistrée — Membre E → Membre D",u:"Opérateur",h:"1f4a...9e2c",cat:"Présences",sev:"info"},{id:530,t:"15/02 13:50:00",e:"Émargement ouvert — 67 participants attendus",u:"Système",h:"e7b3...4d5f",cat:"Système",sev:"info"}];
  const filtered=EVENTS.filter(e=>auditFilter==="Tous"||e.cat===auditFilter);
  const toggleSel=id=>setExportSel(prev=>prev.includes(id)?prev.filter(x=>x!==id):[...prev,id]);
  const sevColor={info:"var(--accent)",success:"var(--success)",danger:"var(--danger)",warn:"var(--warn)"};
  const catIco={Votes:"vote",Présences:"users",Sécurité:"shield",Système:"settings"};
  return(<div className="page-anim"><PH page="audit" icon="shield" title="Audit et Conformité" sub="Journal de traçabilité" right={<div className="flex-row" style={{gap:6}}>{exportSel.length>0&&<button className="btn btn-sm btn-p" onClick={()=>{addToast&&addToast(`${exportSel.length} événement(s) exporté(s).`,"success");setExportSel([])}}>{ico("download")} Exporter la sélection ({exportSel.length})</button>}<button className="btn btn-sm" onClick={()=>addToast&&addToast("Journal complet exporté en CSV.","success")}>{ico("download")} Tout exporter</button></div>}/>
  <div className="grid-4" style={{marginBottom:14}}>{[{v:"100%",l:"Intégrité",c:"var(--success)",i:"shield"},{v:"538",l:"Événements",c:"var(--accent)",i:"activity"},{v:"0",l:"Anomalies",c:"var(--success)",i:"checkCircle"},{v:"15/02",l:"Dernière séance",c:"var(--purple)",i:"clock"}].map(s=>(<div key={s.l} className="card kpi" style={{cursor:"default"}}><LI name={s.i} size={16} color={s.c}/><div style={{fontFamily:"var(--font-mono)",fontSize:20,fontWeight:700,color:s.c,margin:"2px 0",letterSpacing:"-0.5px",lineHeight:1}}>{s.v}</div><div style={{fontSize:14,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase"}}>{s.l}</div></div>))}</div>
  {/* Filters + View toggle */}
  <div className="flex-between" style={{marginBottom:10}}>
    <div className="flex-row" style={{gap:6}}>{["Tous","Votes","Présences","Sécurité","Système"].map(f=>(<button key={f} className={`btn btn-sm ${auditFilter===f?"btn-p":""}`} onClick={()=>setAuditFilter(f)}>{f}</button>))}</div>
    <div className="flex-row" style={{gap:4}}><button className={`btn btn-sm ${auditView==="table"?"btn-p":"btn-ghost"}`} onClick={()=>setAuditView("table")}>{ico("list",14)} Tableau</button><button className={`btn btn-sm ${auditView==="timeline"?"btn-p":"btn-ghost"}`} onClick={()=>setAuditView("timeline")}>{ico("activity",14)} Chronologie</button></div>
  </div>

  {auditView==="table"?<div className="table-wrap"><table><thead><tr><th style={{width:30}}><input type="checkbox" checked={exportSel.length===filtered.length&&filtered.length>0} onChange={()=>setExportSel(exportSel.length===filtered.length?[]:filtered.map(e=>e.id))} aria-label="Tout sélectionner"/></th><th>#</th><th>Horodatage</th><th>Événement</th><th>Utilisateur</th><th>Empreinte</th></tr></thead><tbody>{filtered.map(e=>(<tr key={e.id} style={{cursor:"pointer"}} onClick={()=>setDetailEvt(e)}><td onClick={ev=>ev.stopPropagation()}><input type="checkbox" checked={exportSel.includes(e.id)} onChange={()=>toggleSel(e.id)} aria-label={`Sélectionner #${e.id}`}/></td><td style={{fontFamily:"monospace",fontWeight:700,color:"var(--text-muted)"}}>{e.id}</td><td style={{fontWeight:600,fontFamily:"monospace",fontSize:14}}>{e.t}</td><td style={{fontWeight:600,color:"var(--text-dark)"}}><span style={{display:"inline-flex",alignItems:"center",gap:4}}><div style={{width:6,height:6,borderRadius:"50%",background:sevColor[e.sev],flexShrink:0}}/>{e.e}</span></td><td><span className="tag">{e.u}</span></td><td style={{fontFamily:"monospace",fontSize:14,color:"var(--text-muted)"}}>{e.h}</td></tr>))}</tbody></table><Pg n={5}/></div>

  :<div className="card" style={{padding:16}}>
    {filtered.map((e,i)=>(<div key={e.id} className="irow" style={{display:"flex",gap:12,padding:"10px 8px",cursor:"pointer",borderBottom:i<filtered.length-1?"1px solid var(--border-soft)":"none"}} onClick={()=>setDetailEvt(e)}>
      <div style={{display:"flex",flexDirection:"column",alignItems:"center",width:20,flexShrink:0}}>
        <div style={{width:10,height:10,borderRadius:"50%",background:sevColor[e.sev],boxShadow:`0 0 6px ${sevColor[e.sev]}40`}}/>
        {i<filtered.length-1&&<div style={{width:2,flex:1,background:"var(--border-soft)",marginTop:4}}/>}
      </div>
      <div style={{flex:1,minWidth:0}}>
        <div className="flex-between"><span className="irow-title" style={{fontWeight:700,color:"var(--text-dark)",fontSize:14,transition:"color .12s"}}>{e.e}</span><span style={{fontSize:12,fontFamily:"monospace",color:"var(--text-muted)",flexShrink:0}}>{e.t}</span></div>
        <div className="flex-row" style={{gap:6,marginTop:3}}><span className="tag" style={{fontSize:12}}>{ico(catIco[e.cat]||"info",12)} {e.cat}</span><span className="tag" style={{fontSize:12}}>{e.u}</span><span style={{fontSize:12,fontFamily:"monospace",color:"var(--text-light)"}}>{e.h}</span></div>
      </div>
      <LI name="chevR" size={12} color="var(--border)" className="irow-arrow"/>
    </div>))}
  </div>}

  {/* Detail modal */}
  {detailEvt&&<Modal title={`Événement #${detailEvt.id}`} onClose={()=>setDetailEvt(null)} footer={<><button className="btn" onClick={()=>setDetailEvt(null)}>Fermer</button><button className="btn btn-sm" onClick={()=>{addToast&&addToast(`Événement #${detailEvt.id} exporté.`,"success");setDetailEvt(null)}}>{ico("download",14)} Exporter</button></>}>
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:14}}>
      {[{l:"Horodatage",v:detailEvt.t},{l:"Catégorie",v:detailEvt.cat},{l:"Utilisateur",v:detailEvt.u},{l:"Sévérité",v:detailEvt.sev}].map(k=>(<div key={k.l} style={{padding:"8px 10px",background:"var(--tag-bg)",borderRadius:6}}><div style={{fontSize:12,fontWeight:700,color:"var(--text-muted)",textTransform:"uppercase",marginBottom:2}}>{k.l}</div><div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)"}}>{k.v}</div></div>))}
    </div>
    <div style={{padding:12,background:"var(--surface-alt)",borderRadius:"var(--radius-sm)",marginBottom:12}}><div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:4}}>Description</div><div style={{fontSize:14,color:"var(--text-muted)"}}>{detailEvt.e}</div></div>
    <div style={{padding:12,background:"var(--surface-alt)",borderRadius:"var(--radius-sm)"}}><div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:4}}>Empreinte SHA-256</div><div style={{fontFamily:"monospace",fontSize:13,color:"var(--accent)",wordBreak:"break-all"}}>{detailEvt.h.replace("...","")}e4a7b1c9d3f8209156ab03cf721de6ff84a02b{detailEvt.id}</div></div>
  </Modal>}
</div>)};
const PageArchives=({go,addToast})=>{const[showArchive,setShowArchive]=useState(null);const[archPg,setArchPg]=useState(1);const[archQ,setArchQ]=useState("");const ARCH_PER=5;const ARCH_DATA=[{t:"AG Ordinaire",d:"15/02/2026",tp:"AG Ord.",r:"4 adoptées, 1 rejetée",p:"45/67"},{t:"Conseil syndical",d:"10/02/2026",tp:"Conseil",r:"5 adoptées",p:"12/12"},{t:"AG Extra. Travaux",d:"28/01/2026",tp:"AG Extra.",r:"3 adoptées",p:"52/67"},{t:"AG Ordinaire 2025",d:"15/12/2025",tp:"AG Ord.",r:"11 adoptées, 1 rejetée",p:"54/67"},{t:"Conseil syndical précédent",d:"01/12/2025",tp:"Conseil",r:"3 adoptées",p:"11/12"},{t:"AG Extra. Ascenseur",d:"15/10/2025",tp:"AG Extra.",r:"2 adoptées",p:"48/67"},{t:"AG Ordinaire 2024",d:"18/12/2024",tp:"AG Ord.",r:"9 adoptées, 2 rejetées",p:"51/67"}];const archFiltered=archQ.length>1?ARCH_DATA.filter(a=>a.t.toLowerCase().includes(archQ.toLowerCase())||a.tp.toLowerCase().includes(archQ.toLowerCase())):ARCH_DATA;
const archTotal=Math.ceil(archFiltered.length/ARCH_PER);const archPage=archFiltered.slice((archPg-1)*ARCH_PER,archPg*ARCH_PER);return(<div className="page-anim"><PH page="archives" icon="archive" title="Archives" sub={`${ARCH_DATA.length} dossiers archivés`} sub={`${ARCH_DATA.length} séances archivées`} right={<div className="flex-row" style={{gap:6}}><input className="field-input" placeholder="Rechercher une séance..." maxLength={100} style={{width:220,marginBottom:0,minHeight:40}}/><button className="btn btn-sm" onClick={()=>addToast&&addToast("Archive ZIP complète téléchargée.","success")}>{ico("download")} Téléchargement complet</button></div>}/><div className="search-bar-row" style={{marginBottom:12}}>
    <div style={{position:"relative",flex:1,maxWidth:320}}>
      <span style={{position:"absolute",left:11,top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"var(--text-light)"}}>{ico("search",14)}</span>
      <input className="field-input" type="search" placeholder="Rechercher une archive…" maxLength={100} value={archQ} onChange={e=>{setArchQ(e.target.value);setArchPg(1)}} style={{paddingLeft:34}} aria-label="Rechercher dans les archives"/>
    </div>
    <select className="field-input" style={{minHeight:36,width:150}} aria-label="Type"><option value="">Tous types</option><option>AG Ord.</option><option>AG Extra.</option><option>Conseil</option></select>
  </div>
  {archFiltered.length===0&&<div className="card"><div className="empty-state"><div className="empty-state-icon"><LI name="archive" size={34} color="var(--text-light)"/></div><div className="empty-state-title">Aucune archive</div><div className="empty-state-sub">Aucun dossier ne correspond à « {archQ} ».</div></div></div>}
  <div className="table-wrap"><table><thead><tr><th>Séance</th><th>Date</th><th>Résolutions</th><th>Présents</th><th>Actions</th></tr></thead><tbody>{archPage.map((s,i)=>(<tr key={i}><td><div style={{fontWeight:600,color:"var(--text-dark)"}}>{s.t}</div><span className="tag tag-accent" style={{fontSize:14}}>{s.tp}</span></td><td style={{fontSize:14}}>{s.d}</td><td style={{fontSize:14}}>{s.r}</td><td style={{fontWeight:700}}>{s.p}</td><td><div className="flex-row" style={{gap:4}}><button className="btn btn-sm btn-ghost" onClick={()=>setShowArchive(s)}>{ico("eye",14)} Voir</button><button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast(`Dossier "${s.t}" téléchargé.`,"success")}>{ico("download",14)}</button></div></td></tr>))}</tbody></table>{archTotal>1&&<div className="pagination">{Array.from({length:archTotal},(_,i)=>(<button key={i} className={`pg-btn${archPg===i+1?" pg-active":""}`} onClick={()=>setArchPg(i+1)}>{i+1}</button>))}</div>}</div>
  {showArchive&&<Modal title={`Archive — ${showArchive.t}`} onClose={()=>setShowArchive(null)} footer={<><button className="btn" onClick={()=>setShowArchive(null)}>Fermer</button><button className="btn btn-p" onClick={()=>addToast&&addToast("PV téléchargé en PDF.","success")}>{ico("download")} Télécharger le PV</button></>}>
    <div className="grid-3" style={{marginBottom:14}}>{[{l:"Date",v:showArchive.d},{l:"Présents",v:showArchive.p},{l:"Résolutions",v:showArchive.r}].map(s=>(<div key={s.l} style={{textAlign:"center",padding:8,background:"var(--surface-alt)",borderRadius:8}}><div style={{fontSize:14,color:"var(--text-muted)"}}>{s.l}</div><div style={{fontWeight:700,color:"var(--text-dark)"}}>{s.v}</div></div>))}</div>
    <div className="h3" style={{marginBottom:8}}>Résolutions</div>
    {[{n:1,t:"Approbation des comptes",r:true},{n:2,t:"Élection président CS",r:true},{n:3,t:"Budget prévisionnel",r:true},{n:4,t:"Ravalement façade",r:false},{n:5,t:"Bornes VE",r:true}].map(r=>(<div key={r.n} className="flex-row" style={{gap:8,padding:"6px 0",borderBottom:"1px solid var(--border-soft)",flexWrap:"nowrap"}}><span style={{fontWeight:700,color:"var(--text-muted)",fontSize:14,width:24}}>#{r.n}</span><span style={{flex:1,fontWeight:600,color:"var(--text-dark)",fontSize:14}}>{r.t}</span><span className={`tag ${r.r?"tag-success":"tag-danger"}`} style={{fontSize:14}}>{r.r?<>{ico("check",11)} Adoptée</>:<>{ico("x",11)} Rejetée</>}</span></div>))}
    <div style={{marginTop:12}}><div className="h3" style={{marginBottom:6}}>Téléchargements</div>{["PV (PDF)","Présences (CSV)","Votes (CSV)"].map((e,i)=>(<button key={i} className="btn btn-sm btn-ghost" style={{marginRight:6,marginBottom:4}} onClick={()=>addToast&&addToast(`${e} téléchargé.`,"success")}>{ico("download",14)} {e}</button>))}</div>
  </Modal>}
</div>)};
const PageUtilisateurs=({addToast})=>{const[showAddUser,setShowAddUser]=useState(false);return(<div className="page-anim"><PH page="utilisateurs" icon="users" title="Utilisateurs" sub="Gestion des accès" right={<button className="btn btn-p btn-sm" onClick={()=>setShowAddUser(true)}>{ico("plus")} Ajouter</button>}/><div className="ctx-panel" style={{marginBottom:14}}><h4>{ico("lightbulb")} Rôles</h4><p><strong>Administrateur</strong> : accès complet. <strong>Gestionnaire</strong> : création de séances, envoi convocations. <strong>Opérateur</strong> : pilotage en direct. Les rôles de séance (président, secrétaire, scrutateur) sont attribués par séance dans l'assistant de création.</p></div><div className="table-wrap"><table><thead><tr><th>Nom</th><th>Courriel</th><th>Rôle</th><th>Statut</th><th>Dernière connexion</th><th></th></tr></thead><tbody>{[{n:"Utilisateur A",e:"admin@exemple.fr",r:"Administrateur",a:true,d:"15/02/2026 14:30"},{n:"P. Bernard",e:"p.bernard@exemple.fr",r:"Gestionnaire",a:true,d:"15/02/2026 13:45"},{n:"S. Moreau",e:"s.moreau@exemple.fr",r:"Opérateur",a:true,d:"15/02/2026 14:00"},{n:"J. Leroy",e:"j.leroy@exemple.fr",r:"Opérateur",a:true,d:"10/02/2026 09:12"},{n:"Compte désactivé",e:"ancien@exemple.fr",r:"Opérateur",a:false,d:"15/12/2025 16:00"}].map((u,i)=>(<tr key={i}><td style={{fontWeight:600,color:"var(--text-dark)"}}><div style={{display:"flex",alignItems:"center",gap:8}}><Av name={u.n} size="sm"/>{u.n}</div></td><td style={{color:"var(--text-muted)"}}>{u.e}</td><td><span className={`tag ${u.r==="Administrateur"?"tag-danger":u.r==="Gestionnaire"?"tag-warn":"tag-accent"}`} style={{fontSize:14}}>{u.r}</span></td><td><span className={`tag ${u.a?"tag-success":"tag-danger"}`} style={{fontSize:14}}>{u.a?"Actif":"Désactivé"}</span></td><td style={{fontSize:14,color:"var(--text-muted)"}}>{u.d}</td><td><button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast(`Profil modifié : ${u.n} (wireframe).`,"info")}>{ico("edit",14)}</button></td></tr>))}</tbody></table><Pg n={2}/></div>
  {showAddUser&&<Modal title="Ajouter un utilisateur" onClose={()=>setShowAddUser(false)} footer={<><button className="btn" onClick={()=>setShowAddUser(false)}>Annuler</button><button className="btn btn-p" onClick={()=>{setShowAddUser(false);addToast&&addToast("Utilisateur ajouté avec succès.","success","Utilisateur créé")}}>{ico("check")} Créer le compte</button></>}>
    <div className="row"><div className="field"><label className="field-label">Nom complet <span className="req">*</span></label><input className="field-input" aria-required="true" placeholder="Ex : Nom Prénom" maxLength={80} autoComplete="off"/></div><div className="field"><label className="field-label">Courriel <span className="req">*</span></label><input className="field-input" aria-required="true" placeholder="nom@exemple.fr" type="email" maxLength={120} autoComplete="off"/></div></div>
    <div className="row"><div className="field"><label className="field-label">Rôle <span className="req">*</span></label><select className="field-input" aria-required="true"><option>Opérateur</option><option>Gestionnaire</option><option>Administrateur</option></select></div><div className="field"><label className="field-label">Statut</label><div className="flex-row" style={{gap:4,marginTop:4}}><span className="chip active">Actif</span><span className="chip">Désactivé</span></div></div></div>
    <div className="alert alert-warn" style={{margin:0}}>{ico("lightbulb")} Un courriel d'activation sera envoyé à l'adresse indiquée avec un lien de création de mot de passe.</div>
  </Modal>}
</div>)};
const PageParametres=({addToast})=>{const[dblVote,setDblVote]=useState(true);const[dblAuth,setDblAuth]=useState(true);const[showMailEdit,setShowMailEdit]=useState(null);const[showQuorum,setShowQuorum]=useState(false);const[qBase,setQBase]=useState("présents");const[qPct,setQPct]=useState("50");const[pTab,setPTab]=useState("regles");
  const PTABS=[{id:"regles",l:"Règles de vote",i:"scale"},{id:"cles",l:"Clés de répartition",i:"layers"},{id:"securite",l:"Sécurité",i:"shield"},{id:"courrier",l:"Courrier",i:"send"},{id:"general",l:"Général",i:"globe"},{id:"accessibilite",l:"Accessibilité",i:"eye"}];
  return(<div className="page-anim"><PH page="parametres" icon="settings" title="Paramètres" sub="Configuration du système"/>
  <div style={{display:"flex",gap:14,minHeight:0}}>
    {/* NAV VERTICALE */}
    <div style={{width:200,flexShrink:0}}>
      {PTABS.map(t=>(<button key={t.id} onClick={()=>setPTab(t.id)} style={{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"10px 12px",marginBottom:4,borderRadius:8,border:"none",background:pTab===t.id?"var(--accent-light)":"transparent",color:pTab===t.id?"var(--accent)":"var(--text-muted)",fontWeight:pTab===t.id?800:600,fontSize:14,cursor:"pointer",textAlign:"left"}}><LI name={t.i} size={16} color={pTab===t.id?"var(--accent)":"var(--text-light)"}/>{t.l}</button>))}
    </div>
    {/* CONTENU */}
    <div style={{flex:1,minWidth:0}}>

    {pTab==="regles"&&<div className="card" style={{padding:16}}>
      <div className="card-title">{ico("scale")} Règles de majorité et quorum</div>
      <div style={{marginBottom:16}}><div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:8}}>Majorités disponibles</div>
      {[{p:"Majorité simple (art. 24)",d:"Majorité des présents et représentés"},{p:"Majorité absolue (art. 25)",d:"Majorité de tous les copropriétaires"},{p:"Double majorité (art. 26)",d:"2/3 des voix de tous les copropriétaires"},{p:"Unanimité (art. 26-1)",d:"Accord de tous les copropriétaires"},{p:"Passerelle art. 25-1",d:"Renvoi en art. 24 si 1/3 des voix atteint"}].map((p,i)=>(<div key={p.p} style={{padding:"8px 0",borderBottom:i<4?"1px solid var(--border-soft)":"none"}}><div style={{fontWeight:600,color:"var(--text-dark)",fontSize:14}}>{p.p}</div><div className="muted" style={{fontSize:14}}>{p.d}</div></div>))}</div>
      <div style={{borderTop:"2px solid var(--border-soft)",paddingTop:14}}><div className="flex-between" style={{marginBottom:8}}><span style={{fontSize:14,fontWeight:700,color:"var(--text-dark)"}}>Politiques de quorum</span><button className="btn btn-p btn-sm" onClick={()=>setShowQuorum(true)}>{ico("plusCircle")} Nouveau</button></div>
      {[{p:"50% des présents + 1 (défaut)",d:"Calcul sur le nombre de présents et représentés",def:true},{p:"50% des voix",d:"Calcul sur le poids total des voix représentées"},{p:"33% des présents",d:"Quorum réduit pour 2e convocation"},{p:"Aucun quorum",d:"Pour les conseils syndicaux et bureaux"}].map((p,i)=>(<div key={p.p} style={{padding:"8px 0",borderBottom:i<3?"1px solid var(--border-soft)":"none"}}><div className="flex-between"><div><div style={{fontWeight:600,color:"var(--text-dark)",fontSize:14}}>{p.p}</div><div className="muted" style={{fontSize:14}}>{p.d}</div></div><div className="flex-row" style={{gap:4}}>{p.def&&<span className="tag tag-success" style={{fontSize:14}}>Défaut</span>}<button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast("Paramètre modifié.","success")}>{ico("edit",14)}</button></div></div></div>))}</div>
    </div>}

    {pTab==="cles"&&<div className="card" style={{padding:16}}>
      <div className="flex-between" style={{marginBottom:14}}><div className="card-title" style={{margin:0}}>{ico("layers")} Clés de répartition <HelpTip text="Les clés définissent la pondération de vote pour chaque type de décision."/></div><button className="btn btn-p btn-sm" onClick={()=>addToast&&addToast("Nouvelle clé de répartition créée.","success")}>{ico("plusCircle")} Nouvelle clé</button></div>
      <div className="alert alert-accent" style={{margin:"0 0 12px",background:"var(--accent-light)",borderColor:"var(--accent)"}}>{ico("info")} Chaque résolution utilise une clé. Vérifiez que les totaux correspondent au règlement.</div>
      {[{k:"Charges générales",b:"Millièmes (10 000e)",total:"10 000 / 10 000",ok:true,def:true,lots:67,desc:"Quote-part parties communes — vote par défaut"},{k:"Ascenseur Bâtiment A",b:"Millièmes",total:"7 200 / 10 000",ok:true,lots:42,desc:"Répartie selon l'utilité (étage)"},{k:"Chauffage collectif",b:"Millièmes",total:"9 850 / 10 000",ok:false,lots:61,desc:"Basée sur la superficie chauffée"},{k:"Parking souterrain",b:"Quote-part (1/N)",total:"35 / 35",ok:true,lots:35,desc:"Répartition égale entre détenteurs"}].map((c,i)=>(<div key={i} style={{padding:"10px 0",borderBottom:i<3?"1px solid var(--border-soft)":"none"}}><div className="flex-between"><div style={{flex:1}}><div className="flex-row" style={{gap:6}}><span style={{fontWeight:700,color:"var(--text-dark)",fontSize:14}}>{c.k}</span>{c.def&&<span className="tag tag-success" style={{fontSize:14}}>Défaut</span>}{!c.ok&&<span className="tag tag-danger" style={{fontSize:14}}>{ico("alertTriangle",14)} Incomplet</span>}</div><div className="muted" style={{fontSize:14}}>{c.desc}</div><div className="flex-row" style={{gap:12,marginTop:4}}><span style={{fontSize:14,color:"var(--text-muted)"}}>{ico("listOrdered",14)} {c.lots} lots</span><span style={{fontSize:14,color:"var(--text-muted)"}}>{ico("calculator",14)} {c.b}</span><span style={{fontSize:14,fontWeight:700,color:c.ok?"var(--success)":"var(--danger)"}}>{ico(c.ok?"check":"alertTriangle",14)} {c.total}</span></div></div><button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast(`Édition de la clé "${c.k}".`,"info")}>{ico("edit",14)}</button></div></div>))}
    </div>}

    {pTab==="securite"&&<div className="card" style={{padding:16}}>
      <div className="card-title">{ico("shield")} Sécurité et conformité</div>
      <div className="field"><label className="field-label">Niveau de sécurité CNIL <HelpTip text="Délibération n°2019-053 — 3 niveaux selon les risques."/></label><select className="field-input"><option>Niveau 1 — Faible risque</option><option selected>Niveau 2 — Risque modéré (AG copropriété)</option><option>Niveau 3 — Risque élevé</option></select></div>
      <div className="row"><div className="field"><label className="field-label">Plafond procurations</label><div className="flex-row" style={{gap:8}}><input className="field-input" type="number" defaultValue="3" min="1" max="20" style={{width:80}}/><span className="muted" style={{fontSize:14}}>par mandataire</span></div></div>
      <div className="field"><label className="field-label">Délai contestation</label><div className="flex-row" style={{gap:8}}><input className="field-input" type="number" defaultValue="60" min="1" max="365" style={{width:80}}/><span className="muted" style={{fontSize:14}}>jours</span></div></div></div>
      <div className="field"><label className="field-label">2e convocation automatique</label><div className="flex-row" style={{gap:4}}><span className="chip active">Activée</span><span className="chip">Désactivée</span></div><div className="muted" style={{fontSize:14,marginTop:4}}>Quorum réduit : 33%</div></div>
      <div style={{borderTop:"1px solid var(--border-soft)",paddingTop:12,marginTop:8}}>
        <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:8}}>Protections de vote</div>
        <div className="row"><div className="field"><label className="field-label">Séparation identité / bulletin</label><div className="flex-row" style={{gap:4}}><span className="chip active">Activée (CNIL)</span><span className="chip">Désactivée</span></div></div>
        <div className="field"><label className="field-label">Durée des liens de vote</label><select className="field-input"><option>5 minutes</option><option>10 minutes</option><option>15 minutes</option></select></div></div>
        <div className="row"><div className="field"><label className="field-label">Double vote</label><div className="flex-row" style={{gap:4}}><span className={`chip ${dblVote?"active":""}`} onClick={()=>setDblVote(true)}>Activé</span><span className={`chip ${!dblVote?"active":""}`} onClick={()=>setDblVote(false)}>Désactivé</span></div></div>
        <div className="field"><label className="field-label">Double authentification</label><div className="flex-row" style={{gap:4}}><span className={`chip ${dblAuth?"active":""}`} onClick={()=>setDblAuth(true)}>Activé</span><span className={`chip ${!dblAuth?"active":""}`} onClick={()=>setDblAuth(false)}>Désactivé</span></div></div></div>
      </div>
    </div>}

    {pTab==="courrier"&&<div className="card" style={{padding:16}}>
      <div className="card-title">{ico("send")} Modèles de courrier</div>
      {["Convocation AG (21j avant)","Rappel 48h avant AG","Notification des résultats","Envoi PV signé","Mise en demeure (impayé)"].map((t,i)=>(<div key={t} className="flex-between" style={{padding:"8px 0",borderBottom:i<4?"1px solid var(--border-soft)":"none"}}><span style={{fontWeight:600,color:"var(--text-dark)",fontSize:14}}>{t}</span><button className="btn btn-sm btn-ghost" onClick={()=>setShowMailEdit(t)}>{ico("edit",14)} Modifier</button></div>))}
    </div>}

    {pTab==="general"&&<div className="card" style={{padding:16}}>
      <div className="card-title">{ico("globe")} Général</div>
      <div className="row"><div className="field"><label className="field-label" id="tz-label">Fuseau horaire</label><TZPicker/></div><div className="field"><label className="field-label">Courriel de support</label><input className="field-input" defaultValue="support@exemple.fr" maxLength={200} autoComplete="off"/></div></div>
      <div className="field"><label className="field-label">Serveur de courriels</label><div className="row"><div className="field" style={{margin:0}}><label className="field-label" style={{fontSize:14}}>Serveur</label><input className="field-input" placeholder="smtp.votre-domaine.fr" style={{minHeight:40}} maxLength={200} autoComplete="off"/></div><div className="field" style={{margin:0}}><label className="field-label" style={{fontSize:14}}>Port</label><input className="field-input" defaultValue="587" style={{minHeight:40,width:80}} maxLength={200} autoComplete="off"/></div></div></div>
      <div className="field"><label className="field-label">Logo de l'organisation</label><div style={{background:"var(--surface-alt)",border:"1.5px dashed var(--border-dash)",borderRadius:6,padding:12,textAlign:"center",cursor:"pointer"}} onClick={()=>addToast&&addToast("Logo mis à jour.","success")}><div className="muted" style={{fontSize:14}}>{ico("upload")} Glissez votre logo</div></div></div>
      <div style={{borderTop:"2px solid var(--border-soft)",paddingTop:12,marginTop:8}}>
        <div style={{fontSize:14,fontWeight:700,color:"var(--danger)",marginBottom:8}}>Données personnelles (RGPD)</div>
        <div className="flex-row" style={{gap:6}}><button className="btn btn-sm" onClick={()=>addToast&&addToast("Données RGPD téléchargées.","success")}>{ico("download")} Exporter mes données</button><button className="btn btn-danger btn-sm" onClick={()=>{if(confirm("Supprimer le compte ?"))addToast&&addToast("Compte supprimé.","warn")}}>{ico("x")} Supprimer le compte</button></div>
      </div>
    </div>}


    {pTab==="accessibilite"&&<div className="card" style={{padding:16}}>
      <div className="card-title">{ico("eye")} Déclaration d'accessibilité</div>
      <div className="alert" style={{background:"var(--accent-light)",borderColor:"var(--accent)",marginBottom:14}}>{ico("info")} Obligatoire — article 47 loi n°2005-102, décret n°2019-768. À mettre à jour après chaque audit (art. 47 al. 3).</div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16}}>
        {[{l:"Norme",v:"RGAA 4.1 / WCAG 2.2 AA"},{l:"Taux de conformité",v:"97 %"},{l:"Date d'audit",v:"26/02/2026"},{l:"Prestataire",v:"Audit interne"},{l:"Prochain audit",v:"26/02/2027"},{l:"Statut",v:"Conforme"}].map(k=>(<div key={k.l} style={{padding:"10px 12px",background:"var(--tag-bg)",borderRadius:8}}><div style={{fontSize:12,fontWeight:700,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:.8,marginBottom:4}}>{k.l}</div><div style={{fontSize:15,fontWeight:700,color:k.l==="Taux de conformité"?"var(--success)":k.l==="Statut"?"var(--success)":"var(--text-dark)"}}>{k.v}</div></div>))}
      </div>
      <div style={{marginBottom:14}}>
        <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:8}}>Corrections apportées (v3.19.2)</div>
        {[{c:"RGAA 3.1",d:"Icônes ajoutées à tous les tags de statut — couleur n'est plus le seul vecteur d'information",sev:"Corrigé"},{c:"WCAG 2.4.13",d:"Focus-visible renforcé en mode sombre — double anneau (surface + accent) pour contraste ≥ 3:1",sev:"Corrigé"},{c:"WCAG 2.3.3",d:"prefers-reduced-motion étendu — scroll-behavior, page-anim, toasts, modales, popovers désactivés",sev:"Corrigé"},{c:"WCAG 1.3.5",d:"aria-required ajouté aux 13 champs obligatoires — cohérence avec marqueur visuel *",sev:"Corrigé"}].map((nc,i)=>(<div key={i} style={{padding:"8px 0",borderBottom:i<3?"1px solid var(--border-soft)":"none",display:"flex",gap:10,alignItems:"flex-start"}}><span className="tag tag-success" style={{fontSize:13,flexShrink:0,marginTop:2}}>{ico("check",12)} {nc.c}</span><div style={{fontSize:14,color:"var(--text-muted)"}}>{nc.d}</div></div>))}
      </div>
      <div style={{marginBottom:14}}>
        <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:8}}>Mesures d'accessibilité en place</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
          {[
            {i:"navigation",t:"Skip-link vers contenu principal"},
            {i:"eye",t:"Focus-visible double anneau (clair + sombre)"},
            {i:"monitor",t:"prefers-reduced-motion : animations désactivées"},
            {i:"moon",t:"prefers-color-scheme : dark auto détecté"},
            {i:"type",t:"Tailles ≥ 13px, font-display lisible"},
            {i:"shield",t:"34 aria-label, 13 aria-required, 6 aria-current"},
            {i:"layers",t:"Rôles ARIA : dialog, menu, listbox, switch, alert"},
            {i:"smartphone",t:"4 breakpoints : 1024, 768, 480px + print"},
            {i:"check",t:"Piège clavier : focus-trap dans modales"},
            {i:"activity",t:"aria-live sur toasts et compteurs temps réel"}
          ].map(m=>(<div key={m.t} style={{display:"flex",gap:8,alignItems:"flex-start",fontSize:13,color:"var(--text-muted)"}}><LI name={m.i} size={14} color="var(--success)" style={{flexShrink:0,marginTop:1}}/><span>{m.t}</span></div>))}
        </div>
      </div>
      <div style={{marginBottom:14}}>
        <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:8}}>Non-conformités résiduelles</div>
        {[{c:"WCAG 2.1.1",d:"Sélecteur de fuseau horaire personnalisé : navigation clavier ↑↓ à implémenter en production",sev:"Mineure"},{c:"RGAA 8.9",d:"Certains textes juridiques (articles de loi) non balisés en lang='fr' explicite dans les tooltips",sev:"Mineure"}].map((nc,i)=>(<div key={i} style={{padding:"8px 0",borderBottom:i<1?"1px solid var(--border-soft)":"none",display:"flex",gap:10,alignItems:"flex-start"}}><span className="tag tag-warn" style={{fontSize:13,flexShrink:0,marginTop:2}}>{ico("alertTriangle",12)} {nc.c}</span><div style={{fontSize:14,color:"var(--text-muted)"}}>{nc.d} <span className="tag" style={{fontSize:12,padding:"1px 6px"}}>{nc.sev}</span></div></div>))}
      </div>
      <div style={{borderTop:"2px solid var(--border-soft)",paddingTop:14}}>
        <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:8}}>Contact et voies de recours</div>
        <div style={{fontSize:14,color:"var(--text-muted)",marginBottom:10}}>En cas de défaut d'accessibilité empêchant l'accès à un service, contactez le référent ou saisissez le Défenseur des droits (art. L.146-9 CASF).</div>
        <div className="flex-row" style={{gap:8}}>
          <button className="btn btn-sm" onClick={()=>addToast&&addToast("Formulaire d'accessibilité (wireframe).","info")}>{ico("mail",14)} Référent accessibilité</button>
          <button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast("Redirige vers : défenseur des droits.","info")}>{ico("externalLink",14)} Défenseur des droits</button>
        </div>
      </div>
    </div>}

    </div></div>
  {showMailEdit&&<Modal title={`Modifier — ${showMailEdit}`} onClose={()=>setShowMailEdit(null)} footer={<><button className="btn" onClick={()=>setShowMailEdit(null)}>Annuler</button><button className="btn btn-p" onClick={()=>{setShowMailEdit(null);addToast&&addToast("Paramètres sauvegardés.","success")}}>{ico("check")} Sauvegarder</button></>}>
    <div className="field"><label className="field-label">Objet</label><input className="field-input" defaultValue={showMailEdit} maxLength={200} autoComplete="off"/></div>
    <div className="field"><label className="field-label">Corps</label><CTA placeholder="Madame, Monsieur,\n\nCordialement,\nLa direction" max={5000} rows={6}/></div>
    <div className="field"><label className="field-label">Variables</label><div className="flex-row" style={{gap:4,flexWrap:"wrap"}}>{["{nom}","{date}","{lieu}","{nb_resolutions}","{quorum}"].map(v=>(<span key={v} className="tag tag-accent" style={{fontSize:14,cursor:"pointer"}} onClick={()=>addToast&&addToast(`${v} copié dans le presse-papier.`,"info")}>{v}</span>))}</div></div>
  </Modal>}
  {showQuorum&&<Modal title="Créer une politique de quorum" onClose={()=>setShowQuorum(false)} footer={<><button className="btn" onClick={()=>setShowQuorum(false)}>Annuler</button><button className="btn btn-p" onClick={()=>{setShowQuorum(false);addToast&&addToast(`Quorum : ${qPct}% des ${qBase} + 1.`,"success","Quorum défini")}}>{ico("check")} Créer</button></>}>
    <div className="field"><label className="field-label">Nom <span className="req">*</span></label><input className="field-input" aria-required="true" placeholder="Ex : Majorité renforcée 2/3" maxLength={80} autoComplete="off"/></div>
    <div className="row"><div className="field"><label className="field-label">Seuil (%) <span className="req">*</span></label><input className="field-input" aria-required="true" type="number" min={0} max={100} value={qPct} onChange={e=>setQPct(e.target.value)} min="0" max="100"/></div><div className="field"><label className="field-label">Base <span className="req">*</span></label><select className="field-input" value={qBase} onChange={e=>setQBase(e.target.value)}><option value="présents">Présents et représentés</option><option value="voix">Voix</option><option value="tous">Tous les membres</option></select></div></div>
    <div className="field"><label className="field-label">Arrondi</label><div className="flex-row" style={{gap:4}}><span className="chip active">+ 1 (défaut)</span><span className="chip">Arrondi sup.</span><span className="chip">Exact</span></div></div>
    <div className="card" style={{padding:14,background:"var(--accent-light)",border:"1px solid rgba(27,110,243,.15)"}}><div style={{fontSize:14,fontWeight:700,color:"var(--accent)"}}>{ico("eye")} Aperçu</div><div style={{fontSize:20,fontWeight:800,color:"var(--accent)",marginTop:4}}>{qBase==="voix"?Math.ceil(8500*qPct/100)+1:Math.ceil(67*qPct/100)+1} {qBase==="voix"?"voix":"présents"} requis ({qPct}% + 1)</div></div>
  </Modal>}
</div>)};

/* ═══ HUB DE SÉANCE — Fiche séance guidée (design 65+) ═══ */
const HUB_STEPS=[
  {
    id:"preparation",num:1,
    titre:"Préparer la séance",
    titreAction:"Compléter les informations",
    desc:"Vérifiez le titre, la date, le lieu et la liste des participants. Ajoutez les résolutions à voter.",
    descAction:"Ajoutez les derniers détails manquants : lieu, heure, résolutions restantes.",
    icon:"edit",c:"var(--accent)",dest:"wizard",
    btnLabel:"Ouvrir la préparation",
    checks:[["Titre et date définis",true],["67 participants importés",true],["8 résolutions préparées",true],["Pièces jointes ajoutées",false]],
  },{
    id:"convocations",num:2,
    titre:"Envoyer les convocations",
    titreAction:"Envoyer les 12 convocations restantes",
    desc:"Envoyez la convocation par courriel à tous les participants. La date limite légale est respectée automatiquement.",
    descAction:"55 participants ont déjà reçu la convocation. Il reste 12 envois à déclencher avant le 22/02/2026.",
    icon:"send",c:"var(--warn)",dest:null,
    btnLabel:"Envoyer les convocations",
    btnPreview:true,
    checks:[["55 convocations envoyées",true],["12 envois en attente",false],["Date limite : 22/02/2026",true]],
  },{
    id:"presences",num:3,
    titre:"Pointer les présences",
    titreAction:"Accueillir les participants",
    desc:"Le jour de la séance, enregistrez chaque arrivée. Les procurations sont saisies ici aussi.",
    descAction:"La séance commence. Enregistrez les arrivées et les procurations au fur et à mesure.",
    icon:"users",c:"var(--accent)",dest:"operator",
    btnLabel:"Ouvrir le pointage",
    checks:[["Feuille de présence prête",true],["Procurations vérifiées",true]],
  },{
    id:"vote",num:4,
    titre:"Piloter les votes",
    titreAction:"La séance est en cours",
    desc:"Depuis l'espace opérateur, vous ouvrez les votes, suivez les résultats et les proclamez.",
    descAction:"Les votes sont ouverts. Pilotez chaque résolution depuis l'espace opérateur en direct.",
    icon:"play",c:"var(--danger)",dest:"operator",
    btnLabel:"Rejoindre la séance en direct",
  },{
    id:"cloture",num:5,
    titre:"Clôturer et envoyer le PV",
    titreAction:"Finaliser et archiver",
    desc:"Vérifiez les résultats, signez le procès-verbal et envoyez-le à tous les participants.",
    descAction:"La séance est terminée. Validez le PV, apposez la signature électronique et envoyez.",
    icon:"fileText",c:"var(--purple)",dest:"postsession",
    btnLabel:"Générer et envoyer le PV",
  },{
    id:"archive",num:6,
    titre:"Séance archivée",
    titreAction:"Séance archivée",
    desc:"Le PV a été envoyé et la séance est archivée. Vous pouvez la consulter à tout moment.",
    descAction:"Tout est terminé. Le PV est envoyé et archivé.",
    icon:"archive",c:"var(--success)",dest:"archives",
    btnLabel:"Consulter l'archive",
  }
];

const PageHub=({go,onTour,addToast})=>{
  const[ei,setEi]=useState(1);/* étape courante (0-based) */
  const[detailsOpen,setDetailsOpen]=useState(false);
  const step=HUB_STEPS[ei];
  const checks=step.checks||[];
  const done=checks.filter(c=>c[1]).length;

  return(<div className="page-anim">
    {/* ─── Entête séance — identité claire, tout de suite ─── */}
    <div className="hub-identity" role="banner">
      <div style={{width:52,height:52,borderRadius:14,background:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
        <LI name="clipboard" size={24} color="#fff"/>
      </div>
      <div style={{flex:1,minWidth:0}}>
        <div className="hub-identity-date">AG Ordinaire</div>
        <div className="hub-identity-meta">
          {ico("calendar",16)} Mercredi 18 février 2026 à 18 h 30 &nbsp;·&nbsp;
          {ico("mapPin",16)} Salle des fêtes, 12 rue des Mimosas &nbsp;·&nbsp;
          {ico("users",16)} 67 participants
        </div>
      </div>
      <div className="flex-row" style={{gap:8,flexShrink:0}}>
        <button className="btn btn-sm btn-ghost" onClick={()=>go("wizard")}>{ico("edit",14)} Modifier</button>
        <button className="btn btn-sm btn-ghost" onClick={()=>go("seances")}>{ico("chevL",14)} Séances</button>
      </div>
    </div>

    <div style={{display:"flex",gap:24,alignItems:"flex-start",flexWrap:"wrap"}}>

      {/* ─── Colonne gauche : stepper pas-à-pas ─── */}
      <div style={{width:220,flexShrink:0}} data-tour="hub-etat" role="navigation" aria-label="Étapes de la séance">
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,paddingLeft:8}}><div style={{fontSize:13,fontWeight:800,letterSpacing:1.2,textTransform:"uppercase",color:"var(--text-muted)"}}>Progression</div><button className="btn btn-sm btn-ghost" style={{padding:"2px 6px",fontSize:12}} onClick={()=>onTour&&onTour()}>{ico("compass",12)} Guide</button></div>
        <div className="hub-stepper">
          {HUB_STEPS.map((s,i)=>{
            const isDone=i<ei;const isActive=i===ei;
            return(<Fragment key={s.id}>
              <button className="hub-step-row" onClick={()=>setEi(i)}
                aria-current={isActive?"step":undefined}
                aria-label={`${isDone?"Étape terminée : ":"Aller à "}${s.titre}`}>
                <div className={`hub-step-num${isDone?" done":isActive?" active":""}`}>
                  {isDone?ico("check",16):s.num}
                </div>
                <div className="hub-step-text">
                  <div className={`hub-step-title${isDone?" done":isActive?" active":""}`}>{s.titre}</div>
                  {isActive&&<div style={{fontSize:13,color:"var(--accent)",fontWeight:600,marginTop:2}}>← Vous êtes ici</div>}
                </div>
              </button>
              {i<HUB_STEPS.length-1&&<div className={`hub-step-line${isDone?" done":""}`}/>}
            </Fragment>);
          })}
        </div>
        {/* Bouton simulation wireframe */}
        <div style={{marginTop:8,borderTop:"1px solid var(--border-soft)",paddingTop:8}}>
          <div style={{fontSize:13,color:"var(--text-muted)",marginBottom:6,fontWeight:600}}>Simulation wireframe</div>
          <div className="flex-row" style={{gap:4}}>
            <button className="btn btn-sm btn-ghost" style={{padding:"4px 8px",fontSize:12}} onClick={()=>setEi(Math.max(0,ei-1))} disabled={ei===0}>{ico("chevL",12)}</button>
            <button className="btn btn-sm btn-ghost" style={{padding:"4px 8px",fontSize:12}} onClick={()=>setEi(Math.min(HUB_STEPS.length-1,ei+1))} disabled={ei===HUB_STEPS.length-1}>{ico("chevR",12)}</button>
          </div>
        </div>
      </div>

      {/* ─── Colonne droite : action du moment + détails ─── */}
      <div style={{flex:1,minWidth:0}}>

        {/* Carte action principale — UNE SEULE CHOSE À FAIRE */}
        <div className="hub-action" data-tour="hub-action" role="main" aria-label={`Action : ${step.titreAction}`}>
          <div className="flex-row" style={{gap:18,flexWrap:"wrap",alignItems:"flex-start"}}>
            <div className="hub-action-icon" style={{background:step.c}}>
              <LI name={step.icon} size={28} color="#fff"/>
            </div>
            <div style={{flex:1,minWidth:200}}>
              <div className="hub-action-title">{step.titreAction}</div>
              <div className="hub-action-desc">{step.descAction}</div>
            </div>
          </div>

          {/* Checklist avancement si disponible */}
          {checks.length>0&&<div data-tour="hub-prepa" style={{background:"var(--bg)",borderRadius:10,padding:"12px 16px"}}>
            <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",marginBottom:8}}>
              Avancement : {done} / {checks.length} points complétés
            </div>
            <div className="progress-bar" style={{marginBottom:10,height:8}}>
              <div className="progress-fill" style={{width:`${done/checks.length*100}%`,background:done===checks.length?"var(--success)":"var(--accent)"}}/>
            </div>
            {checks.map(([l,ok],i)=>(
              <div key={i} className="flex-row" style={{gap:10,padding:"5px 0",borderBottom:i<checks.length-1?"1px solid var(--border-soft)":"none",flexWrap:"nowrap"}}>
                {ok
                  ?<LI name="checkCircle" size={18} color="var(--success)"/>
                  :<LI name="circle" size={18} color="var(--border)"/>}
                <span style={{fontSize:15,fontWeight:ok?500:700,color:ok?"var(--text-muted)":"var(--text-dark)"}}>{l}</span>
                {!ok&&<span style={{marginLeft:"auto",fontSize:13,color:"var(--danger)",fontWeight:700}}>À faire</span>}
              </div>
            ))}
          </div>}

          {/* Bouton d'action principal — grand, visible */}
          <div className="flex-row" style={{gap:12,flexWrap:"wrap"}}>
            {step.dest
              ?<button className="btn btn-p hub-action-btn" onClick={()=>go(step.dest)}>
                  {ico(step.icon,20)} {step.btnLabel}
                </button>
              :<button className="btn btn-p hub-action-btn" onClick={()=>addToast&&addToast(`Action : ${step.btnLabel}`,"info","Wireframe")}>
                  {ico(step.icon,20)} {step.btnLabel}
                </button>
            }
            {step.btnPreview&&<button className="btn hub-action-btn" style={{fontSize:15,minHeight:48}} onClick={()=>addToast&&addToast("Aperçu de la convocation (wireframe).","info")}>
              {ico("eye",16)} Aperçu courriel
            </button>}
          </div>

          {/* Navigation étape suivante */}
          
        </div>

        {/* Accordéon "Voir les détails" — pour utilisateurs avancés */}
        <button
          className="hub-details-toggle"
          aria-expanded={detailsOpen}
          aria-controls="hub-details-body"
          onClick={()=>setDetailsOpen(!detailsOpen)}>
          <span>{ico("info",16)} Voir les informations détaillées de la séance</span>
          {ico(detailsOpen?"chevUp":"chevDown",16)}
        </button>
        {detailsOpen&&<div id="hub-details-body" className="hub-details-body" data-tour="hub-kpi">
          {/* KPIs */}
          <div className="grid-4" style={{marginBottom:14}}>
            {[{v:"67",l:"Participants",c:"var(--accent)",i:"users",s:"8 500 voix"},{v:"8",l:"Résolutions",c:"var(--accent)",i:"vote",s:"3 art.24, 3 art.25, 2 art.26"},{v:"34",l:"Quorum requis",c:"var(--success)",i:"scale",s:"4 251 voix min."},{v:"55/67",l:"Convocations",c:"var(--warn)",i:"send",s:"12 en attente"}].map(k=>(
              <div key={k.l} className="card" style={{padding:14,textAlign:"center"}}>
                <LI name={k.i} size={16} color={k.c}/>
                <div style={{fontFamily:"var(--font-mono)",fontSize:20,fontWeight:700,color:k.c,margin:"2px 0",letterSpacing:"-0.5px",lineHeight:1}}>{k.v}</div>
                <div style={{fontSize:14,fontWeight:700,color:"var(--text-dark)"}}>{k.l}</div>
                <div style={{fontSize:13,color:"var(--text-muted)"}}>{k.s}</div>
              </div>
            ))}
          </div>

          {/* Documents */}
          <div className="card" style={{padding:14,marginBottom:10}}>
            <div className="flex-between" style={{marginBottom:8}}>
              <span style={{fontSize:14,fontWeight:700,color:"var(--text-dark)"}}>{ico("fileText")} Documents</span>
              <button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast("Sélecteur de fichier (wireframe).","info")}>{ico("upload",14)} Ajouter</button>
            </div>
            {[{n:"Convocation_AG_2026.pdf",s:"245 Ko"},{n:"Comptes_2025.pdf",s:"1.2 Mo"},{n:"Devis_ravalement.pdf",s:"890 Ko"}].map((f,i)=>(
              <div key={f.n} className="flex-row" style={{gap:8,padding:"5px 0",borderBottom:i<2?"1px solid var(--border-soft)":"none",flexWrap:"nowrap"}}>
                <LI name="fileText" size={14} color="var(--accent)"/>
                <span style={{flex:1,fontSize:14,fontWeight:600,color:"var(--text-dark)"}}>{f.n}</span>
                <span className="muted" style={{fontSize:14}}>{f.s}</span>
                <button className="btn btn-sm btn-ghost" style={{padding:"4px 10px"}} onClick={()=>addToast&&addToast("Fichier téléchargé.","success")}>{ico("download",14)}</button>
              </div>
            ))}
          </div>

          {/* 2e convocation — visible uniquement dans les détails */}
          <div className="card" style={{border:"2px dashed var(--warn)",background:"var(--warn-bg)",padding:14}}>
            <div className="flex-between" style={{marginBottom:6}}>
              <span style={{fontSize:14,fontWeight:800,color:"var(--warn)"}}>{ico("alertTriangle")} 2e convocation (si quorum non atteint)</span>
            </div>
            <div style={{fontSize:14,color:"var(--text-muted)",marginBottom:10}}>Si le quorum n'est pas atteint, une 2e convocation avec quorum réduit (33%) peut être générée automatiquement.</div>
            <button className="btn btn-warn btn-sm" onClick={()=>addToast&&addToast("2e convocation programmée.","success","Convocation créée")}>{ico("plusCircle",14)} Programmer la 2e convocation</button>
          </div>
        </div>}

      </div>
    </div>
  </div>);
};
const PageMembres=({go,onTour,addToast})=>{const[showAdd,setShowAdd]=useState(false);const[showDetail,setShowDetail]=useState(false);const[mFilter,setMFilter]=useState(0);const[emptyDemo,setEmptyDemo]=useState(false);
  return(<div className="page-anim">
  <PH page="membres" icon="users" title="Membres" sub="Registre des votants" right={<div className="flex-row" style={{gap:6}}><button className="btn btn-sm btn-ghost" onClick={()=>onTour&&onTour()}>{ico("compass",12)} Visite</button><button className="btn btn-sm btn-ghost" onClick={()=>setEmptyDemo(!emptyDemo)} style={{fontSize:12}}>{ico("eye",12)} {emptyDemo?"Voir données":"Simuler vide"}</button><button className="btn btn-sm" onClick={()=>addToast&&addToast("Importation CSV des membres (wireframe).","info")}>{ico("upload")} Importer CSV</button><button className="btn btn-p btn-sm" onClick={()=>setShowAdd(true)}>{ico("plus")} Ajouter</button></div>}/>
  {emptyDemo?
    <div className="card"><div className="empty-state"><div className="empty-state-icon"><LI name="users" size={24} color="var(--text-muted)"/></div><h3>Aucun membre pour le moment</h3><p>Importez votre liste de membres via CSV ou ajoutez-les manuellement pour commencer.</p><div className="flex-row" style={{justifyContent:"center",gap:8}}><button className="btn btn-p" onClick={()=>addToast&&addToast("Importation CSV des membres terminée.","success")}>{ico("upload")} Importer CSV</button><button className="btn" onClick={()=>setShowAdd(true)}>{ico("plus")} Ajouter manuellement</button></div></div></div>
  :<>
  <div className="grid-4" style={{marginBottom:14}}>{[{v:"67",l:"Membres",c:"var(--accent)",i:"users"},{v:"8 500",l:"Poids total",c:"var(--purple)",i:"scale"},{v:"3",l:"Groupes",c:"var(--success)",i:"layers"},{v:"5",l:"Inactifs",c:"var(--text-muted)",i:"userPlus"}].map(s=>(<div key={s.l} className="card" style={{textAlign:"center",padding:"12px 8px"}}><LI name={s.i} size={16} color={s.c}/><div style={{fontFamily:"var(--font-mono)",fontSize:20,fontWeight:700,color:s.c,margin:"2px 0",letterSpacing:"-0.5px",lineHeight:1}}>{s.v}</div><div style={{fontSize:14,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase"}}>{s.l}</div></div>))}</div>
  <div className="flex-row" style={{gap:6,marginBottom:10}}>{["Tous (67)","Lot A (28)","Lot B (24)","Lot C (15)","Inactifs (5)"].map((g,i)=>(<button key={g} className={`btn btn-sm ${mFilter===i?"btn-p":""}`} onClick={()=>setMFilter(i)}>{g}</button>))}</div>
  <div className="flex-row" style={{gap:8,marginBottom:10}}><input className="field-input" placeholder="Rechercher par nom, lot, courriel..." maxLength={100} style={{marginBottom:0,minHeight:40,flex:1}}/><button className="btn btn-sm" onClick={()=>addToast&&addToast("Fichier CSV téléchargé.","success")}>{ico("download")} Exporter</button></div>
  <div className="table-wrap" data-tour="membres-table"><table><thead><tr><th>Nom</th><th>Lot</th><th>Clé générale</th><th>Clé ascenseur</th><th>Statut</th><th></th></tr></thead><tbody>{[{n:"Membre A",l:"Lot 3",t:120,ta:85,e:"prenom@exemple.fr",g:"Lot A",a:true},{n:"Membre E",l:"Lot 7",t:95,ta:null,e:"membre.c@exemple.fr",g:"Lot A",a:true},{n:"SCI Exemple",l:"Lots 12-13",t:210,ta:160,e:"contact@sci-exemple.fr",g:"Lot B",a:true},{n:"Participant 1",l:"Lot 12",t:320,ta:240,e:"membre.b@exemple.fr",g:"Lot B",a:true},{n:"Membre A",l:"Lot 5",t:450,ta:310,e:"membre.a@exemple.fr",g:"Lot A",a:true},{n:"M. Roux André",l:"Lot 15",t:150,ta:100,e:"membre.d@exemple.fr",g:"Lot C",a:true},{n:"Membre inactif",l:"Lot 20",t:80,ta:null,e:"ancien@exemple.fr",g:"Lot C",a:false}].map((m,i)=>(<tr key={i}><td style={{cursor:"pointer"}} onClick={()=>setShowDetail(true)}><div style={{fontWeight:600,color:"var(--text-dark)"}}>{m.n}</div><div style={{fontSize:14,color:"var(--text-muted)"}}>{m.e} — <span className="tag tag-accent" style={{fontSize:14}}>{m.g}</span></div></td><td style={{fontSize:14}}>{m.l}</td><td style={{fontWeight:700}}>{m.t}</td><td style={{fontWeight:700,color:m.ta?"var(--text-dark)":"var(--text-light)"}}>{m.ta||"—"}</td><td><span className={`tag ${m.a?"tag-success":"tag-danger"}`} style={{fontSize:14}}>{m.a?"Actif":"Inactif"}</span></td><td><Popover trigger={<button className="btn btn-ghost btn-sm"><LI name="moreHorizontal" size={14}/></button>} items={[{label:"Modifier",icon:"edit"},{label:"Historique",icon:"clock"},"sep",{label:"Désactiver",icon:"x"}]}/></td></tr>))}</tbody></table><Pg n={5}/></div>
  <div className="ctx-panel" style={{marginTop:14}}><h4>{ico("lightbulb")} Clés de répartition</h4><p>Chaque membre possède un poids par clé de répartition (charges générales, ascenseur, chauffage…). Le «—» signifie que le membre n'est pas concerné par cette clé et ne votera pas sur les résolutions associées. Gérez les clés dans Paramètres.</p></div>
  </>}
  {/* MODAL AJOUT */}
  {showAdd&&<Modal title="Ajouter un membre" onClose={()=>setShowAdd(false)} footer={<><button className="btn" onClick={()=>setShowAdd(false)}>Annuler</button><button className="btn btn-p" onClick={()=>addToast&&addToast("Résolution ajoutée.","success")}>{ico("check")} Ajouter</button></>}>
    <div className="row"><div className="field"><label className="field-label">Nom complet <span className="req">*</span></label><input className="field-input" aria-required="true" placeholder="Ex : Nom Prénom" maxLength={80} autoComplete="off"/></div><div className="field"><label className="field-label">Courriel</label><input className="field-input" placeholder="prenom@exemple.fr" type="email" maxLength={120} autoComplete="off"/></div></div>
    <div className="row"><div className="field"><label className="field-label">Référence lot</label><input className="field-input" placeholder="Ex : Lot 3" maxLength={20} autoComplete="off"/></div><div className="field"><label className="field-label">Groupe</label><select className="field-input"><option>Lot A</option><option>Lot B</option><option>Lot C</option><option>+ Nouveau groupe</option></select></div></div>
    <div className="row"><div className="field"><label className="field-label">Poids de vote <span className="req">*</span> <HelpTip text="Nombre de voix pour ce membre. En copropriété : tantièmes du lot. En association : 1 par défaut."/></label><input className="field-input" type="number" placeholder="Ex : 120" min={0} max={99999}/></div><div className="field"><label className="field-label">Groupe</label><select className="field-input"><option>Lot A</option><option>Lot B</option><option>Lot C</option><option>+ Nouveau groupe</option></select></div></div>
    <div className="alert alert-warn" style={{margin:0}}>{ico("lightbulb")} Le poids de vote est configurable : 1 voix par membre (association), tantièmes (copropriété), parts sociales (SCI), etc.</div>
  </Modal>}

  {/* MODAL DETAIL */}
  {showDetail&&<Modal title="Fiche membre — M. Exemple Pierre" onClose={()=>setShowDetail(false)} footer={<><button className="btn" onClick={()=>setShowDetail(false)}>Fermer</button><button className="btn btn-p" onClick={()=>addToast&&addToast("Édition du membre (wireframe).","info")}>{ico("edit")} Modifier</button></>}>
    <div className="grid-2" style={{marginBottom:14}}>{[["Lot","Lot 12"],["Poids de vote","320 voix"],["Email","membre.b@exemple.fr"],["Groupe","Lot B"],["Statut","Actif"]].map(([k,v],i)=>(<div key={i} style={{padding:"6px 0"}}><div className="muted" style={{fontSize:14}}>{k}</div><div style={{fontWeight:700,color:"var(--text-dark)"}}>{v}</div></div>))}</div>
    <div className="h3" style={{marginBottom:8}}>Historique de participation</div>
    <div className="table-wrap"><table><thead><tr><th>Séance</th><th>Date</th><th>Statut</th><th>Votes</th></tr></thead><tbody>{[{s:"AG Ordinaire",d:"15/02/2026",st:"Présent",v:"5/5"},{s:"AG Extra. Travaux",d:"28/01/2026",st:"Procuration",v:"3/3 (via Mme. Laurent)"},{s:"AG Ordinaire 2025",d:"15/12/2025",st:"Présent",v:"11/12"}].map((h,i)=>(<tr key={i}><td style={{fontWeight:600,color:"var(--text-dark)"}}>{h.s}</td><td style={{fontSize:14}}>{h.d}</td><td><span className={`tag ${h.st==="Présent"?"tag-success":"tag-accent"}`}>{h.st}</span></td><td style={{fontSize:14}}>{h.v}</td></tr>))}</tbody></table></div>
  </Modal>}
</div>)};

/* ═══ STATISTIQUES ═══ */
const PageStats=({onTour,addToast})=>(<div className="page-anim">
  <PH page="stats" icon="pieChart" title="Statistiques" sub="Tableaux de bord" right={<div className="flex-row" style={{gap:6}}><button className="btn btn-sm btn-ghost" onClick={()=>onTour&&onTour()}>{ico("compass",12)} Visite</button><select className="field-input" style={{minHeight:40,width:140,marginBottom:0}}><option>Année 2026</option><option>Année 2025</option><option>Tout</option></select><button className="btn btn-sm" onClick={()=>addToast&&addToast("Statistiques PDF téléchargées.","success","Téléchargement")}>{ico("download")} Exporter PDF</button></div>}/>

  {/* KPI avec tendance */}
  <div className="grid-4" data-tour="stats-kpi" style={{marginBottom:14}}>{[{v:"24",l:"Séances",c:"var(--accent)",i:"calendar",trend:"+4 vs 2025",up:true},{v:"156",l:"Résolutions",c:"var(--success)",i:"vote",trend:"+22 vs 2025",up:true},{v:"87%",l:"Taux adoption",c:"var(--success)",i:"checkCircle",trend:"+3% vs 2025",up:true},{v:"72%",l:"Participation moy.",c:"var(--purple)",i:"users",trend:"-2% vs 2025",up:false}].map(s=>(<div key={s.l} className="card" style={{textAlign:"center",padding:"12px 8px"}}><LI name={s.i} size={16} color={s.c}/><div style={{fontFamily:"var(--font-mono)",fontSize:20,fontWeight:700,color:s.c,margin:"2px 0",letterSpacing:"-0.5px",lineHeight:1}}>{s.v}</div><div style={{fontSize:14,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase"}}>{s.l}</div><div style={{fontSize:14,fontWeight:700,color:s.up?"var(--success)":"var(--danger)",marginTop:4}}>{s.up?"↑":"↓"} {s.trend}</div></div>))}</div>

  {/* Donut + participation */}
  <div className="grid-2" data-tour="stats-chart" style={{marginBottom:14}}>
    <div className="card">
      <div className="card-title">{ico("pieChart")} Répartition des votes (global)</div>
      <div style={{display:"flex",alignItems:"center",gap:24,flexWrap:"wrap",justifyContent:"center"}}>
        <Donut segments={[{pct:55,color:"var(--success)"},{pct:30,color:"var(--danger)"},{pct:15,color:"#94A3B8"}]} size={160} thick={20} centerValue="156" centerLabel="votes"/>
        <div style={{flex:1}}>
          {[{l:"Pour",v:86,pct:55,c:"var(--success)"},{l:"Contre",v:47,pct:30,c:"var(--danger)"},{l:"Abstention",v:23,pct:15,c:"#94A3B8"}].map(r=>(<div key={r.l} style={{marginBottom:10}}>
            <div className="flex-between" style={{marginBottom:3}}>
              <div className="flex-row" style={{gap:6}}><div style={{width:10,height:10,borderRadius:3,background:r.c,flexShrink:0}}/><span style={{fontSize:14,fontWeight:700,color:"var(--text-dark)"}}>{r.l}</span></div>
              <span style={{fontSize:14,fontWeight:800,color:r.c}}>{r.v} ({r.pct}%)</span>
            </div>
            <div style={{height:10,background:"var(--tag-bg)",borderRadius:5,overflow:"hidden"}}><div style={{height:"100%",width:`${r.pct}%`,background:r.c,borderRadius:5,transition:"width .4s ease"}}/></div>
          </div>))}
        </div>
      </div>
    </div>
    <div className="card"><div className="card-title">{ico("activity")} Participation par séance</div>{[{t:"AG Ordinaire (02/2026)",v:67,p:45},{t:"Conseil syndical (02/2026)",v:12,p:12},{t:"AG Extra. Travaux (01/2026)",v:67,p:52},{t:"AG Annuelle (12/2025)",v:67,p:54}].map((s,i)=>{const pct=Math.round(s.p/s.v*100);const clr=pct>=90?"var(--success)":pct>=50?"var(--warn)":"var(--danger)";return(<div key={i} style={{marginBottom:10}}>
      <div className="flex-between" style={{marginBottom:3}}><span style={{fontSize:14,fontWeight:600,color:"var(--text-dark)"}}>{s.t}</span><span style={{fontSize:14,fontWeight:800,color:clr}}>{s.p}/{s.v} ({pct}%)</span></div>
      <div style={{height:10,background:"var(--tag-bg)",borderRadius:5,overflow:"hidden"}}><div style={{height:"100%",width:`${pct}%`,background:clr,borderRadius:5,transition:"width .4s ease"}}/></div>
    </div>)})}</div>
  </div>

  {/* Résolutions par majorité + durées */}
  <div className="grid-2">
    <div className="card"><div className="card-title">{ico("scale")} Résolutions par majorité</div>
      {[{m:"Art. 24 — Majorité simple",n:98,t:156,c:"var(--success)"},{m:"Art. 25 — Majorité absolue",n:35,t:156,c:"var(--accent)"},{m:"Art. 26 — Double majorité",n:18,t:156,c:"var(--purple)"},{m:"Unanimité",n:5,t:156,c:"var(--warn)"}].map(r=>(<div key={r.m} style={{marginBottom:12}}>
        <div className="flex-between" style={{marginBottom:4}}><span style={{fontSize:14,fontWeight:600,color:"var(--text-dark)"}}>{r.m}</span><span style={{fontSize:15,fontWeight:800,color:r.c}}>{r.n} <span style={{fontSize:14,fontWeight:600,color:"var(--text-muted)"}}>({Math.round(r.n/r.t*100)}%)</span></span></div>
        <div style={{height:10,background:"var(--tag-bg)",borderRadius:5,overflow:"hidden"}}><div style={{height:"100%",width:`${r.n/r.t*100}%`,background:r.c,borderRadius:5,transition:"width .4s ease"}}/></div>
      </div>))}</div>
    <div className="card"><div className="card-title">{ico("clock")} Durée moyenne des séances</div>{[{t:"AG Ordinaire",d:"2h15",m:135,max:180,c:"var(--accent)"},{t:"AG Extraordinaire",d:"1h45",m:105,max:180,c:"var(--purple)"},{t:"Conseil syndical",d:"0h50",m:50,max:180,c:"var(--success)"}].map(r=>(<div key={r.t} style={{marginBottom:12}}>
      <div className="flex-between" style={{marginBottom:4}}><span style={{fontSize:14,fontWeight:600,color:"var(--text-dark)"}}>{r.t}</span><span style={{fontSize:15,fontWeight:800,color:r.c}}>{r.d}</span></div>
      <div style={{height:10,background:"var(--tag-bg)",borderRadius:5,overflow:"hidden"}}><div style={{height:"100%",width:`${r.m/r.max*100}%`,background:r.c,borderRadius:5,transition:"width .4s ease"}}/></div>
    </div>))}</div>
  </div>

  {/* Séances par mois — bar chart */}
  <div className="card" style={{marginTop:14}}><div className="card-title">{ico("barChart")} Séances par mois (2026)</div>
    <div style={{display:"flex",alignItems:"flex-end",gap:6,height:80,padding:"8px 0"}}>
      {[{l:"Jan",v:3},{l:"Fév",v:5},{l:"Mar",v:2},{l:"Avr",v:0},{l:"Mai",v:0},{l:"Jun",v:0},{l:"Jul",v:0},{l:"Aoû",v:0},{l:"Sep",v:0},{l:"Oct",v:0},{l:"Nov",v:0},{l:"Déc",v:0}].map((m,i)=>{const max=5;const h=m.v>0?Math.max(8,Math.round(m.v/max*64)):3;const isNow=i===1;return(<Tip key={m.l} label={`${m.l} : ${m.v} séance${m.v>1?"s":""}`}><div style={{display:"flex",flexDirection:"column",alignItems:"center",gap:3,flex:1}}>
        <div style={{fontSize:11,fontWeight:700,color:m.v>0?"var(--text-dark)":"var(--text-light)"}}>{m.v||""}</div>
        <div style={{width:"100%",maxWidth:28,height:h,background:isNow?"var(--accent)":m.v>0?"var(--accent-light)":"var(--surface-alt)",borderRadius:"3px 3px 0 0",transition:"height .3s ease",cursor:"pointer"}}/>
        <div style={{fontSize:11,fontWeight:600,color:isNow?"var(--accent)":"var(--text-muted)"}}>{m.l}</div>
      </div></Tip>)})}
    </div>
  </div>
</div>);

/* ═══ AIDE & FAQ — content from github.com/thomasvinh-san-byte/gestion-votes/docs ═══ */
const PageAide=({onTour,go,addToast,initialTab})=>{const[open,setOpen]=useState(-1);const[faqSearch,setFaqSearch]=useState("");const[faqCat,setFaqCat]=useState("all");
  const faqs=[
  {cat:"Général",icon:"info",items:[
    {q:"Qu'est-ce qu'AG-Vote ?",a:"AG-Vote est une application web de gestion de séances de vote délibératives : assemblées générales, conseils d'administration, réunions de bureau, comités, associations. Elle couvre le cycle complet : préparation, conduite en direct, vote électronique, calcul des résultats, validation et génération des livrables (PV, exports CSV)."},
    {q:"Faut-il une connexion Internet ?",a:"Non. AG-Vote fonctionne en réseau local fermé. L'application est auto-hébergée. Seul l'envoi de courriels nécessite une connexion."},
    {q:"Peut-on modifier une séance validée ?",a:"Non. Après validation, la base de données est verrouillée. Toute modification est refusée — c'est une garantie d'intégrité irréversible."},
    {q:"Comment fonctionne le vote électronique ?",a:"Chaque votant reçoit un lien unique par courriel. Il vote sur sa tablette ou téléphone. Le lien est à usage unique — impossible de voter deux fois. Le bulletin est enregistré avec le poids du votant."},
  ]},
  {cat:"Préparation",icon:"calendar",items:[
    {q:"Comment créer une séance ?",a:"Allez dans Créer une séance. L'assistant en 4 étapes vous guide : Informations générales, Participants, Résolutions, Vérification. La séance est créée en brouillon, modifiable à tout moment."},
    {q:"Comment importer les membres ?",a:"Via la page Membres > Importer CSV (colonnes : Nom, Référence, Poids, Courriel), ou via l'étape 2 de l'assistant. Le système détecte les doublons."},
    {q:"Quel est le délai pour les convocations ?",a:"Le délai dépend de vos statuts. Le système permet de le configurer dans Paramètres > Convocations et calcule automatiquement la date limite."},
    {q:"Différence entre poids de vote et voix ?",a:"Le poids détermine le nombre de voix d'un participant. En mode égal : 1 personne = 1 voix. En mode pondéré : le poids est défini par membre (tantièmes, parts, capital)."},
    {q:"Comment configurer le quorum ?",a:"Dans Paramètres > Règles de vote > Politiques de quorum. Modes : majorité + 1 (défaut), pourcentage des voix, tiers des présents (2e convocation), ou aucun quorum."},
    {q:"Comment fonctionnent les clés de répartition ?",a:"Chaque résolution utilise une clé (ex : charges générales, ascenseur) qui détermine le poids de vote de chaque participant. Un participant absent de la clé ne vote pas sur cette résolution."},
  ]},
  {cat:"Vote en direct",icon:"play",items:[
    {q:"Comment lancer un vote ?",a:"Depuis la Fiche séance, cliquez 'Lancer'. Depuis l'Opérateur, chaque résolution s'ouvre automatiquement. Les votants voient la question sur leur tablette."},
    {q:"Que faire si un votant ne peut pas utiliser la tablette ?",a:"Utilisez le comptage manuel dans l'Opérateur > onglet Avancé. Saisissez les votes Pour/Contre/Abstention et cliquez 'Intégrer au résultat'."},
    {q:"Comment savoir combien de personnes ont voté ?",a:"La barre de résultat se met à jour en temps réel. La barre de guidage indique quand tous les votants ont voté et que vous pouvez proclamer."},
    {q:"Qu'est-ce que le vote par correspondance ?",a:"Les bulletins reçus avant la séance sont intégrés automatiquement. Chaque bulletin est chiffré et ouvert au dépouillement, conformément à la CNIL 2019-053."},
    {q:"Comment fonctionne la passerelle art. 25-1 ?",a:"Si une résolution en majorité absolue (art. 25) n'est pas adoptée mais obtient au moins 1/3 des voix, un second vote en majorité simple (art. 24) est proposé."},
  ]},
  {cat:"Sécurité",icon:"shield",items:[
    {q:"Comment sont protégés les votes ?",a:"Chaque vote est enregistré avec une empreinte cryptographique (SHA-256). La base est en lecture seule après validation. L'audit complet est consultable dans le journal de traçabilité."},
    {q:"Qu'est-ce que la séparation identité / bulletin ?",a:"C'est une exigence CNIL (Délibération 2019-053). Après validation du vote, aucun lien n'existe entre le votant et son choix. Le système sépare les deux."},
    {q:"Comment fonctionne la signature eIDAS ?",a:"Le PV peut être signé électroniquement (signature avancée ou qualifiée conforme eIDAS). La signature qualifiée a la valeur juridique maximale."},
    {q:"Quel est le délai de contestation ?",a:"Configurable dans Paramètres > Sécurité. Par défaut : 60 jours à compter de la notification du PV. Le PV doit être notifié dans le délai prévu par vos statuts."},
  ]},
  {cat:"Technique",icon:"settings",items:[
    {q:"Quels navigateurs sont compatibles ?",a:"Tous les navigateurs modernes : Chrome, Firefox, Safari, Edge. L'interface est optimisée pour tablette (iPad, Android) utilisée par les votants."},
    {q:"Comment sauvegarder mes données ?",a:"Paramètres > Général > RGPD > Exporter mes données. Le système génère un archive ZIP contenant toutes les données au format standard."},
    {q:"Comment programmer une 2e convocation ?",a:"Si le quorum n'est pas atteint, le système propose automatiquement une 2e convocation avec quorum réduit (33%). Activable dans Paramètres > Sécurité."},
    {q:"Comment contacter le support ?",a:"Envoyez un courriel à l'adresse configurée dans Paramètres > Général > Courriel de support. Le système de tickets intégré est disponible directement depuis cette page."},
  ]},
  ];

  const tours=[
    {id:"dashboard",l:"Tableau de bord",i:"barChart",n:4,t:"2 min",d:"KPI, tâches, raccourcis"},
    {id:"wizard",l:"Créer une séance",i:"plusCircle",n:1,t:"1 min",d:"Assistant en 4 étapes"},
    {id:"operator",l:"Opérateur",i:"play",n:8,t:"4 min",d:"Pilotage en direct"},
    {id:"membres",l:"Membres",i:"users",n:1,t:"1 min",d:"Registre des votants"},
    {id:"hub",l:"Fiche séance",i:"clipboard",n:4,t:"2 min",d:"Préparation et suivi"},
    {id:"stats",l:"Statistiques",i:"pieChart",n:2,t:"1 min",d:"Tableaux de bord"},
    {id:"postsession",l:"Clôture et PV",i:"fileText",n:1,t:"1 min",d:"Post-session"},
  ];

  /* Flatten + filter FAQ */
  const allQ=faqs.flatMap(c=>c.items.map(q=>({...q,cat:c.cat})));
  const filtered=allQ.filter(q=>{
    const matchCat=faqCat==="all"||q.cat===faqCat;
    const matchSearch=!faqSearch||q.q.toLowerCase().includes(faqSearch.toLowerCase())||q.a.toLowerCase().includes(faqSearch.toLowerCase());
    return matchCat&&matchSearch;
  });

  return(<div className="page-anim"><PH page="aide" icon="helpCircle" title="Aide" sub="Visites guidées et questions fréquentes"/>

  {/* ═══ SECTION 1 : VISITES GUIDÉES ═══ */}
  <div style={{marginBottom:18}}>
    <div style={{fontSize:15,fontWeight:800,color:"var(--text-dark)",marginBottom:10}}>{ico("compass")} Visites guidées</div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:10}}>
      {tours.map(t=>(<div key={t.id} className="card" style={{padding:14,cursor:"pointer",transition:"box-shadow .2s"}} onClick={()=>{if(onTour)onTour(t.id);if(go)go(t.id)}}>
        <div className="flex-row" style={{gap:10,flexWrap:"nowrap"}}>
          <div style={{width:36,height:36,borderRadius:10,background:"var(--accent-light)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}><LI name={t.i} size={16} color="var(--accent)"/></div>
          <div style={{minWidth:0}}>
            <div style={{fontWeight:700,color:"var(--text-dark)",fontSize:14}}>{t.l}</div>
            <div className="muted" style={{fontSize:14}}>{t.n} étapes • {t.t}</div>
          </div>
        </div>
      </div>))}
    </div>
  </div>

  {/* ═══ SECTION 2 : FAQ ACCORDION ═══ */}
  <div>
    <div className="flex-between" style={{marginBottom:10}}>
      <div style={{fontSize:15,fontWeight:800,color:"var(--text-dark)"}}>{ico("helpCircle")} Questions fréquentes ({filtered.length})</div>
      <button className="btn btn-sm btn-ghost" onClick={()=>addToast&&addToast("Courriel envoyé à support@exemple.fr","success")}>{ico("send",14)} Contacter le support</button>
    </div>

    {/* Search + filters */}
    <div className="flex-row" style={{gap:8,marginBottom:12}}>
      <div style={{flex:1,position:"relative"}}><LI name="search" size={16} color="var(--text-light)" style={{position:"absolute",left:10,top:11}}/><input className="field-input" placeholder="Rechercher dans la FAQ..." maxLength={100} value={faqSearch} onChange={e=>{setFaqSearch(e.target.value);setOpen(-1)}} style={{paddingLeft:32,marginBottom:0,minHeight:40}}/></div>
      <div className="flex-row" style={{gap:4}}>{[{k:"all",l:"Tout"},...faqs.map(c=>({k:c.cat,l:c.cat}))].map(f=>(<button key={f.k} className={`btn btn-sm ${faqCat===f.k?"btn-p":""}`} onClick={()=>{setFaqCat(f.k);setOpen(-1)}}>{f.l}</button>))}</div>
    </div>

    {/* Accordion */}
    <div className="card" style={{padding:0,overflow:"hidden"}}>
      {filtered.length===0&&<div style={{padding:24,textAlign:"center"}}><div className="muted">Aucun résultat pour « {faqSearch} »</div></div>}
      {filtered.map((q,i)=>(<div key={i} style={{borderBottom:i<filtered.length-1?"1px solid var(--border-soft)":"none"}}>
        <button onClick={()=>setOpen(open===i?-1:i)} style={{display:"flex",alignItems:"center",gap:10,width:"100%",padding:"12px 16px",background:open===i?"var(--accent-light)":"transparent",border:"none",cursor:"pointer",textAlign:"left",transition:"background .15s"}}>
          <span style={{fontSize:14,fontWeight:700,color:open===i?"var(--accent)":"var(--text-dark)",flex:1}}>{q.q}</span>
          <span className="tag" style={{fontSize:14,flexShrink:0}}>{q.cat}</span>
          <LI name={open===i?"chevU":"chevD"} size={14} color={open===i?"var(--accent)":"var(--text-light)"}/>
        </button>
        {open===i&&<div style={{padding:"0 16px 14px 16px",fontSize:14,color:"var(--text-muted)",lineHeight:1.6}}>{q.a}</div>}
      </div>))}
    </div>

    {/* Exports reference */}
    <details style={{marginTop:14}}>
      <summary style={{fontSize:14,fontWeight:700,color:"var(--text-dark)",cursor:"pointer",padding:"8px 0"}}>{ico("download")} Référence des exports</summary>
      <div className="card" style={{marginTop:6,padding:12}}>
        <div className="table-wrap" style={{fontSize:14}}><table><thead><tr><th>Document</th><th>Format</th><th>Disponibilité</th></tr></thead><tbody>
          {[["PV (Procès-Verbal)","HTML / PDF","Après validation"],["Feuille d'émargement","PDF","Après pointage"],["Votes par correspondance","PDF","Après dépouillement"],["Présences","CSV","Tout moment"],["Votes (détail par clé)","CSV","Après clôture"],["Résultats (synthèse)","CSV","Après clôture"],["Membres (registre)","CSV","Tout moment"],["Audit (journal)","CSV","Tout moment"]].map(([n,f,d],i)=>(<tr key={i}><td style={{fontWeight:600,color:"var(--text-dark)"}}>{n}</td><td><span className="tag tag-accent" style={{fontSize:14}}>{f}</span></td><td className="muted">{d}</td></tr>))}
        </tbody></table></div>
      </div>
    </details>
  </div>
</div>)};


/* ═══ DEVICE INDICATOR COMPONENT ═══ */
const DeviceBar=({type,label,desc})=>{
  const icons={pc:<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>,
    tablet:<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>};
  return(<div className={`device-bar device-bar-${type}`}>{icons[type]}<span className="device-label">{label}</span><span className="device-desc">— {desc}</span></div>)
};
function App(){
  const[logged,setLogged]=useState(false);const[page,setPage]=useState("dashboard");const[theme,setTheme]=useState("light");const[showOB,setShowOB]=useState(true);const[tour,setTour]=useState(null);
  const[searchOpen,setSearchOpen]=useState(false);
  const[notifOpen,setNotifOpen]=useState(false);
  const[toasts,setToasts]=useState([]);
  const addToast=(msg,type='info',title='')=>{
    const id=Date.now()+Math.random();
    setToasts(t=>[...t,{id,msg,type,title}]);
    setTimeout(()=>setToasts(t=>t.filter(x=>x.id!==id)),4200);
  };
  const removeToast=id=>setToasts(t=>t.filter(x=>x.id!==id));const[expandedGroups,setExpandedGroups]=useState(NAV.map(g=>g.group));const[sidebarOpen,setSidebarOpen]=useState(false);const[pinned,setPinned]=useState(false);const[aideTab,setAideTab]=useState("faq");const[sessionWarning,setSessionWarning]=useState(false);const SESSION_TIMEOUT=15*60*1000;const WARN_BEFORE=2*60*1000;
  const sidebarRef=useRef(null);const[scrollState,setScrollState]=useState({top:false,bottom:false});const mainRef=useRef(null);const inactivityRef=useRef(null);const warnRef=useRef(null);
  /* Session inactivity timer */
  useEffect(()=>{if(!logged)return;const reset=()=>{setSessionWarning(false);clearTimeout(inactivityRef.current);clearTimeout(warnRef.current);warnRef.current=setTimeout(()=>setSessionWarning(true),SESSION_TIMEOUT-WARN_BEFORE);inactivityRef.current=setTimeout(()=>setLogged(false),SESSION_TIMEOUT)};const events=["mousemove","keydown","click","scroll"];events.forEach(e=>window.addEventListener(e,reset));reset();return()=>{events.forEach(e=>window.removeEventListener(e,reset));clearTimeout(inactivityRef.current);clearTimeout(warnRef.current)}},[logged]);
  useEffect(()=>{const el=sidebarRef.current;if(!el)return;const check=()=>{const top=el.scrollTop>8;const bottom=el.scrollHeight-el.scrollTop-el.clientHeight>8;setScrollState({top,bottom})};check();const ro=new ResizeObserver(check);ro.observe(el);el.addEventListener("scroll",check);return()=>{ro.disconnect();el.removeEventListener("scroll",check)}},[page,expandedGroups]);
  useEffect(()=>{document.body.setAttribute("data-theme",theme)},[theme]);
  useEffect(()=>{if(mainRef.current)mainRef.current.scrollTop=0;if(sidebarRef.current){const el=sidebarRef.current.querySelector('.nav-item.active');if(el)el.scrollIntoView({block:'nearest',behavior:'smooth'})}},[page]);
  useEffect(()=>{const h=e=>{if(e.key==="Escape"){if(notifOpen)setNotifOpen(false);if(sidebarOpen)setSidebarOpen(false);}if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault();setSearchOpen(s=>!s);}};document.addEventListener("keydown",h);return()=>document.removeEventListener("keydown",h)},[sidebarOpen,notifOpen]);
  const go=p=>{setPage(p);setSidebarOpen(false);const g=NAV.find(n=>n.items&&n.items.some(it=>it.page===p));if(g&&!expandedGroups.includes(g.group))setExpandedGroups(prev=>[...prev,g.group])};
  if(!logged)return(<><a href="#main-content" className="skip-link">Aller au contenu principal</a><PageLanding onLogin={()=>setLogged(true)} onDoc={()=>{setAideTab("faq");setLogged(true);setPage("aide")}} onSupport={()=>{setAideTab("support");setLogged(true);setPage("aide")}}/></>);

  const adminPages={
  dashboard:<PageDashboard go={go} onTour={()=>setTour("dashboard")} addToast={addToast} showOB={showOB} onHideOB={()=>setShowOB(false)}/>,
  seances:<PageSeances go={go} addToast={addToast}/>,
  membres:<PageMembres go={go} onTour={()=>setTour("membres")} addToast={addToast}/>,
  wizard:<PageWizard go={go} onTour={()=>setTour("wizard")} addToast={addToast}/>,
  hub:<PageHub go={go} onTour={()=>setTour("hub")} addToast={addToast}/>,
  operator:<PageOperator go={go} onTour={()=>setTour("operator")} addToast={addToast}/>,
  ecran:<PageEcran go={go}/>,
  postsession:<PagePostSession go={go} onTour={()=>setTour("postsession")} addToast={addToast}/>,
  audit:<PageAudit go={go} addToast={addToast}/>,
  archives:<PageArchives go={go} addToast={addToast}/>,
  utilisateurs:<PageUtilisateurs addToast={addToast}/>,
  parametres:<PageParametres addToast={addToast}/>,
  stats:<PageStats onTour={()=>setTour("stats")} addToast={addToast}/>,
  aide:<PageAide onTour={p=>setTour(p)} go={go} addToast={addToast} initialTab={aideTab}/>,
};

  /* ═══ ÉCRAN SALLE — plein écran sans sidebar/header ═══ */
  if(page==="ecran")return(<div style={{position:"fixed",inset:0,zIndex:200,background:"#0B0F1A"}}><PageEcran go={go}/></div>);

  /* ═══ VOTANT — Seul écran tablette/mobile ═══ */
  if(page==="votant")return(<div className="standalone-page">
    <div className="standalone-nav">
      <button className="btn btn-sm" onClick={()=>setPage("operator")}>{ico("chevL")} Retour à l'interface PC</button>
      <div className="flex-row" style={{gap:8,flexWrap:"nowrap"}}><LI name={theme==="light"?"sun":"moon"} size={14} color="var(--text-muted)"/><button className="theme-toggle" onClick={()=>setTheme(theme==="light"?"dark":"light")}/></div>
    </div>
    <div className="standalone-content">
      <div className="tablet-frame">
        <DeviceBar type="tablet" label="Tablette / Mobile" desc="Ce que voit le votant sur son appareil personnel"/>
        <div className="tablet-body"><PageVotant/></div>
      </div>
    </div>
  </div>);

  /* ═══ ADMIN — PC avec icon rail ═══ */
  const pageLabel=(()=>{for(const g of NAV)for(const it of g.items)if(it.page===page)return it.label;if(page==="votant")return"Aperçu votant";if(page==="aide")return"Guide et FAQ";return"Tableau de bord"})();
  return(<div className="app">
    <a href="#main-content" className="skip-link">Aller au contenu principal</a>
    <header className="header"><div className="flex-row" style={{gap:8,flexWrap:"nowrap"}}><button className="hamburger" onClick={()=>setSidebarOpen(!sidebarOpen)} aria-label="Menu principal" aria-expanded={sidebarOpen}><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><line x1="3" y1="7" x2="21" y2="7"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="17" x2="21" y2="17"/></svg></button><div className="logo"><div className="logo-mark"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#fff" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m9 12 2 2 4-4"/><path d="M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z"/><path d="M22 19H2"/></svg></div>AG-Vote</div><span style={{fontSize:12,fontWeight:700,color:"var(--accent)",background:"var(--accent-light)",padding:"2px 7px",borderRadius:4}}>v3.19.2</span>
          {logged&&<div className="header-ctx">{ico(NAV.flatMap(g=>g.items).find(i=>i.page===page)?.icon||"home",12)}<span className="header-ctx-name">{NAV.flatMap(g=>g.items).find(i=>i.page===page)?.label||"Tableau de bord"}</span></div>}</div><div className="flex-row" style={{gap:6,flexWrap:"nowrap"}}>
        <button className="search-trigger" onClick={()=>setSearchOpen(true)} aria-label="Recherche">{ico("search",14)}<span style={{marginLeft:2}}>Recherche</span></button>
        <div style={{position:"relative"}}>
          <button className="notif-bell" onClick={()=>setNotifOpen(n=>!n)} aria-label="Notifications" aria-expanded={notifOpen} aria-haspopup="true">
            {ico("bell",18)}
            <span className="notif-count">15</span>
          </button>
          {notifOpen&&(<><div style={{position:"fixed",inset:0,zIndex:199}} onClick={()=>setNotifOpen(false)} aria-hidden="true"/><div className="notif-panel" role="menu" aria-label="Notifications">
            <div className="notif-hdr"><span className="notif-hdr-title">Notifications</span><button className="btn btn-sm btn-ghost" style={{fontSize:12,padding:"2px 8px"}} onClick={()=>{setNotifOpen(false);addToast&&addToast("Toutes les notifications marquées comme lues.","info")}}>Tout lire</button></div>
            {[{m:"12 convocations en attente — AG Copro. A",t:"J-3",c:"var(--danger)",d:"hub"},{m:"3 PV à finaliser et envoyer",t:"Hier",c:"var(--warn)",d:"postsession"},{m:"Importation membres : 5 doublons détectés",t:"Il y a 2j",c:"var(--warn)",d:"membres"},{m:"AG Copropriété B — quorum atteint (67%)",t:"Il y a 3j",c:"var(--success)",d:"operator"},{m:"Nouveau certificat eIDAS disponible",t:"Il y a 5j",c:"var(--accent)",d:"parametres"}].map((n,i)=>(
              <div key={i} className="notif-item" role="menuitem" onClick={()=>{go(n.d);setNotifOpen(false)}}>
                <div className="notif-dot" style={{background:n.c}}/>
                <div className="notif-body"><div className="notif-msg">{n.m}</div><div className="notif-time">{n.t}</div></div>
                {ico("chevR",12)}
              </div>
            ))}
          </div></>)}
        </div>
        <div style={{width:1,height:20,background:"var(--border)"}}/>
        <div className="flex-row" style={{gap:4}}><LI name={theme==="light"?"sun":"moon"} size={14} color="var(--text-muted)" aria-hidden="true"/><button className="theme-toggle" onClick={()=>setTheme(theme==="light"?"dark":"light")} aria-label={theme==="light"?"Mode sombre":"Mode clair"} role="switch" aria-checked={theme==="dark"}/></div>
        <div style={{width:1,height:20,background:"var(--border)"}}/>
        <span className="tag" style={{fontSize:12,fontWeight:800,background:"var(--accent-light)",color:"var(--accent)",border:"1px solid rgba(22,80,224,.2)",whiteSpace:"nowrap"}}>WIREFRAME</span>
        <span style={{fontSize:13,fontWeight:600,color:"var(--text-muted)",whiteSpace:"nowrap"}}>Admin (démo)</span>
        <button className="btn btn-sm btn-ghost" onClick={()=>setLogged(false)} aria-label="Retour à l'accueil" title="Retour à l'accueil">{ico("logOut",14)}</button>
      </div></header>
    <DeviceBar type="pc" label="Interface PC" desc="Administration, préparation et pilotage — accessible uniquement depuis un ordinateur"/>
    <div className="body-wrap">
      <aside className={`sidebar${pinned?" pinned":""}${sidebarOpen?" open":""}`} aria-label="Navigation principale" role="navigation">
        <button className="sidebar-pin" onClick={()=>setPinned(!pinned)} aria-label={pinned?"Réduire la barre latérale":"Épingler la barre latérale ouverte"} aria-pressed={pinned} title={pinned?"Réduire la sidebar":"Épingler la sidebar ouverte"}><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 17v5"/><path d={pinned?"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z":"M9 4v6l-2 4h10l-2-4V4"}/></svg></button>
        <div style={{height:12,flexShrink:0}}/>
        <div className={`sidebar-fade${scrollState.top?" has-scroll-top":""}${scrollState.bottom?" has-scroll-bottom":""}`}>
        <div className="sidebar-scroll" ref={sidebarRef}>
          <nav aria-label="Navigation principale">{NAV.map((g,gi)=>{
            const active=g.items.some(it=>it.page===page);
            const collapsed=!active&&!expandedGroups.includes(g.group);
            return(<Fragment key={g.group}>
              <div className={`nav-group${collapsed?" collapsed":""}`} onClick={()=>setExpandedGroups(prev=>prev.includes(g.group)?prev.filter(x=>x!==g.group):[...prev,g.group])} role="button" tabIndex={0} aria-expanded={!collapsed} aria-label={g.group} onKeyDown={e=>(e.key==="Enter"||e.key===" ")&&setExpandedGroups(prev=>prev.includes(g.group)?prev.filter(x=>x!==g.group):[...prev,g.group])}>
                <span className="nav-group-label">{g.group}</span>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" aria-hidden="true"><path d="m6 9 6 6 6-6"/></svg>
              </div>
              {!collapsed&&g.items.map(it=>(<div key={it.label} className={`nav-item${it.page===page?" active":""}`} onClick={()=>{setPage(it.page);setSidebarOpen(false)}} tabIndex={0} role="menuitem" aria-current={it.page===page?"page":undefined} title={it.label} onKeyDown={e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();setPage(it.page);setSidebarOpen(false)}}}><LI name={it.icon} size={18}/><span className="nav-label">{it.label}</span>{it.badge&&it.page!==page&&<span className="nav-badge">{it.badge}</span>}</div>))}
            </Fragment>)
          })}</nav>
        </div></div>
        {/* Aperçu tablette */}
        <div className="sidebar-device-section">
          {DEVICE_PREVIEWS.map(dp=>(<div key={dp.page} className={`nav-item${page===dp.page?" active":""}`} onClick={()=>{setPage(dp.page);setSidebarOpen(false)}} tabIndex={0} role="menuitem" aria-current={page===dp.page?"page":undefined} title={dp.label} onKeyDown={e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();setPage(dp.page);setSidebarOpen(false)}}}><LI name={dp.icon} size={20}/><span className="nav-label">{dp.label}</span><span className="device-tag">{dp.device}</span></div>))}
        </div>
        <div className="sidebar-footer">
          <div className={`nav-item${page==="aide"?" active":""}`} onClick={()=>{setPage("aide");setSidebarOpen(false)}} tabIndex={0} role="menuitem" aria-current={page==="aide"?"page":undefined} title="Guide et FAQ" onKeyDown={e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();setPage("aide");setSidebarOpen(false)}}}><LI name="info" size={20}/><span className="nav-label">Guide et FAQ</span></div>
          <div className="sidebar-version">AG-Vote v3.19.2</div>
        </div>
      </aside>
      {sidebarOpen&&<div className="sidebar-overlay" onClick={()=>setSidebarOpen(false)}/>}
      <main className="main" id="main-content" ref={mainRef} tabIndex={-1}>{adminPages[page]||adminPages.dashboard}</main>
    </div>
    <nav className="mobile-bnav" aria-label="Navigation principale">
      {[{i:"home",l:"Tableau de bord",p:"dashboard"},{i:"calendar",l:"Séances",p:"seances"},{i:"clipboard",l:"Fiche",p:"hub"},{i:"play",l:"Opérateur",p:"operator"},{i:"settings",l:"Paramètres",p:"parametres"}].map(b=>(<button key={b.p} className={`mobile-bnav-btn${page===b.p?" act":""}`} onClick={()=>go(b.p)} aria-label={b.l} aria-current={page===b.p?"page":undefined}>{ico(b.i,20)}<span>{b.l}</span></button>))}
    </nav>
    <footer className="app-footer"><span style={{fontWeight:600,color:"var(--text)"}}>AG-Vote</span> <span style={{color:"var(--border)"}}>·</span> <button className="btn btn-sm btn-ghost" style={{padding:"2px 8px",minHeight:28}} onClick={()=>setPage("aide")}>Aide</button> <span style={{color:"var(--border)"}}>·</span> <button className="btn btn-sm btn-ghost" style={{padding:"2px 8px",minHeight:28}} onClick={()=>setPage("parametres")}>Accessibilité</button></footer>
    
    {sessionWarning&&<div className="session-banner" role="alert" aria-live="assertive">{ico("clock",16)} Votre session expire dans 2 minutes. <button className="btn btn-sm" style={{background:"rgba(255,255,255,.2)",border:"none",color:"#fff",fontWeight:800}} onClick={()=>{setSessionWarning(false)}}>Rester connecté</button><button className="btn btn-sm btn-ghost" style={{color:"#fff",border:"1px solid rgba(255,255,255,.4)"}} onClick={()=>setLogged(false)}>Se déconnecter</button></div>}
    {tour&&<GuidedTour page={tour} onEnd={()=>setTour(null)}/>}
    <Toast toasts={toasts} remove={removeToast}/>
    <ScrollTop/>
    <GlobalSearch open={searchOpen} onClose={()=>setSearchOpen(false)} go={p=>{go(p);setSearchOpen(false)}}/>
  </div>)
}
ReactDOM.render(<App/>,document.getElementById("root"));

</script>
</body>
</html>
