<!doctype html>
<html lang="fr" data-page-role="voter,operator">
<head>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#4f46e5" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#1e293b" media="(prefers-color-scheme: dark)">
  <meta name="description" content="Interface de vote électronique — AG-VOTE">
  <title>Vote — AG-VOTE</title>
  <script src="/assets/js/theme-init.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap">
  <link rel="stylesheet" href="/assets/css/app.css">
  <link rel="stylesheet" href="/assets/css/vote.css">
  <script type="module" src="/assets/js/components/ag-searchable-select.js"></script>
</head>
<body>
  <!-- Skip link -->
  <a href="#vote-buttons" class="skip-link">Aller aux boutons de vote</a>

  <noscript>
    <div class="noscript-warning">
      <strong>JavaScript requis</strong><br>
      Cette application nécessite JavaScript pour fonctionner. Veuillez l'activer dans votre navigateur.
    </div>
  </noscript>

  <div class="vote-app" id="voteApp">
    <!-- Page header -->
    <header class="page-header" role="banner">
      <div>
        <h1 class="page-header-title">Vote</h1>
        <div class="page-header-subtitle" id="voteSubtitle">Interface de vote s&eacute;curis&eacute;e</div>
      </div>
      <div class="page-header-actions" id="headerActions">
        <button class="btn btn-secondary btn-sm" id="btnRefresh" aria-label="Actualiser les donn&eacute;es">Actualiser</button>
      </div>
    </header>

    <!-- Simplified identity banner (shown in invitation mode) -->
    <div class="vote-identity-banner" id="identityBanner" hidden>
      <div class="member-avatar" id="identityAvatar" aria-hidden="true">?</div>
      <div>
        <div class="identity-name" id="identityName">—</div>
        <div class="identity-meeting" id="identityMeeting">—</div>
      </div>
    </div>

    <!-- Context bar (hidden in invitation mode) -->
    <div class="context-bar" id="contextBar" role="region" aria-label="S&eacute;lection de s&eacute;ance et votant">
      <div class="form-group">
        <label class="form-label" for="meetingSelect">Séance</label>
        <ag-searchable-select
          id="meetingSelect"
          placeholder="Rechercher une séance..."
          empty-text="Aucune séance trouvée"
        ></ag-searchable-select>
      </div>
      <div class="form-group">
        <label class="form-label" for="memberSelect">Votant</label>
        <ag-searchable-select
          id="memberSelect"
          placeholder="Rechercher votre nom..."
          empty-text="Aucun votant trouvé"
        ></ag-searchable-select>
      </div>
    </div>

    <!-- Offline banner -->
    <div class="offline-banner" id="offlineBanner" role="alert" hidden>
      <svg class="icon icon-text" aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="1" y1="1" x2="23" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.56 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>
      <span>Hors ligne — Vérifiez votre connexion avant de voter</span>
    </div>

    <!-- Main content -->
    <main class="vote-main" id="main-content" role="main">
      <!-- Speech panel -->
      <section class="speech-panel" id="speechBox" aria-label="Demande de parole">
        <div class="speech-btn-wrap">
          <button class="speech-hand-btn" id="btnHand" type="button" aria-describedby="speechHint" aria-pressed="false">
            <span class="speech-hand-icon" id="speechHandIcon" aria-hidden="true">
              <svg class="icon icon-xl"><use href="/assets/icons.svg#icon-hand"></use></svg>
            </span>
          </button>
          <span class="speech-count-badge" id="speechQueuePos" hidden aria-label="Position dans la file">
            <span id="speechPosNumber">1</span>
          </span>
        </div>
        <div class="speech-info">
          <span class="speech-label" id="speechLabel" role="status" aria-live="polite">Lever la main</span>
          <p class="speech-hint" id="speechHint" aria-live="polite">Demander la parole</p>
        </div>
      </section>

      <!-- Current speaker banner (visible to all) -->
      <section class="current-speaker-banner" id="currentSpeakerBanner" aria-label="Orateur en cours" aria-live="polite" hidden>
        <div class="current-speaker-icon" aria-hidden="true">
          <svg class="icon"><use href="/assets/icons.svg#icon-mic"></use></svg>
        </div>
        <div class="current-speaker-info">
          <span class="current-speaker-name" id="currentSpeakerName">—</span>
          <span class="current-speaker-label">à la parole</span>
        </div>
        <div class="current-speaker-timer" id="currentSpeakerTimer" aria-label="Temps écoulé">00:00</div>
        <div class="current-speaker-queue" id="currentSpeakerQueue" hidden>
          <span class="current-speaker-queue-count" id="currentSpeakerQueueCount">0</span>
          <span class="current-speaker-queue-label">en attente</span>
        </div>
      </section>

      <!-- Motion card -->
      <section class="motion-card" id="motionBox" aria-label="Résolution en cours" aria-live="polite">
        <div class="motion-card-header">
          <h2 class="motion-card-label">Résolution en cours</h2>
          <div class="motion-meta" id="motionMeta">
            <span class="motion-pill" id="motionNo"></span>
            <span class="motion-pill" id="motionPhase">En attente</span>
            <span class="motion-pill motion-progress" id="motionProgress" hidden>
              <svg class="icon icon-text" aria-hidden="true"><use href="/assets/icons.svg#icon-layers"></use></svg>
              <span id="motionProgressText">—</span>
            </span>
          </div>
        </div>
        <div class="motion-card-body" id="motionBody">
          <h3 class="motion-title" id="motionTitle">En attente d'une résolution</h3>
          <p class="motion-sub" id="motionSub"></p>
          <div class="motion-badges" id="motionBadges"></div>
          <details class="reso-details" id="resoDetails" hidden>
            <summary>
              <span>Voir le texte de la résolution</span>
              <span class="reso-note" id="resoNote"></span>
            </summary>
            <div class="reso-text" id="resoText" aria-label="Texte intégral"></div>
          </details>
        </div>
      </section>

      <!-- Vote section -->
      <div class="vote-section" id="vote-buttons">
        <div class="vote-section-header">
          <h2 class="vote-section-label">Vote</h2>
          <div class="vote-section-meta">
            <span class="motion-pill" id="voteStatus">Non voté</span>
          </div>
        </div>
        <div class="vote-section-body">
          <div class="vote-buttons" role="group" aria-label="Choix de vote">
            <button class="vote-btn vote-btn-for" id="btnFor" data-choice="for" disabled aria-pressed="false" aria-describedby="motionTitle">
              <span class="vote-btn-kbd" aria-hidden="true">1</span>
              <span class="vote-btn-icon" aria-hidden="true"><svg class="icon icon-lg"><use href="/assets/icons.svg#icon-thumbs-up"></use></svg></span>
              <span>Pour</span>
              <span class="vote-btn-hint">Confirmation requise</span>
            </button>
            <button class="vote-btn vote-btn-against" id="btnAgainst" data-choice="against" disabled aria-pressed="false" aria-describedby="motionTitle">
              <span class="vote-btn-kbd" aria-hidden="true">2</span>
              <span class="vote-btn-icon" aria-hidden="true"><svg class="icon icon-lg"><use href="/assets/icons.svg#icon-thumbs-down"></use></svg></span>
              <span>Contre</span>
              <span class="vote-btn-hint">Confirmation requise</span>
            </button>
            <button class="vote-btn vote-btn-abstain" id="btnAbstain" data-choice="abstain" disabled aria-pressed="false" aria-describedby="motionTitle">
              <span class="vote-btn-kbd" aria-hidden="true">3</span>
              <span class="vote-btn-icon" aria-hidden="true"><svg class="icon icon-lg"><use href="/assets/icons.svg#icon-hand"></use></svg></span>
              <span>Abstention</span>
              <span class="vote-btn-hint">Confirmation requise</span>
            </button>
            <button class="vote-btn vote-btn-blanc" id="btnBlanc" data-choice="blanc" disabled aria-pressed="false" aria-describedby="motionTitle">
              <span class="vote-btn-kbd" aria-hidden="true">4</span>
              <span class="vote-btn-icon" aria-hidden="true"><svg class="icon icon-lg"><use href="/assets/icons.svg#icon-minus-circle"></use></svg></span>
              <span>Blanc</span>
              <span class="vote-btn-hint">Confirmation requise</span>
            </button>
          </div>
          <div class="vote-hint" id="voteHint" role="status" aria-live="polite">
            <span class="text-muted text-sm">Sélectionnez une séance et un votant ci-dessus pour pouvoir voter.</span>
          </div>
          <div class="vote-participation" id="voteParticipation" hidden>
            <div class="vote-participation-bar">
              <div class="vote-participation-fill" id="voteParticipationFill" style="width: 0%"></div>
            </div>
            <span class="vote-participation-text" id="voteParticipationText">0% ont voté</span>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="vote-footer" role="contentinfo">
      <div class="member-info" id="memberInfo" aria-live="polite">
        <div class="member-avatar" id="memberAvatar" aria-hidden="true">?</div>
        <div>
          <div class="member-name" id="memberName">Non connecté</div>
          <div class="member-weight" id="memberWeight">—</div>
        </div>
      </div>
      <div class="footer-status" role="status" aria-live="polite">
        <span class="footer-chip" id="voteReceipt" hidden>—</span>
        <span class="footer-chip">
          <span class="connection-dot" id="connectionDot" aria-hidden="true"></span>
          <span id="connectionStatus">Connecté</span>
        </span>
      </div>
    </footer>
  </div>

  <!-- Confirmation overlay (bottom sheet) -->
  <div class="vote-confirmation" id="confirmationOverlay" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-hidden="true">
    <div class="confirm-sheet">
      <div class="confirm-sheet-header">
        <strong id="confirmTitle">Confirmer votre vote</strong>
      </div>
      <div class="confirm-sheet-body">
        <div class="confirm-box">
          <div class="confirm-choice" id="confirmChoice">CHOIX</div>
          <div class="confirm-meta" id="confirmMeta">
            <span>Séance : <span id="cMeeting">—</span></span>
            <span>Votant : <span id="cMember">—</span></span>
            <span>Résolution : <span id="cMotion">—</span></span>
          </div>
        </div>
        <details class="reso-details" id="confirmResoDetails" open hidden>
          <summary>
            <span>Texte de la résolution</span>
            <span class="reso-note">vérifiez avant de confirmer</span>
          </summary>
          <div class="reso-text" id="confirmResoText"></div>
        </details>
      </div>
      <div class="confirm-irreversible-warning" aria-live="polite">
        <svg class="icon icon-text" aria-hidden="true"><use href="/assets/icons.svg#icon-alert-triangle"></use></svg>
        <span>Ce vote est <strong>définitif et irréversible</strong>. Vous ne pourrez pas le modifier.</span>
      </div>
      <div class="confirm-sheet-actions">
        <button class="btn btn-secondary" id="btnCancel">Annuler</button>
        <button class="btn btn-primary" id="btnConfirm">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div id="notif_box" class="toast-container"></div>

  <!-- Scripts -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="/assets/js/core/utils.js"></script>
  <script src="/assets/js/pages/auth-ui.js"></script>
  <script src="/assets/js/pages/vote.js"></script>
  <script src="/assets/js/pages/vote-ui.js"></script>
</body>
</html>
