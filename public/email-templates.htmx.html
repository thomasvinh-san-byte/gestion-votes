<!doctype html>
<html lang="fr" data-page-role="admin">
<head>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#4f46e5" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#1e293b" media="(prefers-color-scheme: dark)">
  <meta name="description" content="Gestion des templates email - AG-VOTE">
  <title>Templates Email — AG-VOTE</title>
  <script src="/assets/js/theme-init.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,300;12..96,400;12..96,500;12..96,600;12..96,700;12..96,800&family=Fraunces:opsz,wght@9..144,600;9..144,700;9..144,800&family=JetBrains+Mono:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="/assets/css/app.css">
  <link rel="stylesheet" href="/assets/css/email-templates.css">
</head>
<body>
  <div class="app-shell">
    <aside class="app-sidebar" data-include-sidebar data-page="settings"></aside>

    <header class="app-header">
      <div class="flex items-center gap-4">
        <a href="/admin.htmx.html" class="text-muted hover:text-current">
          <svg class="icon" aria-hidden="true"><use href="/assets/icons.svg#icon-arrow-left"></use></svg>
        </a>
        <h1 class="page-title">Templates Email</h1>
      </div>
    </header>

    <main class="app-main email-templates-main">
      <!-- Toolbar -->
      <div class="flex items-center justify-between gap-4 mb-6 flex-wrap">
        <div class="flex items-center gap-2">
          <select class="form-input" id="filterType">
            <option value="">Tous les types</option>
            <option value="invitation">Invitation</option>
            <option value="reminder">Rappel</option>
            <option value="confirmation">Confirmation</option>
            <option value="custom">Personnalisé</option>
          </select>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-secondary" id="btnCreateDefaults">
            <svg class="icon icon-text" aria-hidden="true"><use href="/assets/icons.svg#icon-refresh"></use></svg>
            Créer templates par défaut
          </button>
          <button class="btn btn-primary" id="btnNewTemplate">
            <svg class="icon icon-text" aria-hidden="true"><use href="/assets/icons.svg#icon-plus"></use></svg>
            Nouveau template
          </button>
        </div>
      </div>

      <!-- Templates grid -->
      <div class="templates-grid" id="templatesGrid">
        <!-- Rendered by JS -->
      </div>

      <!-- Empty state -->
      <div id="emptyState" class="empty-state email-templates-empty" style="display: none;">
        <svg class="icon icon-xl" aria-hidden="true"><use href="/assets/icons.svg#icon-mail"></use></svg>
        <h2>Aucun template</h2>
        <p class="text-muted">Créez des templates email pour personnaliser vos invitations.</p>
        <button class="btn btn-primary mt-4" id="btnEmptyCreate">
          <svg class="icon icon-text" aria-hidden="true"><use href="/assets/icons.svg#icon-plus"></use></svg>
          Créer un template
        </button>
      </div>
    </main>
  </div>

  <!-- Template Editor Modal -->
  <div class="template-editor" id="templateEditor">
    <div class="template-editor-content">
      <div class="template-editor-header">
        <h2 id="editorTitle">Nouveau template</h2>
        <button class="btn btn-icon" id="btnCloseEditor" title="Fermer">
          <svg class="icon" aria-hidden="true"><use href="/assets/icons.svg#icon-x"></use></svg>
        </button>
      </div>

      <div class="template-editor-body">
        <div class="template-editor-form">
          <input type="hidden" id="templateId">

          <div class="form-group">
            <label class="form-label" for="templateName">Nom du template *</label>
            <input type="text" class="form-input" id="templateName" placeholder="Ex: Invitation formelle">
          </div>

          <div class="form-group">
            <label class="form-label">Type *</label>
            <select class="form-input" id="templateType">
              <option value="invitation">Invitation</option>
              <option value="reminder">Rappel</option>
              <option value="confirmation">Confirmation</option>
              <option value="custom">Personnalisé</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="templateSubject">Sujet *</label>
            <input type="text" class="form-input" id="templateSubject" placeholder="Ex: Invitation de vote - {{meeting_title}}">
          </div>

          <div class="form-group">
            <label class="form-label">Contenu HTML *</label>
            <textarea class="form-input" id="templateBody" rows="12" placeholder="Contenu HTML du template..."></textarea>
          </div>

          <div class="form-group">
            <label class="form-label inline-flex items-center gap-2">
              <input type="checkbox" id="templateIsDefault">
              <span>Template par défaut pour ce type</span>
            </label>
          </div>

          <!-- Variables helper -->
          <div class="variables-section">
            <h4>Variables disponibles (cliquez pour insérer)</h4>
            <div id="variablesList">
              <!-- Rendered by JS -->
            </div>
          </div>
        </div>

        <div class="template-editor-preview">
          <div class="preview-header">
            <svg class="icon icon-text" aria-hidden="true"><use href="/assets/icons.svg#icon-eye"></use></svg>
            Prévisualisation
            <button class="btn btn-sm btn-secondary ml-auto" id="btnRefreshPreview">Actualiser</button>
          </div>
          <iframe class="preview-frame" id="previewFrame" sandbox="allow-same-origin"></iframe>
        </div>
      </div>

      <div class="template-editor-footer">
        <span id="editorStatus" class="text-sm text-muted"></span>
        <button class="btn btn-secondary" id="btnCancelEdit">Annuler</button>
        <button class="btn btn-primary" id="btnSaveTemplate">
          <svg class="icon icon-text" aria-hidden="true"><use href="/assets/icons.svg#icon-check"></use></svg>
          Enregistrer
        </button>
      </div>
    </div>
  </div>

  <script type="module" src="/assets/js/components/index.js"></script>
  <script src="/assets/js/core/utils.js"></script>
  <script src="/assets/js/core/shared.js"></script>
  <script src="/assets/js/core/shell.js"></script>
  <script src="/assets/js/pages/email-templates-editor.js"></script>
</body>
</html>
