<!-- public/partials/meeting_header.htmx.html -->
<div class="meeting-header card">
  <div class="row space" style="flex-wrap:wrap;">
    <div>
      <div style="font-weight:700;">Séance : <span id="mhTitle">—</span></div>
      <div class="muted">meeting_id : <span class="kbd" id="mhId">—</span> <span id="mhStatus"></span></div>
    </div>

    <nav class="meeting-nav">
      <a class="btn" href="/meetings.htmx.html">Séances</a>
      <a class="btn" data-meeting-link href="/motions.htmx.html">Motions</a>
      <a class="btn" data-meeting-link href="/attendance.htmx.html">Présences</a>
      <a class="btn" data-meeting-link href="/proxies.htmx.html">Procurations</a>
      <a class="btn" data-meeting-link href="/vote.htmx.html">Vote</a>
      <a class="btn" data-meeting-link href="/trust.htmx.html">Trust</a>
      <a class="btn" data-meeting-link href="/president.htmx.html">Président</a>
      <a class="btn primary" data-meeting-link href="/operator.htmx.html">Opérateur ▶</a>
    </nav>
  </div>
</div>

<script>
(function(){
  const params = new URLSearchParams(location.search);
  const meetingId = params.get("meeting_id") || "";
  const idEl = document.getElementById("mhId");
  const titleEl = document.getElementById("mhTitle");
  const statusEl = document.getElementById("mhStatus");

  if (idEl) idEl.textContent = meetingId || "—";
  if (titleEl) titleEl.textContent = meetingId ? meetingId : "—";

  document.querySelectorAll("[data-meeting-link]").forEach(a => {
    const u = new URL(a.getAttribute("href"), location.origin);
    if (meetingId) u.searchParams.set("meeting_id", meetingId);
    a.setAttribute("href", u.pathname + "?" + u.searchParams.toString());
  });

  if (!meetingId || !window.Utils || !Utils.apiGet) return;

  Utils.apiGet("/api/v1/meetings.php?meeting_id=" + encodeURIComponent(meetingId))
    .then(r => {
      if (r && typeof r === "object") {
        if (titleEl && r.title) titleEl.textContent = r.title;
        if (statusEl && r.status) {
          const cls = (r.status === "draft") ? "badge warn" :
                      (r.status === "archived") ? "badge" : "badge ok";
          statusEl.innerHTML = ' <span class="' + cls + '">' + r.status + '</span>';
        }
      }
    })
    .catch(() => {});
})();
</script>
