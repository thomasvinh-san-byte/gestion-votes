<!doctype html>
<html lang="fr" data-page-role="operator">
<head>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Gestion des invitations aux s√©ances ‚Äî AG-VOTE">
  <title>Invitations ‚Äî AG-VOTE</title>
  <link rel="stylesheet" href="/assets/css/app.css">
</head>
<body>

<div class="app-shell">
      <!-- Sidebar -->
    <aside class="app-sidebar" data-include-sidebar data-page="operator"></aside>

  <!-- Header -->
  <header class="app-header">
    <div class="flex items-center gap-4">
      <h1 class="text-xl font-bold">‚úâÔ∏è Invitations</h1>
      <p class="text-sm text-secondary" id="meetingTitle">Envoi des invitations de vote par email</p>
    </div>
    <div class="flex items-center gap-2">
      <a href="/operator.htmx.html" class="btn btn-secondary">‚Üê Retour op√©rateur</a>
      <button class="btn btn-ghost btn-icon" type="button" data-drawer="infos" title="Informations s√©ance">
        ‚ÑπÔ∏è
      </button>
      <button class="btn btn-ghost btn-icon" type="button" data-drawer="menu" title="Menu">
        ‚ò∞
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-main">
    <div class="container">
      
      <!-- KPI Cards -->
      <div class="kpi-grid mb-6">
        <div class="kpi-card">
          <div class="kpi-value" id="kpiTotal">‚Äî</div>
          <div class="kpi-label">Total membres</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-value text-success" id="kpiSent">‚Äî</div>
          <div class="kpi-label">Invitations envoy√©es</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-value text-warning" id="kpiPending">‚Äî</div>
          <div class="kpi-label">En attente</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-value text-danger" id="kpiFailed">‚Äî</div>
          <div class="kpi-label">√âchecs</div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Options d'envoi -->
        <div class="card lg:col-span-1">
          <div class="card-header">
            <h2 class="card-title">‚öôÔ∏è Options d'envoi</h2>
          </div>
          <div class="card-body">
            
            <div class="form-group">
              <label class="flex items-center gap-2">
                <input type="checkbox" id="onlyUnsent" checked>
                <span>Uniquement les non envoy√©s</span>
              </label>
              <p class="form-hint">N'envoie qu'aux membres qui n'ont pas encore re√ßu d'invitation</p>
            </div>

            <div class="form-group">
              <label class="flex items-center gap-2">
                <input type="checkbox" id="includeProxy">
                <span>Inclure les repr√©sent√©s (proxy)</span>
              </label>
              <p class="form-hint">Envoie aussi aux membres repr√©sent√©s par procuration</p>
            </div>

            <div class="form-group">
              <label class="form-label">Limite d'envoi</label>
              <input type="number" class="form-control" id="limitInput" min="0" value="0" placeholder="0 = illimit√©">
              <p class="form-hint">0 = envoyer √† tous les membres √©ligibles</p>
            </div>

            <div class="form-group">
              <label class="form-label">Sujet personnalis√© (optionnel)</label>
              <input type="text" class="form-control" id="subjectInput" placeholder="Invitation √† voter - {titre_s√©ance}">
            </div>

            <hr class="my-4">

            <div class="flex flex-col gap-2">
              <button class="btn btn-secondary w-full" id="btnPreview">
                üëÅÔ∏è Aper√ßu (dry-run)
              </button>
              <button class="btn btn-primary w-full" id="btnSend">
                ‚úâÔ∏è Envoyer les invitations
              </button>
            </div>
          </div>
        </div>

        <!-- R√©sultat / Log -->
        <div class="card lg:col-span-2">
          <div class="card-header">
            <h2 class="card-title">üìã R√©sultat d'envoi</h2>
            <span class="badge badge-secondary" id="statusBadge">En attente</span>
          </div>
          <div class="card-body">
            <div id="resultArea" class="result-area">
              <div class="empty-state">
                <div class="empty-state-icon">‚úâÔ∏è</div>
                <h3 class="empty-state-title">Pr√™t √† envoyer</h3>
                <p class="empty-state-description">
                  Configurez les options et cliquez sur "Aper√ßu" pour pr√©visualiser 
                  ou "Envoyer" pour lancer l'envoi.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Liste des membres -->
      <div class="card mt-6">
        <div class="card-header">
          <h2 class="card-title">üë• Statut des invitations</h2>
          <div class="flex gap-2">
            <input type="text" class="form-control" id="searchInput" placeholder="Rechercher..." style="width: 200px;">
            <select class="form-control" id="filterSelect" style="width: 150px;">
              <option value="all">Tous</option>
              <option value="sent">Envoy√©s</option>
              <option value="pending">En attente</option>
              <option value="failed">√âchecs</option>
            </select>
          </div>
        </div>
        <div class="card-body">
          <div id="membersList">
            <div class="loading-spinner">Chargement...</div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<style>
.result-area {
  min-height: 300px;
  max-height: 500px;
  overflow-y: auto;
  padding: var(--space-4);
  background: var(--color-neutral-50);
  border-radius: var(--radius-md);
  font-family: var(--font-mono);
  font-size: var(--text-sm);
}

.result-area pre {
  white-space: pre-wrap;
  word-break: break-word;
  margin: 0;
}

.result-area .empty-state {
  background: transparent;
}

.invitation-row {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3);
  border-bottom: 1px solid var(--color-border);
}

.invitation-row:last-child {
  border-bottom: none;
}

.invitation-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--color-primary-subtle);
  color: var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: var(--text-sm);
}

.invitation-info {
  flex: 1;
  min-width: 0;
}

.invitation-name {
  font-weight: 500;
  color: var(--color-text);
}

.invitation-email {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.invitation-status {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}
</style>

<div class="drawer-backdrop" data-drawer-close></div>
<aside class="drawer" id="drawer">
  <div class="drawer-header">
    <div id="drawerTitle" class="font-semibold">Menu</div>
    <button class="btn btn-ghost btn-icon btn-sm" type="button" data-drawer-close title="Fermer">‚úï</button>
  </div>
  <div id="drawerBody" class="drawer-body"></div>
</aside>

<script src="/assets/js/utils.js"></script>
<script src="/assets/js/shared.js"></script>
<script src="/assets/js/shell.js"></script>
<script src="/assets/js/invitations.js"></script>

</body>
</html>
