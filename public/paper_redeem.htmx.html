<!doctype html>
<html lang="fr" data-page-role="operator">
<head>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Rachat de bulletins papier pour le vote â€” AG-VOTE">
  <title>Rachat bulletin papier â€” AG-VOTE</title>
  <link rel="stylesheet" href="/assets/css/design-system.css">
  <link rel="stylesheet" href="/assets/css/app.css">
</head>
<body>

<div class="app-shell">
      <!-- Sidebar -->
    <aside class="app-sidebar" data-include-sidebar data-page="operator"></aside>

  <!-- Header -->
  <header class="app-header">
    <div class="flex items-center gap-4">
      <h1 class="text-xl font-bold">ğŸ“„ Rachat bulletin papier</h1>
      <p class="text-sm text-secondary">Mode dÃ©gradÃ© â€” Saisie manuelle des votes papier</p>
    </div>
    <div class="flex items-center gap-2">
      <a href="/operator_flow.htmx.html" class="btn btn-secondary">â† Retour conduite</a>
      <button class="btn btn-ghost btn-icon" type="button" data-drawer="infos" title="Informations sÃ©ance">
        â„¹ï¸
      </button>
      <button class="btn btn-ghost btn-icon" type="button" data-drawer="menu" title="Menu">
        â˜°
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-main">
    <div class="container">
      
      <!-- Alert mode dÃ©gradÃ© -->
      <div class="alert alert-warning mb-6">
        <strong>âš ï¸ Mode dÃ©gradÃ© actif</strong>
        <p class="text-sm mt-1">Les bulletins papier sont utilisÃ©s en cas de problÃ¨me technique. Chaque saisie sera tracÃ©e.</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Formulaire de saisie -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Saisie du bulletin</h2>
          </div>
          <div class="card-body">
            
            <div class="form-group">
              <label class="form-label">Code du bulletin (UUID)</label>
              <div class="flex gap-2">
                <input type="text" class="form-control flex-1" id="codeInput" 
                       placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                <button class="btn btn-secondary" id="btnScan">ğŸ“·</button>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Vote exprimÃ©</label>
              <div class="vote-btns-grid">
                <button type="button" class="vote-btn" data-choice="for">âœ… Pour</button>
                <button type="button" class="vote-btn" data-choice="against">âŒ Contre</button>
                <button type="button" class="vote-btn" data-choice="abstain">âšª Abstention</button>
                <button type="button" class="vote-btn" data-choice="blank">ğŸ“„ Blanc</button>
              </div>
              <input type="hidden" id="voteChoice" value="">
            </div>

            <div class="form-group">
              <label class="form-label">Justification *</label>
              <textarea class="form-control" id="justInput" rows="3" 
                        placeholder="Raison du vote papier..."></textarea>
            </div>

            <div class="flex gap-2 justify-end mt-4">
              <button class="btn btn-secondary" id="btnReset">Effacer</button>
              <button class="btn btn-primary" id="btnSave" disabled>âœ“ Enregistrer</button>
            </div>

            <div id="resultMsg" class="mt-4" style="display:none;"></div>
          </div>
        </div>

        <!-- Zone scanner -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">ğŸ“· Scanner QR Code</h2>
          </div>
          <div class="card-body">
            <div class="scanner-box">
              <video id="videoPreview" playsinline></video>
              <div class="scanner-overlay" id="overlay">
                <div class="scanner-frame"></div>
                <p>CamÃ©ra inactive</p>
              </div>
            </div>
            <div class="flex gap-2 mt-4">
              <button class="btn btn-primary flex-1" id="btnStart">ğŸ“· DÃ©marrer</button>
              <button class="btn btn-secondary flex-1" id="btnStop" style="display:none;">â¹ Stop</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Historique -->
      <div class="card mt-6">
        <div class="card-header">
          <h2 class="card-title">ğŸ“œ Saisies rÃ©centes</h2>
        </div>
        <div class="card-body" id="recentList">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“„</div>
            <h3 class="empty-state-title">Aucune saisie</h3>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<style>
.scanner-box {
  position: relative;
  width: 100%;
  aspect-ratio: 4/3;
  background: #1a1a2e;
  border-radius: var(--radius-lg);
  overflow: hidden;
}
.scanner-box video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.scanner-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.6);
  color: white;
}
.scanner-overlay.active { background: transparent; }
.scanner-overlay.active p { display: none; }
.scanner-frame {
  width: 180px;
  height: 180px;
  border: 3px solid var(--color-primary);
  border-radius: 12px;
}
.vote-btns-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}
.vote-btn {
  padding: 12px;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
  cursor: pointer;
  font-weight: 500;
  transition: all 0.15s;
}
.vote-btn:hover {
  border-color: var(--color-primary);
}
.vote-btn.active {
  border-color: var(--color-primary);
  background: var(--color-primary);
  color: white;
}
</style>

<div class="drawer-backdrop" data-drawer-close></div>
<aside class="drawer" id="drawer">
  <div class="drawer-header">
    <div id="drawerTitle" class="font-semibold">Menu</div>
    <button class="btn btn-ghost btn-icon btn-sm" type="button" data-drawer-close title="Fermer">âœ•</button>
  </div>
  <div id="drawerBody" class="drawer-body"></div>
</aside>

<script src="/assets/js/utils.js"></script>
<script src="/assets/js/shared.js"></script>
<script src="/assets/js/shell.js"></script>
<script src="/assets/js/paper_redeem.js"></script>

</body>
</html>
