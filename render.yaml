# =============================================================================
# AG-VOTE — Render Blueprint DÉMO (one-click deploy)
# =============================================================================
# Cliquer sur "Deploy to Render" crée automatiquement :
#   - Un service web Docker (l'app PHP/Nginx)
#   - Une base PostgreSQL
#   - Toute la configuration réseau entre les deux
#
# ⚠ Ce blueprint est pour la DÉMO PUBLIQUE (auth désactivée, données test).
#    Pour un déploiement PRODUCTION, utilisez render-production.yaml.
# ⚠ RATE_LIMIT_ENABLED reste 1 — même une démo ouverte ne doit pas servir
#    de relai pour du brute-force ou du scraping.
# =============================================================================

services:
  - type: web
    name: ag-vote
    runtime: docker
    plan: free
    healthCheckPath: /api/v1/health.php
    envVars:
      # Render routes traffic to this port (default is 10000, nginx listens on 8080)
      - key: PORT
        value: "8080"
      - key: DB_HOST
        fromDatabase:
          name: ag-vote-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: ag-vote-db
          property: port
      - key: DB_DATABASE
        fromDatabase:
          name: ag-vote-db
          property: database
      - key: DB_USER
        fromDatabase:
          name: ag-vote-db
          property: user
      - key: DB_PASS
        fromDatabase:
          name: ag-vote-db
          property: password
      - key: LOAD_DEMO_DATA
        value: "1"
      - key: APP_ENV
        value: demo
      - key: APP_DEBUG
        value: "0"
      # Auth and CSRF off for demo — anyone can explore without credentials.
      - key: APP_AUTH_ENABLED
        value: "0"
      - key: CSRF_ENABLED
        value: "0"
      # Rate limiting stays ON even in demo mode to prevent abuse.
      - key: RATE_LIMIT_ENABLED
        value: "1"

databases:
  - name: ag-vote-db
    databaseName: vote_app
    user: vote_app
    plan: free
